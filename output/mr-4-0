TACE,1;
A,1;
A,1;
C,1;
A,1;
F,1;
C,1;
S
JON,1;
GJENGSETRUST,1;
C,1;
A,1;
y,1;
Jon,1;
j,1;
n,1;
s,1;
2022,1;
Jon,1;
Gjengset.
All,1;
reserved.,1;
reproduced,1;
transmitted,1;
any,1;
any,1;
including,1;
any,1;
prior,1;
written,1;
printing
25,1;
978-1-7185-0186-7,1;
Editor:,1;
Franklin
Production,1;
Editor:,1;
Editor:,1;
Barry
Interior,1;
Tolnay
Copyeditor:,1;
Barry
Indexer:,1;
book,1;
please,1;
Press,,1;
Press,,1;
94103
phone:,1;
registered,1;
Press,,1;
respective,1;
a,1;
a,1;
we,1;
using,1;
editorial,1;
fashion,1;
intention,1;
of
the,1;
book,1;
basis,,1;
While,1;
preparation,1;
Press,,1;
shall,1;
have,1;
any,1;
person,1;
any,1;
alleged,1;
Author
Jon,1;
worked,1;
built,1;
a,1;
his,1;
PhD,1;
at,1;
He’s,1;
a,1;
contributor
to,1;
toolchain,1;
including,1;
Jon,1;
2018,,1;
he,1;
live-stream-
ing,1;
he’s,1;
made
videos,1;
async,1;
await,,1;
have,1;
Reviewer
David,1;
a,1;
contributor,1;
who,1;
a,1;
CONTENTS
Foreword,1;
xix
Introduction,1;
Foundations,1;
1
Chapter,1;
2:,1;
19
Chapter,1;
Interfaces,1;
57
Chapter,1;
(and,1;
Interfaces,1;
12:,1;
Memory,1;
Terminology,1;
5
Ownership,1;
Mutability,1;
Memory,1;
19
Alignment,1;
Sized,1;
Wide,1;
24
Compilation,1;
28
Coherence,1;
28Trait,1;
33
Existential,1;
35
3
DESIGNING,1;
Arguments,1;
Safety,1;
Owned,1;
Blocking,1;
System,1;
58
Enumeration,1;
58
Opaque,1;
Crate,1;
73
Conditional,1;
78
Versioning,1;
Supported,1;
Version,1;
83
Unreleased,1;
Harness,1;
86
#[cfg(test)],1;
100
7
MACROS
101
Declarative,1;
104
How,1;
Cost,1;
a,1;
Macro,1;
Do,1;
Interfaces,1;
Interfaces,1;
121
async/await,1;
124
Pin,1;
133
Waking,1;
Poll,1;
Contract,1;
a,1;
136
Tasks,1;
136
Tying,1;
All,1;
140
9
UNSAFE,1;
Power,1;
Go,1;
Check,1;
163
Read,1;
165
Summary,1;
168
Performance,1;
172
Shared,1;
Memory,1;
173
Actors,1;
174
Asynchrony,1;
Parallelism,1;
177
Memory,1;
178
Memory,1;
Fetch,1;
Simple,1;
Stress,1;
189
Summary,1;
192
11
FOREIGN,1;
Scripts,1;
Memory,1;
Initialization,1;
216
Low-Level,1;
Memory,1;
224
Tools,1;
230
Patterns,1;
233
Drop,1;
Date,1;
237
What,1;
Doing,1;
240
Learn,1;
WORD
Dear,1;
far,,1;
it’s,1;
likely,1;
have,1;
a,1;
learning
resources,1;
have,1;
tier,1;
do,1;
commonly,1;
a,1;
co-occurrence
of,1;
and
building,1;
book,1;
those
things.
However,,1;
it’s,1;
a,1;
fundamental,1;
book,1;
helpful,1;
a,1;
it’s,1;
not,1;
book,1;
a,1;
tradeoffs,1;
does,1;
not,1;
we,1;
have,1;
have,1;
But,1;
effective,1;
testing,1;
you
down,1;
Language
(a.k.a.,1;
not,1;
going,1;
have,1;
a,1;
manifesting,1;
innovative,1;
book,1;
begin,1;
personal,1;
take,1;
a,1;
a,1;
better.
I,1;
encourage,1;
point,1;
consciously.,1;
free,1;
we,1;
that
the,1;
best,1;
how,1;
have,1;
gotten
to,1;
listed,1;
Rustaceans—those,1;
who,1;
a,1;
of
the,1;
call,1;
me,1;
live-streaming,1;
systems,1;
concepts,,1;
would,1;
My,1;
through,1;
development,1;
including,1;
how,1;
While,1;
a,1;
could,1;
same,1;
things,1;
likely,1;
would,1;
learning,1;
along,1;
videos,1;
a,1;
also
became,1;
videos,1;
prefer,1;
learning,1;
have,1;
a,1;
consume,1;
at,1;
pace.
Others,1;
a,1;
out,1;
specific,1;
best,1;
a,1;
six-hour
coding,1;
made,1;
me,1;
My,1;
topics.
I,1;
book,1;
would,1;
best,1;
gain,1;
a,1;
yourself,1;
daily,,1;
someone,1;
But,1;
found,1;
a,1;
place,,1;
videos,1;
short.,1;
sessions,1;
book,1;
mecha-
nisms,,1;
a,1;
of
the,1;
at,1;
have,1;
attempt,1;
at,1;
hole,1;
resources.,1;
fulfilling,1;
written,1;
a,1;
book,1;
little,1;
would,1;
a,1;
blog
posts,,1;
a,1;
a,1;
writing,,1;
rewriting,,1;
editing.,1;
I’m
incredibly,1;
grateful,1;
girlfriend,,1;
Talia,,1;
has
shown,1;
nights,1;
would,1;
have,1;
book,1;
could,1;
have,1;
happened,1;
who,1;
have,1;
a,1;
a,1;
joy,1;
am,1;
best,1;
same,1;
would,1;
a,1;
book,1;
support,,1;
curiosity.
This,1;
book,1;
would,1;
not,1;
have,1;
not,1;
who,1;
technical
reviewer.,1;
finding,1;
code,,1;
his,1;
experience,,1;
pedagogy,1;
made,1;
a,1;
com-
ments,1;
sometimes,1;
made,1;
me,1;
always,1;
made,1;
same,1;
Chadwick,,1;
rest,1;
team,1;
at,1;
Starch.,1;
through,1;
along,1;
comments,1;
showed,1;
along,1;
the
intermediate,1;
always,1;
illuminating,,1;
not,1;
Carol,1;
Language,,1;
book,1;
at,1;
a,1;
could,1;
not,1;
done,1;
fundamentals,1;
give,1;
a,1;
you.,1;
Yes,,1;
you!,1;
Writing,1;
book,1;
a,1;
it’s,1;
and
encouragement,1;
me,1;
going
throughout,1;
it’s,1;
who,1;
a,1;
desire,1;
understanding,1;
and
skills,1;
me,1;
collection,1;
best,1;
any,1;
what
you,1;
always,1;
idioms,,1;
designs,1;
and
which,1;
do,1;
not,,1;
tools,1;
in
the,1;
ecosystem.,1;
distill,1;
a,1;
though
it’s,1;
any,1;
wants,1;
basics,
wherever,1;
book,1;
concepts
such,1;
code,,1;
no_std,1;
code,,1;
cov-
ers,1;
I/O,,1;
testing,,1;
explain,1;
powerful,1;
going,1;
book,1;
written,1;
a,1;
a,1;
reference.,1;
particularly
interest,1;
causing,1;
finish,1;
a,1;
experience.,1;
do,1;
development.,1;
a,1;
you’ll,1;
Foundations,,1;
variables,,1;
lifetimes,1;
you’ll,1;
book.
Chapter,1;
similarly,1;
provides,1;
a,1;
Rust,,1;
including,1;
how,1;
restrictions,,1;
a,1;
Interfaces,,1;
covers,1;
how,1;
misuse-resistant,,1;
including,1;
how,1;
how,1;
enforce,1;
4,,1;
errors
(enumerated,1;
defined,,1;
propagated,,1;
Structure,,1;
a,1;
metadata,1;
how,1;
testing,1;
harness
works,1;
testing,1;
tools,1;
tests,,1;
Macros,,1;
covers,1;
how,1;
for,,1;
interfaces,1;
how,1;
asynchrony,1;
at,1;
level
of,1;
at,1;
high,1;
async,1;
explains,1;
role,1;
how,1;
async,1;
machinery,1;
9,,1;
Code,,1;
explains,1;
unlocks,1;
responsibilities,1;
common,1;
reduce,1;
(and,1;
at,1;
how,1;
covers,1;
how,1;
related,1;
not,1;
how,1;
how,1;
programs.
Chapter,1;
Interfaces,,1;
how,1;
do.
Chapter,1;
using,1;
full,1;
constrained,1;
a,1;
aims,1;
give,1;
common,1;
patterns,,1;
best,1;
tools,1;
any,1;
book,1;
a,1;
at,1;
to
resources,1;
at,1;
at,1;
out,1;
main(),1;
Rust,,1;
it’s,1;
have,1;
a,1;
understanding,1;
Rust,,1;
any,1;
meaning,1;
various,1;
begin,1;
ways.,1;
this
chapter,,1;
we’ll,1;
through,1;
primitives
and,1;
define,1;
mean,,1;
how,1;
we’ll,1;
look,1;
at,1;
how,1;
how,1;
a,1;
lifetimes,1;
you’ll,1;
have,1;
before,1;
chapter,1;
if,1;
a,1;
brush,1;
content,1;
understanding,1;
using,1;
created,1;
have,1;
a,1;
a,1;
text,1;
nonvolatile
RAM.,1;
a,1;
how,1;
accessible,,1;
some
are,1;
how,1;
we,1;
variables,,1;
A,1;
a,1;
values.,1;
A,1;
a,1;
using,1;
a,1;
programmer,,1;
a,1;
A,1;
value’s,1;
meaning,1;
stored,1;
a,1;
place,,1;
a,1;
value.”,1;
common,1;
a,1;
a,1;
slot,1;
a,1;
a,1;
a,1;
A,1;
value
stored,1;
location,1;
same,1;
have,1;
multiple,1;
same,1;
location,1;
same,1;
Listing,1;
y,1;
&x;
let,1;
&x;
1,1;
&y;
Listing,1;
variables,,1;
four,1;
distinct,1;
y,1;
four,1;
variables:,1;
type,
because,1;
references,1;
While,1;
same,1;
we,1;
stored,1;
does,1;
not,1;
stores,1;
place
named,1;
distinction,1;
variables,,1;
a,1;
though,1;
we,1;
assign,1;
a,1;
string,,1;
a,1;
value
"Hello,1;
not,1;
point,1;
hang,1;
does,1;
have,1;
a,1;
a,1;
we,1;
Depth
The,1;
a,1;
unlikely,1;
code,,1;
a,1;
accurate,1;
through,1;
we,1;
would,1;
take,1;
broadly,1;
models.
High-level,1;
at,1;
are
reasoning,1;
suffice,1;
we,1;
we,1;
given,1;
a,1;
program.,1;
assign,1;
a,1;
variable.,1;
a,1;
accessed,,1;
imagine,1;
a,1;
a,1;
dependency,1;
accesses.,1;
a,1;
a,1;
exists,1;
a,1;
a,1;
dependency,1;
lines,,1;
often,1;
flows,,1;
a,1;
a,1;
value.,1;
Flows,1;
a,1;
distinct,1;
value.,1;
at,1;
any,1;
given,1;
point,1;
cannot,1;
a,1;
a,1;
a,1;
value.,1;
Listing,1;
would,1;
illegal,,1;
a,1;
above:
2,1;
y,1;
a,1;
second,,1;
x:
3,1;
43;
//,1;
y,,1;
assignment,1;
1-2:,1;
we,1;
cannot,1;
before,1;
we,1;
have,1;
Only,1;
we,1;
assign,1;
a,1;
we,1;
(&mut),1;
shared,1;
through,1;
exclusive
flow,1;
at,1;
shared,1;
at,1;
a,1;
shared,1;
a,1;
at,1;
same,1;
if,1;
not,1;
would,1;
shared,1;
would,1;
at,1;
at,1;
would,1;
a,1;
same,1;
a,1;
still,1;
distinct,1;
later
variable,1;
same,1;
coexist,
though,1;
a,1;
one.,1;
matches,1;
how,1;
internally,1;
code.
Low-Level,1;
not,1;
values.
You,1;
a,1;
a,1;
assign,1;
you
access,1;
slot,1;
would,1;
A,1;
a,1;
1get,1;
at,1;
value.,1;
For,1;
a,1;
a,1;
a,1;
though,1;
does,1;
not,1;
have,1;
a,1;
slot,1;
If
you,1;
assign,1;
a,1;
bits,1;
does,1;
not,1;
multiple,1;
same,1;
C,1;
memory.
NOTE
In,1;
we,1;
CPU,1;
a,1;
a,1;
a,1;
matches,1;
other,,1;
valid,,1;
a,1;
complicated,1;
do,1;
do,1;
not
compile,1;
expect.
Memory,1;
have,1;
a,1;
grip,1;
how,1;
we,1;
we,1;
about
what,1;
and
perhaps,1;
not,1;
stored,1;
a,1;
impact,1;
how,1;
a,1;
uses,1;
scratch,1;
space
for,1;
a,1;
called,,1;
a,1;
a,1;
frame,1;
at,1;
frame,1;
call,1;
additional,1;
pushed,1;
A,1;
along,1;
any,1;
frame,1;
immediately,1;
it’s,1;
not,1;
a,1;
call,1;
frame,1;
reclaimed,1;
one.,1;
if,1;
the
function,1;
closely,1;
lifetimes,1;
stored,1;
cannot,1;
frame,1;
must,1;
have,1;
a,1;
at,1;
of
the,1;
a,1;
call,1;
a,1;
calling
function,1;
space,1;
write
that,1;
before,1;
But,1;
if,1;
at
all,,1;
do,1;
a,1;
often,1;
C,1;
do,1;
not,1;
away,1;
a,1;
a,1;
place,,1;
value.,1;
differ-
ently,,1;
given,1;
a,1;
leaking,1;
usually,1;
For,1;
example,
say,1;
have,1;
a,1;
a,1;
Memory
Static,1;
a,1;
catch-all,1;
closely,1;
related,1;
are
automatically,1;
program’s,1;
program’s,1;
program’s,1;
usually,1;
executes,,1;
text,1;
a,1;
Static,1;
code,,1;
marks,1;
a,1;
a,1;
a,1;
a,1;
not,1;
inverse,1;
not,1;
do,1;
not,1;
point,1;
memory—but,1;
still,1;
once
you,1;
create,1;
a,1;
a,1;
whatever,1;
rest,1;
often,1;
will
encounter,1;
often,1;
A,1;
bound,1;
we,1;
for,,1;
program.,1;
self-sufficient,,1;
either,1;
does,1;
not,1;
does,1;
program.,1;
A,1;
a,1;
bound,1;
a,1;
closure,1;
new
thread,1;
cannot,1;
any-
thing,1;
stored,1;
wonder,1;
how,1;
constant.,1;
completely,1;
at,1;
time,
and,1;
any,1;
replaced,1;
constant’s,1;
compilation.,1;
A,1;
a,1;
a,1;
a,1;
have,1;
a,1;
location,1;
a,1;
responsible,1;
value.,1;
through,1;
a,1;
a,1;
location,1;
one.,1;
through,1;
though,1;
bits,1;
technically,1;
still,1;
there.
Instead,,1;
must,1;
through,1;
location.
Some,1;
do,1;
not,1;
a,1;
value’s,1;
Copy,1;
trait,,1;
not,1;
have,1;
even
if,1;
a,1;
same,1;
at,1;
the
move.,1;
Rust,,1;
must,1;
copying,1;
eliminates,1;
any,1;
a,1;
must,1;
would,1;
if,1;
a,1;
Copy.
If,1;
we,1;
executed,1;
would,1;
would,1;
free,1;
out,1;
twice
could,1;
have,1;
a,1;
value’s,1;
do,1;
any,1;
Rust,,1;
drop-
ping,1;
usually,1;
recursively,1;
drop-
ping,1;
a,1;
a,1;
dropped.
Because,1;
we,1;
cannot,1;
accidentally
drop,1;
same,1;
multiple,1;
A,1;
a,1;
does,1;
not,1;
Listing,1;
a,1;
copy,1;
a,1;
y1);
//,1;
out,1;
dropped;
//,1;
drops,1;
x1's,1;
not,1;
x2,1;
not,1;
z
4,1;
copying,1;
out,1;
a,1;
containing,1;
we,1;
copied,1;
z,,1;
z.,1;
4,,1;
any,1;
attempt,1;
would,1;
a,1;
compiler
error.,1;
out,1;
drops,1;
copied,1;
drops,1;
out,1;
Listing,1;
weird,1;
at,1;
we,1;
look,1;
at,1;
though,,1;
makes,1;
a,1;
lot,1;
Say,1;
a,1;
declares
a,1;
a,1;
a,1;
must,1;
first;,1;
if,1;
would,1;
references,1;
drops,1;
reverse,1;
we,1;
could,1;
have,1;
same,1;
a,1;
tuple,,1;
struct,,1;
would,1;
likely,1;
if,1;
same,1;
intui-
tive,1;
on.,1;
variables,,1;
reverse,1;
a,1;
intuitive,1;
a,1;
lend,1;
out,1;
through,1;
come
with,1;
additional,1;
how,1;
provides,1;
have,1;
references,1;
point,1;
References
A,1;
shared,1;
&T,,1;
a,1;
references,1;
same,1;
shared,1;
shared,1;
references,1;
not,1;
cannot,1;
a,1;
shared,1;
a,1;
a,1;
a,1;
shared,1;
not,1;
lives.,1;
For,1;
if,1;
a,1;
shared,1;
multiple
times,1;
a,1;
Listing,1;
fail.
Foundations
9fn,1;
cache(input:,1;
{
*sum,1;
+,1;
*input);
}
Listing,1;
assumes,1;
shared,1;
references,1;
not,1;
chooses,1;
a,1;
given,1;
do,1;
rather
than,1;
does,1;
a,1;
at,1;
a,1;
alternative,1;
a,1;
shared,1;
a,1;
T.,1;
full,1;
of
the,1;
assumes,1;
target,1;
through,1;
a,1;
a,1;
one.,1;
assumes,1;
mutable
reference,1;
noalias(input:,1;
*output,1;
if,1;
3;
}
}
Listing,1;
1-5:,1;
assumes,1;
references,1;
Rust,,1;
do,1;
not,1;
point,1;
to
the,1;
same,1;
at,1;
cannot,1;
affect
the,1;
at,1;
a,1;
could,1;
not,1;
contract,
that,1;
would,1;
could,1;
3,1;
a,1;
location,1;
that
the,1;
lie,1;
depends,1;
consider
Listing,1;
y,1;
y,1;
Mutability,1;
immediately,1;
memory.
10
Chapter,1;
y,1;
a,1;
making,1;
a,1;
cannot,1;
y,1;
through,1;
z,,1;
cannot,1;
a,1;
owning,1;
a,1;
a,1;
mutable
reference,1;
responsible,1;
do,1;
through,1;
if,1;
if,1;
must,1;
not,,1;
would,1;
still,1;
would,1;
drop!
Listing,1;
a,1;
reference.
fn,1;
replace_with_84(s:,1;
not,1;
would,1;
we,1;
exchange,1;
std::mem::swap(s,,1;
s,1;
s);
5
Listing,1;
through,1;
a,1;
must,1;
a,1;
behind.
I’ve,1;
commented-out,1;
You
cannot,1;
out,1;
would,1;
still,1;
would,1;
free,1;
at,1;
a,1;
If
you,1;
a,1;
equivalent,1;
out,1;
a,1;
a,1;
at,1;
if,1;
a,1;
do,1;
behind
the,1;
if,1;
have,1;
owning,1;
either,1;
4,,1;
references,1;
meaning,1;
through,1;
a,1;
shared,1;
reference.,1;
usually,1;
atomic,1;
CPU,1;
instructions),1;
a,1;
reference
through,1;
a,1;
shared,1;
a,1;
a,1;
shared,1;
category,1;
consists,1;
ensure,1;
any,1;
give,1;
a,1;
mutable
reference,1;
(and,1;
shared,1;
at,1;
a,1;
(and,1;
rely
on,1;
a,1;
immediately,1;
9,,1;
through
a,1;
shared,1;
categories,1;
not,1;
give,1;
out,1;
a,1;
atomic,1;
You
cannot,1;
a,1;
a,1;
at,1;
a,1;
given,1;
point,1;
through,1;
not,1;
out,1;
either,1;
a,1;
copy,1;
value.,1;
references,1;
always,1;
okay,1;
though,1;
through,1;
a,1;
shared,1;
reference.
Lifetimes
If,1;
you’re,1;
you’re,1;
likely,1;
through,1;
understanding,1;
majority,1;
we,1;
Rust,,1;
a,1;
to
work,1;
often,1;
lifetimes,1;
cor-
responding,1;
a,1;
take,1;
a,1;
out,1;
That’s
often,1;
usually,1;
useful,,1;
reality,1;
a,1;
little,1;
a,1;
a,1;
must,1;
While,1;
a,1;
a,1;
does,1;
we,1;
heart,1;
lifetimes,1;
a,1;
still,1;
does,1;
reference
was,1;
point,1;
uses,1;
along,1;
still,1;
“data,1;
we,1;
that
the,1;
we,1;
does,1;
not,1;
any,1;
flows.
Listing,1;
a,1;
{
2,1;
*x,1;
{
3,1;
r);,1;
do,1;
not,1;
contiguous.
The,1;
at,1;
we,1;
take,1;
a,1;
we,1;
immediately,1;
a,1;
out,1;
a,1;
reference
to,1;
immediately,1;
uses,1;
a,1;
if,1;
still,1;
at,1;
out,1;
at,1;
But,1;
if,1;
created,1;
at,1;
does,1;
not,1;
at,1;
uses,1;
(2,1;
we,1;
at,1;
Listing,1;
would,1;
would,1;
a,1;
at,1;
2.
Lifetimes,1;
Listing,1;
a,1;
it’s,1;
it
starts,1;
ends.
Foundations
13let,1;
{
2,1;
z);
//,1;
Box::new(i);
4,1;
z);
//,1;
have,1;
holes.
The,1;
at,1;
we,1;
take,1;
a,1;
at,1;
at,1;
at,1;
we,1;
by
updating,1;
final,1;
have,1;
a,1;
from,,1;
we,1;
existing.,1;
we,1;
later,
we,1;
exists,1;
z.,1;
not,1;
be,,1;
it’s,1;
a,1;
consequences,1;
could,1;
help
to,1;
a,1;
we,1;
have,1;
references,1;
have,1;
a,1;
various,1;
if,1;
a,1;
a,1;
that
outlives,1;
a,1;
generic,1;
generic,1;
Carol,1;
Press,,1;
won’t,1;
But,1;
lifetimes,1;
aware,1;
if,1;
a,1;
any,1;
generic,1;
any,1;
generic,1;
lifetimes,1;
before,1;
does,1;
any,1;
does,1;
not,1;
does,1;
not,1;
a,1;
free,1;
any,1;
references,1;
stored,1;
do,1;
not,1;
we,1;
saw,1;
Listing,1;
9.
Second,,1;
a,1;
generic,1;
multiple,1;
often,1;
serves,1;
unnecessarily,1;
a,1;
generic,1;
a,1;
shorter,1;
lifetimes,1;
any,1;
references,1;
inserted,1;
multiple,1;
generic,1;
if,1;
have,1;
a,1;
multiple,1;
references,1;
Listing,1;
a,1;
a,1;
&'p,1;
->,1;
{
todo!()
}
}
fn,1;
->,1;
1-10:,1;
A,1;
generic,1;
multiple,1;
have,1;
give,1;
search,,1;
references,1;
values.,1;
string,,1;
a,1;
what
would,1;
if,1;
a,1;
would,1;
document,1;
delimiter.
This,1;
would,1;
would,1;
a,1;
String,1;
to_string—and,1;
would,1;
a,1;
concept,1;
programmers,1;
often,1;
it’s,1;
a,1;
variance
describes,1;
a,1;
a,1;
(and,1;
vice,1;
versa).,1;
a,1;
A,1;
if,1;
A,1;
at,1;
B.,1;
a,1;
Turtle,1;
a,1;
a,1;
Rust,,1;
a,1;
&'static,1;
a,1;
usually,1;
out,1;
often,1;
we,1;
have,1;
a,1;
Turtle,1;
a,1;
a,1;
Turtle,1;
“useful”,1;
Animal—a,1;
Turtle
can,1;
do,1;
likely,1;
a,1;
lives,1;
at,1;
any,1;
generally,,1;
if,1;
'b:,1;
a,1;
not,1;
use.
All,1;
have,1;
a,1;
A,1;
if,1;
a,1;
subtype
in,1;
For,1;
if,1;
a,1;
pro-
vide,1;
a,1;
&'static,1;
a,1;
&Vec<&'static,1;
a,1;
str>.
Some,1;
must,1;
exactly
the,1;
given,1;
a,1;
a,1;
cannot,1;
a,1;
T.,1;
could,1;
put,1;
a,1;
would,1;
provides,1;
same,1;
T.
The,1;
if,1;
okay,1;
arguments,1;
clearer,1;
if,1;
&'static,1;
useful,,1;
lives,1;
useful,,1;
lives,1;
take_func1(&'static,1;
str),1;
useful
This,1;
flipped,1;
Fn(T),1;
do,1;
how,1;
generic,1;
a,1;
Listing,1;
uses,1;
multiple,1;
lifetimes,1;
a,1;
MutStr<'a,,1;
s,1;
s,1;
A,1;
generic,1;
multiple,1;
using,1;
lifetimes,1;
have,1;
a,1;
of
the,1;
we,1;
Listing,1;
But,1;
if,1;
lifetimes,1;
a,1;
it’s,1;
variance.
NOTE
The,1;
at,1;
equivalent,1;
defining,1;
a,1;
must,1;
must,1;
we,1;
attempt,1;
s,1;
through,1;
a,1;
s
used,1;
shared,1;
two-lifetime,1;
before,1;
we,1;
into
issues.,1;
wants,1;
do,1;
have,1;
str.,1;
While,1;
&'static,1;
general
be,1;
any,1;
it’s,1;
a,1;
T.,1;
a,1;
attempt,1;
reports,1;
list,1;
still,1;
invariance,,1;
generic,1;
possible.,1;
requires
introducing,1;
additional,1;
chapter,1;
a,1;
shared,1;
foundation
that,1;
we,1;
have,1;
a,1;
have,1;
mys-
terious.,1;
have,1;
known,1;
bits,1;
we,1;
chapter,1;
given,1;
a,1;
image,1;
we,1;
do,1;
for
types.,1;
how,1;
how,1;
code,,1;
take,1;
a,1;
look,1;
at,1;
YPES
Now,1;
fundamentals,1;
out,1;
we’ll,1;
look,1;
at,1;
We’ll
skip,1;
how,1;
out,1;
outs,1;
existen-
tial,1;
using,1;
Memory
Every,1;
a,1;
Rust,,1;
we’ll,1;
fundamental,1;
how,1;
bits,1;
For,1;
bits,1;
notation,1;
does,1;
not,1;
assign,1;
a,1;
interpreted,1;
u8,,1;
sequenceof,1;
bits,1;
interpreted,1;
define,1;
it’s,1;
defined,1;
type.
Where,1;
does,1;
bits?,1;
how,1;
begin,1;
code,,1;
code.
Alignment
Before,1;
we,1;
how,1;
a,1;
a,1;
a,1;
take,1;
any,1;
location,1;
and
interpret,1;
stored,1;
While,1;
a,1;
theoreti-
cal,1;
a,1;
given,1;
point,1;
a,1;
at,1;
would,1;
have,1;
create,1;
pointing,1;
For,1;
must,1;
at,1;
a,1;
at,1;
must,1;
at,1;
8,1;
have,1;
CPU,1;
often,1;
a,1;
For,1;
a,1;
CPU,,1;
8,1;
word,1;
uses,1;
chunks.
Where,1;
ensure,1;
if,1;
have,1;
do,1;
rest,1;
not,1;
multiple
accesses,1;
you’re,1;
written,1;
a,1;
before,1;
a,1;
value.
Operations,1;
not,1;
misaligned
accesses,1;
For,1;
CPU,1;
require,,1;
arguments,1;
A,1;
matches,1;
would,1;
take,1;
where
20
Chapter,1;
does,1;
computed
based,1;
Built-in,1;
usually,1;
a,1;
byte-aligned,,1;
a,1;
a,1;
a,1;
8-byte-aligned.,1;
any,1;
For,1;
a,1;
a,1;
u8,,1;
a,1;
u16,,1;
a,1;
u32.
Layout
Now,1;
we,1;
how,1;
known,1;
a,1;
type.
By,1;
you’ll,1;
how,1;
out,1;
makes,1;
a,1;
point,1;
Luckily,,1;
provides,1;
a,1;
repr,1;
attribute
you,1;
a,1;
common,1;
if,1;
one
at,1;
out,1;
a,1;
how,1;
a,1;
C,1;
would,1;
out,1;
same,1;
helpful,1;
interfaces,1;
we’ll,1;
a,1;
layout,1;
matches,1;
C,1;
layout,1;
not,1;
change,,1;
contexts,1;
if,1;
you’re,1;
if,1;
same,1;
course,,1;
perfect,1;
taking,1;
steps,1;
algorithms.
NOTE
Another,1;
a,1;
layout,1;
combination,1;
representations,1;
A,1;
if,1;
does,1;
not,1;
have,1;
same,1;
look,1;
how,1;
would,1;
out,1;
a,1;
Listing,1;
do,1;
would,1;
out,1;
{
tiny:,1;
u32,
small:,1;
u16,
}
Listing,1;
logical,1;
But,1;
CPU,1;
is
given,1;
a,1;
type,
so,1;
we,1;
But,1;
if,1;
going,1;
3,1;
value
that,1;
user,1;
between
tiny,1;
padding,,1;
does,1;
take,1;
space.
For,1;
it’s,1;
a,1;
+,1;
3,1;
+,1;
byte-
aligned,,1;
immediately,1;
we,1;
have,1;
+,1;
3,1;
+,1;
+,1;
9,1;
not,1;
we,1;
be,,1;
we,1;
we,1;
short,
bringing,1;
through,1;
any,1;
Foo’s,1;
8,1;
ensure,1;
if,1;
in,,1;
a,1;
final,1;
Foo’s,1;
a,1;
at,1;
we,1;
C,1;
would,1;
hap-
pen,1;
layout,1;
if,1;
we,1;
not,1;
repr(C),1;
Listing,1;
One,1;
C,1;
we,1;
same,1;
The
default,1;
limitation,,1;
along,1;
restrictions,,1;
for
types,1;
have,1;
same,1;
types
that,1;
same,1;
same,1;
same,1;
out,1;
same,1;
using,1;
layout!
Since,1;
we,1;
we,1;
Foo’s,1;
themselves,1;
of
the,1;
does,1;
not,1;
give,1;
how,1;
out,1;
we,1;
out,1;
a,1;
out,1;
a,1;
we,1;
do,1;
not,1;
any,1;
saying,1;
we,1;
willing,1;
take,1;
accesses.,1;
common,1;
additional,1;
if,1;
have,1;
a,1;
lot,1;
if,1;
have,1;
if,1;
you’re,1;
sending
the,1;
a,1;
a,1;
network
connection.,1;
opt,1;
mind,1;
code,,1;
cases,,1;
if,1;
CPU,1;
2Sometimes,,1;
give,1;
a,1;
a,1;
technically,1;
do,1;
using,1;
attribute
#[repr(align(n))].,1;
A,1;
common,1;
ensure,1;
stored,1;
array),1;
CPU.,1;
a,1;
line;,1;
parallel,,1;
contending,1;
same,1;
cache.,1;
curious,1;
how,1;
a,1;
reference:
Tuple  Represented,1;
a,1;
same,1;
same,1;
order.
Array  Represented,1;
a,1;
additional,1;
stores,1;
variant,1;
uses,1;
a,1;
given
value,1;
holds.,1;
depends,1;
number
of,1;
Sized,1;
Wide,1;
have,1;
Sized,1;
various,1;
wants,1;
a,1;
not.,1;
Sized,1;
have,1;
a,1;
known,1;
at,1;
do,1;
slices.,1;
have,,1;
a,1;
Iterator
or,1;
a,1;
do,1;
not,1;
have,1;
a,1;
depends,1;
some
information,1;
known,1;
not,1;
at,1;
Nobody
knows,1;
a,1;
often,1;
must,1;
how,1;
space,1;
a,1;
(i32,,1;
if,1;
if,1;
Sized,1;
nearly,1;
Struct,1;
must,1;
Sized.,1;
common,1;
bound,1;
Sized,1;
opt,1;
out,1;
“may,1;
not,1;
But,1;
if,1;
have,1;
a,1;
do,1;
if,1;
object,1;
a,1;
a,1;
known,1;
a,1;
A,1;
a,1;
additional,1;
a,1;
a,1;
DST,,1;
a,1;
you.,1;
For,1;
a,1;
slice,,1;
For,1;
a,1;
we’ll,1;
Sized.,1;
a,1;
a,1;
target,1;
“complete”,1;
Arc,1;
storing,1;
a,1;
though,1;
at,1;
does,1;
a,1;
how,1;
define,1;
won’t,1;
Instead,
we’re,1;
going,1;
take,1;
a,1;
look,1;
at,1;
implemented,,1;
restrictions,1;
have,1;
some
more,1;
uses,1;
written,1;
a,1;
generic,1;
generic,1;
methods,,1;
a,1;
But,1;
have,1;
wondered,1;
generic,1;
call,1;
a,1;
a,1;
a,1;
generic,1;
you’re,1;
a,1;
copy,1;
a,1;
a,1;
copy-pastes,1;
generic,1;
generic,1;
concrete,1;
makes,1;
a,1;
full,1;
copy,1;
replaced,1;
a,1;
full,1;
copy,1;
replaced,1;
String,1;
reality,,1;
does,1;
not,1;
do,1;
a,1;
full,1;
of
the,1;
if,1;
call,1;
a,1;
Vec<i32>,,1;
copied,1;
compiled.The,1;
same,1;
generic,1;
a,1;
generic,1;
String,1;
->,1;
A,1;
generic,1;
using,1;
copy,1;
made,1;
distinct,1;
(recall
that,1;
a,1;
copy,1;
of
the,1;
body,1;
we,1;
the
address,1;
call,1;
CPU,1;
For,1;
any,1;
given,1;
pattern,,1;
But,1;
we,1;
any,1;
we,1;
have,1;
copy,1;
any
given,1;
copy,1;
we,1;
have,1;
word,1;
a,1;
little,1;
overloaded,1;
known,1;
at,1;
though,1;
written,1;
we,1;
going,1;
a,1;
generic,1;
types
is,1;
it’s,1;
generic,1;
code,,1;
it’s,1;
if,1;
at,1;
if,1;
any,1;
full,1;
if,1;
at,1;
a,1;
increase,1;
if,1;
cannot,1;
optimize,1;
code,,1;
instructions,1;
shared,1;
a,1;
generic,1;
methods,,1;
multiple,1;
F,1;
UNC,1;
a,1;
generic,1;
not,1;
type-dependent.,1;
depends,1;
to
walk,1;
point,1;
not.,1;
would,1;
the
non-generic,1;
monomorphizations,,1;
needed.
One,1;
a,1;
generic,1;
shared,1;
type-dependent,1;
helper,1;
do,1;
not,1;
pollute,1;
a,1;
single-purpose,1;
a,1;
helper,1;
instead;,1;
a,1;
a,1;
generic,1;
still,1;
alternative,1;
call,1;
a,1;
a,1;
generic,1;
we,1;
multiple,1;
Listing,1;
2-2,1;
call,1;
the
given,1;
pattern.,1;
you.,1;
&dyn,1;
must,1;
a,1;
a,1;
vtable,,1;
that
holds,1;
question,,1;
wants,1;
call,1;
a,1;
pattern,,1;
at,1;
body,1;
wants,1;
vtable,1;
concrete,1;
layout,1;
always,1;
a,1;
of
what,1;
explicit,1;
vtable,1;
like,,1;
take,1;
a,1;
look,1;
at,1;
notice,1;
we,1;
using,1;
we,1;
we,1;
at,1;
in,,1;
how,1;
space,1;
aside,1;
!Sized,,1;
not.,1;
Sized,1;
we,1;
take,1;
an
26
Chapter,1;
we,1;
a,1;
we,1;
along,1;
becomes
a,1;
word,1;
any,1;
a,1;
Arc.,1;
Listing,1;
equivalent,1;
String,1;
&dyn,1;
->,1;
2-3:,1;
A,1;
generic,1;
using,1;
combination,1;
a,1;
a,1;
vtable,1;
a,1;
For,1;
Clone,1;
trait,,1;
a,1;
we,1;
accept,1;
a,1;
Clone,1;
object,1;
won’t,1;
consider
the,1;
a,1;
generic,1;
(so,1;
call,1;
a,1;
a,1;
Extend,,1;
vtable;
there,1;
would,1;
have,1;
not,1;
object-safe,1;
a,1;
generic,1;
cannot,1;
have,1;
does,1;
not,1;
would,1;
not,1;
execute.
When,1;
mentions,1;
Sized.,1;
a,1;
bound,1;
not,1;
through
a,1;
object,1;
(since,1;
would,1;
!Sized).,1;
bound,1;
a
trait,1;
place
it,1;
a,1;
specific,1;
through,1;
a,1;
a,1;
Sized,1;
bound,1;
if,1;
a,1;
it’s,1;
multiple,1;
methods,,1;
CPU,1;
cache.,1;
specific,1;
do,1;
Listing,1;
2-2,1;
a,1;
call,1;
to
the,1;
through,1;
vtable—it,1;
any,1;
does,1;
not,1;
call,1;
a,1;
object,1;
vtable,,1;
a,1;
calling
the,1;
you’re,1;
given,1;
a,1;
though,,1;
a,1;
best,1;
you
use,1;
do,1;
if,1;
use
static,1;
not.,1;
you’re,1;
final,1;
code,,1;
Dynamic,1;
often,1;
out,1;
generic,1;
at,1;
a,1;
it’s,1;
usually,1;
generic,1;
generic,1;
not,1;
immediately,1;
is
quite,1;
if,1;
of
the,1;
a,1;
given,1;
a,1;
generic,1;
often,1;
not,1;
multiple,1;
more
simply,1;
a,1;
generic,1;
trait,,1;
must,1;
always,1;
generic,1;
any,1;
messy
and,1;
a,1;
generic,1;
a,1;
trait,,1;
must,1;
reflect,1;
a,1;
a,1;
given,1;
deciding,1;
leading
to,1;
multiple,1;
same,1;
type—for,1;
PartialEq,1;
of
the,1;
generic,1;
trait,,1;
live
in,1;
do,1;
not,1;
trait,,1;
cannot,1;
multiple,1;
multiple,1;
types.
Coherence,1;
on.,1;
any,1;
given,1;
would,1;
if,1;
any,1;
a,1;
won’t,1;
Neither,1;
other,,1;
cannot,1;
same,1;
if,1;
not,1;
at
all,,1;
we,1;
have,1;
depend,1;
other,,1;
a,1;
shared,1;
always,1;
choice.
A,1;
would,1;
ensure,1;
crate
that,1;
a,1;
implementations,1;
if,1;
trait,,1;
elsewhere.,1;
would,1;
unless
you,1;
defining,1;
crate.,1;
saying,1;
problem,1;
introduces,1;
a,1;
a,1;
cannot,1;
implementations,1;
Ideally,,1;
we,1;
would,1;
some
set,1;
desire,1;
desire,1;
implementations,1;
code.
NOTE
Upstream,1;
depends,1;
depends,1;
direct,1;
do,1;
a,1;
Rust,,1;
says,1;
a,1;
a,1;
crate.,1;
for
your,1;
not,1;
implementations.
This,1;
far;,1;
not,1;
a,1;
number
of,1;
additional,1;
be
aware,1;
a,1;
on.,1;
a,1;
implementation—it
is,1;
not,1;
a,1;
Only,1;
a,1;
a,1;
a,1;
a,1;
not,,1;
a,1;
could,1;
suddenly,1;
a,1;
it’s,1;
if,1;
Box.,1;
For,1;
fundamental,1;
not,1;
before,1;
would,1;
not,1;
a,1;
a,1;
a,1;
a,1;
fundamental,1;
a,1;
we,1;
a,1;
a,1;
does,1;
not,1;
type,
yet,1;
a,1;
could,1;
through,1;
a,1;
in
the,1;
cannot,1;
a,1;
anyway.
To,1;
a,1;
specific,1;
circumstances.,1;
a,1;
given
impl<P1..=Pn>,1;
if,1;
at,1;
a,1;
before,1;
generic,1;
Generic,1;
A,1;
if,1;
appears,1;
as
a,1;
not,1;
if,1;
(just,1;
appears,1;
a,1;
fundamental,1;
the
implementations,1;
Listing,1;
MyType
impl<T>,1;
Vec<T>
Listing,1;
implementations,1;
types
30
Chapter,1;
implementations,1;
Listing,1;
2-5,1;
ForeignTrait,1;
T
impl<T>,1;
T
impl<T>,1;
From<Vec<T>>,1;
T
impl<T>,1;
T
impl<T>,1;
Vec<T>
Listing,1;
Invalid,1;
implementations,1;
a,1;
a,1;
a,1;
non-breaking,1;
if,1;
at,1;
a,1;
valid,,1;
could,1;
could,1;
a,1;
would,1;
before,1;
breaks,1;
combined.
Trait,1;
it’s,1;
must,1;
Hash,1;
+,1;
given,1;
thread::spawn
must,1;
+,1;
+,1;
generic,1;
almost,1;
cannot,1;
do
much,1;
generic,1;
you’ll,1;
look,1;
at,1;
foremost,,1;
do,1;
not,1;
have,1;
generic,1;
The
bounds,1;
restrictions,1;
do,1;
not,1;
include
generic,1;
a,1;
though,1;
Clone,1;
always,1;
and
contains,1;
generic,1;
do,1;
not,1;
not,1;
needlessly,1;
bounds.,1;
For,1;
if,1;
method
wants,1;
a,1;
S>,1;
generic,1;
a,1;
out,1;
S:,1;
+,1;
could,1;
using,1;
requirement,1;
significantly
reduce,1;
if,1;
call,1;
AIT
While,1;
bounds,
you,1;
aware,1;
subtlety,1;
how,1;
often,1;
often,1;
not,1;
always.,1;
For,1;
if,1;
we,1;
Clone,1;
Arc,1;
Clone,1;
Clone,1;
if,1;
big,1;
does,1;
a,1;
bound,1;
we,1;
problem,1;
a,1;
little,1;
clearer.
Imagine,1;
how,1;
a,1;
user,1;
a,1;
cannot,1;
writing,,1;
though,1;
may
change,1;
produces,1;
and
produces,1;
generic,1;
if,1;
themselves,1;
IntoIterator.,1;
bounds
like,1;
a,1;
using,1;
syntax
Type::AssocType.,1;
For,1;
we,1;
I’s,1;
using,1;
multiple,1;
same,1;
if,1;
provides,1;
generic,1;
(and,1;
not,1;
uses,1;
a,1;
bound,1;
talks,1;
references,1;
a,1;
have,1;
a,1;
generic,1;
cases,,1;
any,1;
known,1;
a,1;
it’s,1;
Fn,1;
For,1;
generic,1;
a,1;
a,1;
a,1;
->,1;
a,1;
“any,1;
a,1;
for<'a>
Fn(&'a,1;
->,1;
any,1;
bound,1;
must,1;
The
Rust,1;
Fn,1;
references,1;
covers,1;
majority,1;
feature.,1;
explicit,1;
writing,,1;
uses,1;
does,1;
bring,1;
Listing,1;
any,1;
->,1;
{
f.debug_list().entries(self).finish()
}}
Listing,1;
2-6:,1;
generic,1;
any,1;
could,1;
any,1;
would,1;
work.”,1;
course,,1;
a,1;
debug
implementation,,1;
we,1;
multiple,1;
a,1;
Hash,1;
a,1;
Clone,1;
cloned
by,1;
a,1;
But,1;
not,1;
Some,1;
a,1;
a,1;
cannot,1;
a,1;
For,1;
if,1;
a,1;
trait,,1;
does,1;
not,1;
trait,,1;
it’s,1;
a,1;
a,1;
std::marker,1;
(all,1;
does,1;
not,1;
capture,1;
not,1;
call,1;
a,1;
assumes,1;
given,1;
a,1;
sepa-
rate,1;
would,1;
have,1;
assumption.,1;
would,1;
assumption,1;
carefully,,1;
we,1;
on.,1;
have,1;
for,,1;
a,1;
a,1;
a,1;
user,1;
misuse
an,1;
For,1;
a,1;
have,1;
yet.,1;
could,1;
a,1;
generic,1;
create,1;
user,1;
SshConnection<Unauthe
nticated>.,1;
a,1;
The
­connect,1;
a,1;
it’s,1;
look,1;
at,1;
have,1;
in
the,1;
body,1;
a,1;
generic,1;
arguments,1;
appears,1;
usually,1;
infer,1;
argu-
ments,1;
(and,1;
types),1;
explicitly
name,1;
a,1;
have,1;
at,1;
known
points,1;
it’s,1;
not,1;
always,1;
fully,1;
a,1;
For,1;
if,1;
a,1;
closure,1;
a,1;
async,1;
a,1;
does,1;
not,1;
have,1;
a,1;
have,1;
All,1;
marked
as,1;
async,1;
a,1;
have,1;
does,1;
not,1;
give,1;
on.,1;
the
return,1;
else.
NOTE
Technically,,1;
nothing
else.,1;
through,1;
look,1;
at,1;
name:,1;
we,1;
assert-
ing,1;
exists,1;
concrete,1;
matches,1;
figure,1;
out,1;
body,1;
a,1;
it’s,1;
generic,1;
For,1;
impl
ToString),1;
foo<S:,1;
have,1;
For,1;
imagine,1;
you’re,1;
of
the,1;
do,1;
not,1;
define,1;
a,1;
IntoIter.
Instead,,1;
give,1;
using,1;
maps,1;
a,1;
they
allow,1;
a,1;
somewhere—iterators
and,1;
common,1;
to
hide,1;
concrete,1;
Users,1;
implements,,1;
concrete,1;
does,1;
it
also,1;
chapter,1;
a,1;
at,1;
how,1;
how,1;
for
writing,1;
code,,1;
interfaces,,1;
reasoning,1;
plays,1;
how,1;
interfaces,,1;
we’ll,1;
in
the,1;
how,1;
small,
has,1;
usually,1;
a,1;
a,1;
have,1;
a,1;
number
of,1;
interfaces:,1;
trait,,1;
rest,1;
codebase,1;
you’ll,1;
how,1;
using,1;
maintaining,1;
possible.
In,1;
chapter,1;
we’ll,1;
look,1;
at,1;
interfaces,1;
Rust,,1;
using,1;
boil,1;
four,1;
principles:,1;
interfaces,1;
obvious,,1;
constrained.,1;
reliable,1;
taking,1;
a,1;
look,1;
at,1;
follow,,1;
a,1;
Many,1;
chapter,1;
clippy,1;
if,1;
encourage,1;
through,1;
SemVer,1;
not,1;
a,1;
change
in,1;
known,1;
Law,1;
Least
Astonishment,,1;
a,1;
lot,1;
software,1;
interfaces,1;
interfaces,1;
if,1;
user,1;
usually,1;
going,1;
immediately,1;
intuitive
in,1;
things,1;
user,1;
likely,1;
have,1;
a,1;
out,1;
things,1;
specific,1;
a,1;
interfaces,1;
we’ll,1;
look,1;
at,1;
how,1;
common,1;
user,1;
out.
Naming,1;
user,1;
through,1;
names;,1;
will
immediately,1;
infer,1;
things,1;
methods,,1;
vari-
ables,,1;
reuses,1;
user,1;
A,1;
A,1;
likely,1;
A,1;
appears,1;
various,1;
common,1;
same,1;
things,1;
do,1;
things,1;
things,1;
a,1;
same,1;
if,1;
if
your,1;
SomethingError,1;
does,1;
not,1;
user,1;
likely,1;
how,1;
have,1;
how,1;
we,1;
user,1;
we,1;
3Common,1;
Types
Users,1;
assumption,1;
any,1;
Clone.,1;
we,1;
if,1;
we,1;
do,1;
immediately.
Because,1;
Users,1;
a,1;
a,1;
would,1;
a,1;
reasonable
implementation,1;
if,1;
often,1;
best,1;
mind,1;
any,1;
generic,1;
could,1;
various,1;
debug_,1;
extent,,1;
a,1;
does,1;
not,1;
a,1;
A,1;
not,1;
A,1;
not,1;
shared,1;
through,1;
Arc,1;
placed
in,1;
a,1;
variable.,1;
Users,1;
have,1;
nearly,1;
a,1;
if,1;
ensure,1;
cannot,1;
them,
make,1;
nearly,1;
Clone,1;
sense
to,1;
cannot,1;
call,1;
out,1;
usually,1;
create,1;
(and,1;
surprised.
One,1;
step,1;
hierarchy,1;
com-
parison,1;
traits:,1;
Ord.,1;
PartialEq,1;
at,1;
point,1;
inevitably,1;
have,1;
assert_eq!.,1;
would,1;
same,1;
PartialEq,1;
Hash,1;
not,1;
as
broadly,,1;
a,1;
user,1;
a,1;
a,1;
deduplicate,1;
using,1;
any,1;
bounds.,1;
additional,1;
if,1;
you’re,1;
those
semantics,1;
makes,1;
sense,1;
serde,1;
serde
_derive,1;
serde,1;
a,1;
not,1;
a,1;
dependency,1;
a,1;
serde,1;
serde,1;
opts,1;
things,1;
Copy,1;
do,1;
not,1;
if,1;
have,1;
call,1;
Copy,1;
moving,1;
given,1;
ties,1;
observation:,1;
a,1;
A,1;
out,1;
a,1;
String,,1;
Copy,1;
have,1;
remove,1;
Copy,1;
implementation,,1;
a,1;
incom-
patible,1;
have,1;
remove,1;
a,1;
Clone,1;
a,1;
onerous,1;
does,1;
not,1;
references,1;
a,1;
cannot,1;
call
fn,1;
a,1;
if,1;
take,1;
cannot,1;
Nonetheless,,1;
a,1;
&self,1;
define,1;
a,1;
trait,,1;
you’ll,1;
usually,1;
pro-
vide,1;
implementations,1;
&T,1;
to
implement,1;
depending,1;
of
Trait,1;
have.,1;
Many,1;
have,1;
user.
Iterators,1;
you’ll,1;
often,1;
specifically,1;
implementations,1;
references,1;
a,1;
For,1;
any,1;
&mut
MyType,1;
makes,1;
out,1;
would,1;
does,1;
not,1;
have,1;
object,1;
Deref
trait,1;
a,1;
little,1;
have,1;
a,1;
call,1;
if,1;
feels,1;
great.
40
Chapter,1;
a,1;
you’ll,1;
call,1;
using,1;
operator.,1;
not,1;
any,1;
a,1;
For,1;
can
easily,1;
remove,1;
have,1;
trait,,1;
feels,1;
a,1;
a,1;
beast.,1;
tailored,1;
a,1;
multiple,1;
identical,1;
same,1;
have,1;
For,1;
a,1;
either,1;
a,1;
a,1;
While,1;
have,1;
would,1;
not,1;
Borrow’s
additional,1;
requirement,1;
target,1;
Ord
exactly,1;
same,1;
a,1;
imple-
mentation,1;
&T,,1;
makes,1;
accept,1;
either,1;
a,1;
given,1;
confusing,1;
take,1;
For,1;
given,1;
a,1;
not,1;
transparently,1;
call,1;
on
some,1;
known,1;
have,1;
a,1;
though,1;
a,1;
slices,1;
won’t,1;
a,1;
any,1;
But,1;
if
your,1;
a,1;
any,1;
cases,,1;
favor,1;
T).,1;
always,1;
frobnicate,1;
itself.
Flexible
Every,1;
a,1;
consists,1;
a,1;
a,1;
The
requirements,1;
restrictions,1;
how,1;
how,1;
A,1;
rule
of,1;
restrictions,1;
restrictions,1;
a,1;
likely,1;
break,1;
Relaxing,1;
restrictions,1;
additional,1;
usually,1;
Rust,,1;
restrictions,1;
usually,1;
For,1;
String),1;
->,1;
->,1;
Cow<'_,,1;
->,1;
Similar,1;
contracts
These,1;
take,1;
a,1;
a,1;
do,1;
of
the,1;
String,1;
String,,1;
we,1;
cannot,1;
a,1;
compatible,1;
relaxes,1;
a,1;
string,,1;
user,1;
give,1;
a,1;
give,1;
a,1;
meaning
it,1;
either,1;
a,1;
String,,1;
depending,1;
always,1;
a,1;
we,1;
must,1;
a,1;
if,1;
have,,1;
a,1;
String,1;
must,1;
a,1;
call,1;
a,1;
a,1;
a,1;
string,,1;
only
that,1;
a,1;
a,1;
string.
None,1;
a,1;
copy.,1;
take,1;
a,1;
Cow,1;
a,1;
what
I,1;
take,1;
away,1;
about
what,1;
section,1;
give,1;
often,1;
requirement,1;
must,1;
must,1;
a,1;
must,1;
give,1;
a,1;
concrete,1;
any,1;
rather
than,1;
a,1;
Listing,1;
relaxing.,1;
One,1;
fully,1;
generic,1;
bounds
you,1;
if,1;
would,1;
generic,1;
would,1;
to
read,1;
not,1;
a,1;
given,1;
A,1;
generic,1;
if,1;
a,1;
user,1;
concrete,1;
generic,1;
combination,1;
generic,1;
through,1;
making,1;
arguments
generic,1;
overly,1;
we,1;
how,1;
at,1;
a,1;
arguments,1;
take,1;
a,1;
generic,1;
uses,1;
dispatch.,1;
For,1;
could,1;
take,1;
&dyn,1;
do,1;
though,,1;
a,1;
things,1;
First,,1;
making,1;
behalf,1;
cannot,1;
opt,1;
out,1;
dispatch.,1;
But,1;
if,1;
a,1;
user,1;
along,1;
who,1;
wants,1;
a,1;
is
called,1;
a,1;
hot,1;
a,1;
breaker.,1;
at,1;
writing,
using,1;
have,1;
a,1;
bound
like,1;
For,1;
how,1;
a,1;
vtable,,1;
cannot,1;
&dyn,1;
Hash,1;
+,1;
generics,,1;
themselves,1;
a,1;
reverse,1;
not,1;
if,1;
take,1;
a,1;
tempting,1;
interfaces,1;
concrete,1;
generic,1;
mind,1;
not,1;
a,1;
While,1;
AsRef<[usize]>,,1;
still,1;
if,1;
foo,1;
could,1;
a,1;
knows
that,1;
AsRef<[usize]>.,1;
could,1;
multiple,1;
change,,1;
compile!
Object,1;
define,1;
a,1;
trait,,1;
not,1;
object-safe,1;
of
the,1;
types
that,1;
a,1;
common,1;
using,1;
prefer,1;
object-safe,1;
if,1;
at,1;
a,1;
using,1;
taking,1;
object
safety,1;
must,1;
have,1;
a,1;
generic,1;
if,1;
generic,1;
arguments,1;
a,1;
Sized,1;
makes,1;
call,1;
concrete,1;
(and,1;
not,1;
through,1;
Trait).,1;
additional,1;
concrete,1;
how,1;
willing,1;
object,1;
My,1;
how,1;
makes,1;
a,1;
it’s,1;
likely,1;
should
work,1;
object,1;
if,1;
case
makes,1;
For,1;
would,1;
not,1;
FromIterator,1;
does,1;
not,1;
take,1;
a,1;
object,1;
useless,1;
a,1;
object,1;
would,1;
do,1;
a,1;
object,1;
useless,1;
a,1;
all
you,1;
do,1;
a,1;
object,1;
But,1;
out,1;
specifically,1;
a,1;
collection,1;
can
44
Chapter,1;
vtable,1;
Effectively,,1;
a,1;
object,1;
a,1;
a,1;
compatible,1;
a,1;
a,1;
implementation,,1;
not,1;
ver-
sion,1;
nearly,1;
trait,,1;
define,1;
Rust,,1;
a,1;
its
data.,1;
have,1;
far-reaching,1;
decisions,1;
often,1;
take,1;
must,1;
must,1;
rather
than,1;
taking,1;
cloning,1;
question.
On,1;
if,1;
data,
it,1;
references,1;
One,1;
common,1;
copy,1;
through,1;
Copy,1;
would,1;
copy,1;
course,,1;
things,1;
often,1;
not.,1;
For,1;
take,1;
if,1;
sequences.,1;
Cow,1;
references,1;
if,1;
if,1;
lifetimes,1;
a,1;
a,1;
take,1;
do,1;
before,1;
a,1;
Blocking,1;
centered,1;
often,1;
closing,1;
implementation.,1;
a,1;
have,1;
a,1;
communicate,1;
user,1;
A,1;
problem,1;
arises,1;
code,,1;
we,1;
called,,1;
shutting,1;
down,,1;
we,1;
have,1;
do,1;
could,1;
to
start,1;
code,,1;
we,1;
8.
There,1;
perfect,1;
we
do,,1;
inevitably,1;
we,1;
through,1;
at,1;
we,1;
on.,1;
still,1;
we,1;
a,1;
do,1;
if,1;
we,1;
we,1;
we,1;
a,1;
alternative,1;
who,1;
do,1;
explicit,1;
usually,1;
a,1;
any,1;
(using,1;
->,1;
Result<_,,1;
asynchrony,1;
(using,1;
async
fn),1;
A,1;
user,1;
that
method,1;
tear,1;
any,1;
explicit,1;
a,1;
explicit,1;
First,,1;
out,1;
any,1;
still,1;
explicit,1;
not,1;
call,1;
explicit,1;
(because,1;
a,1;
a,1;
call,1;
inner
type’s,1;
explicit,1;
if,1;
not,1;
does,1;
not,1;
take,1;
must,1;
always,1;
Some,1;
not,1;
called)
to,1;
do,1;
For,1;
a,1;
friend,1;
if,1;
have,1;
if,1;
must
wrap,1;
nearly,1;
those
fields,1;
a,1;
option,1;
also
use,1;
take,1;
at,1;
ensure,1;
take,1;
call
take,1;
multiple,1;
exhibit,1;
things,1;
happen.
Ultimately,,1;
whichever,1;
your
application,1;
would,1;
going,1;
if,1;
yourself,1;
a,1;
if,1;
code,,1;
do,1;
unlikely,1;
won’t,1;
it’s,1;
okay,1;
call,1;
foo,1;
calling
bar,,1;
it’s,1;
call,1;
at,1;
Only,1;
if,1;
makes,1;
going,1;
reach
for,1;
primary
techniques,1;
at,1;
disposal,1;
look,1;
at,1;
take,1;
user,1;
a,1;
user,1;
a,1;
are
they,1;
documentation.
Documentation
The,1;
step,1;
making,1;
interfaces,1;
could,1;
book,1;
how,1;
focus,1;
Rust-specific,1;
document,1;
any,1;
do,1;
user,1;
doing,1;
signature.,1;
Panics,1;
a,1;
if,1;
document,1;
if,1;
might
return,1;
error,,1;
document,1;
For,1;
must,1;
call,1;
a,1;
level.,1;
methods,,1;
give,1;
user,1;
a,1;
how,1;
a,1;
understanding,1;
types
do,1;
give,1;
user
a,1;
point,1;
often,1;
kind
of,1;
tends,1;
together,1;
show,1;
yes,,1;
the
length,1;
unlikely,1;
user,1;
and
functions,1;
a,1;
makes,1;
user,1;
get
a,1;
sense,1;
group,1;
related,1;
interlink
items.,1;
A,1;
talks,1;
should
link,1;
user,1;
likely,1;
not,1;
not,1;
clutter,1;
possible.,1;
to
external,1;
explain,1;
concepts,,1;
or
other,1;
have,1;
blog,1;
whitepapers,1;
if,1;
any,1;
user,1;
listed,1;
discoverable,1;
point,1;
user,1;
commonly,1;
methods.
Type,1;
System,1;
ensure,1;
interfaces,1;
obvi-
ous,,1;
have,1;
at
your,1;
disposal,1;
interfaces,1;
likely,1;
repre-
sent,1;
meaning,1;
a,1;
not,1;
if,1;
chances
48
Chapter,1;
user,1;
distinct,1;
user,1;
cannot,1;
yelling,1;
at,1;
if,1;
attempt,1;
pass
DryRun::Yes,1;
not,1;
For,1;
a,1;
a,1;
a,1;
could,1;
arguments,1;
have,1;
closely,1;
related,1;
a,1;
Consider,,1;
instance,,1;
Rocket,1;
a,1;
Some,1;
Rocket,1;
rocket
is,1;
in,,1;
sense,1;
situations.,1;
a,1;
if,1;
not,1;
if,1;
could,1;
would,1;
at,1;
pos-
sible,1;
Listing,1;
we,1;
a,1;
generic,1;
{
2,1;
{}
impl,1;
launch(self),1;
->,1;
Rocket<Launched>,1;
Rocket<Launched>,1;
self),1;
self),1;
->,1;
->,1;
­provides—
so,1;
we,1;
a,1;
we,1;
Rocket,1;
a,1;
a,1;
ground,1;
things,1;
always,1;
do,1;
in,,1;
we,1;
a,1;
generic,1;
5.,1;
it’s,1;
not,1;
user,1;
call,1;
a,1;
at,1;
have,1;
made,1;
unrepresentable.
This,1;
extends,1;
well;,1;
if,1;
function
ignores,1;
a,1;
a,1;
given,1;
Boolean,1;
arguments,1;
variant,1;
(and,1;
variant,1;
two.,1;
a,1;
powerful,1;
making,1;
interfaces,1;
any,1;
trait,,1;
a,1;
if,1;
trait,,1;
does,1;
not,1;
have
seen,1;
if,1;
a,1;
a,1;
assign,1;
a,1;
not,1;
if,1;
user,1;
a,1;
if,1;
not,1;
using,1;
user,1;
depend,1;
interface,
whether,1;
feature.,1;
publicly,1;
have,1;
a,1;
think
carefully,1;
before,1;
you’re,1;
existing
one,,1;
not,1;
break,1;
a,1;
in
semantic,1;
obvious,,1;
a,1;
we’ll,1;
thornier
subtle,1;
how,1;
how,1;
flexible,1;
a,1;
almost,1;
break,1;
you’ll,1;
take,1;
possible.,1;
have,,1;
freedom,1;
have,1;
things,1;
depend,1;
Listing,1;
given,1;
interface
pub,1;
user,1;
if,1;
a,1;
private,1;
private,,1;
still,1;
break,1;
Listing,1;
3-4.
//,1;
interface
pub,1;
pub,1;
user,1;
lib::Unit),1;
->,1;
a,1;
a,1;
private,1;
break,1;
user,1;
code,,1;
match,1;
user,1;
cannot,1;
recognizes,1;
though,1;
user,1;
cannot,1;
A,1;
arises,1;
if,1;
we,1;
a,1;
a,1;
regular,1;
if,1;
themselves,1;
any,1;
provides,1;
any,1;
constructors,1;
field1:,1;
}),1;
matches,1;
a,1;
..),1;
a,1;
if,1;
suspect,1;
you’re,1;
likely,1;
a,1;
does,1;
user,1;
taking,1;
away,1;
matches,
so,1;
if,1;
a,1;
given,1;
likely,1;
stable.
Trait,1;
Implementations
As,1;
you’ll,1;
a,1;
given,1;
a,1;
given,1;
we,1;
do,1;
not,1;
implementations,1;
have,1;
a,1;
a,1;
a,1;
a,1;
type—in,1;
cases,,1;
a,1;
implementation,,1;
a,1;
a,1;
a,1;
change,,1;
a,1;
a,1;
problem,,1;
have,1;
imple-
menting,1;
any,1;
crate1,1;
not,1;
depends,1;
crate1,1;
}
impl,1;
..,1;
main(),1;
Implementing,1;
a,1;
crate1,1;
a,1;
suddenly,1;
call,1;
ambiguous.,1;
implementations,1;
if,1;
uses,1;
mind,1;
if,1;
a,1;
for.
Most,1;
a,1;
a,1;
a,1;
method
signature,1;
breaks,1;
a,1;
breaks,1;
Adding
a,1;
a,1;
though,,1;
we,1;
have,1;
a
tool,1;
A,1;
not,1;
implemented,,1;
immediately,1;
makes,1;
a,1;
a,1;
a,1;
trait,,1;
implementations,1;
a,1;
defined,1;
cannot,1;
have,1;
a,1;
commonly,1;
traits—traits,1;
that
provide,1;
implementations,1;
a,1;
if,1;
does,1;
not,1;
sense,1;
a,1;
severely,1;
the
trait,,1;
Listing,1;
how,1;
a,1;
how,1;
still,1;
defining,1;
..,1;
}
mod,1;
{}
}
impl<T>,1;
CanUseCannotImplement,1;
3-6:,1;
a,1;
implementations,1;
a,1;
private,,1;
a,1;
supertrait,1;
supertrait,1;
a,1;
private,1;
cannot,1;
we,1;
trait.
NOTE
If,1;
do,1;
a,1;
document,1;
do,1;
ways.,1;
through,1;
any,1;
any,1;
a,1;
For,1;
if,1;
a,1;
a,1;
a,1;
dependency,1;
A,1;
user,1;
depends,1;
depend,1;
dependency,1;
provides,1;
same,1;
But,1;
if,1;
dependency,,1;
Listing,1;
3-7,1;
this.
//,1;
->,1;
..,1;
EmptyIterator,1;
itercrate::Empty<()>,1;
Re-exports,1;
moves,1;
change,,1;
though,1;
have,1;
cannot,1;
assign,1;
making,1;
a,1;
it’s,1;
often,1;
best,1;
pattern,,1;
cases,,1;
using,1;
have,1;
not,1;
change,,1;
does,1;
not,1;
uses,1;
using,1;
not,1;
have,1;
same,1;
take,1;
a,1;
imagine,1;
suddenly,1;
seman-
tics,1;
depending,1;
using,1;
2.0!,1;
written,1;
mind,1;
won’t,1;
problem,1;
tends,1;
likely,1;
have,1;
at,1;
not,1;
level,
so,1;
a,1;
a,1;
not,1;
A,1;
a,1;
a,1;
situation.,1;
idea
is,1;
if,1;
stays,1;
same,1;
a,1;
(from,1;
releasing,1;
release,1;
a,1;
minor,1;
depends,1;
a,1;
doing,1;
you’re,1;
a,1;
T
across,1;
any,1;
depends,1;
a,1;
vice,1;
opt,1;
be.
Auto-Traits
Rust,1;
a,1;
depending,1;
though,1;
UnwindSafe
54
Chapter,1;
have,1;
a,1;
nearly,1;
not,1;
apply.,1;
if,1;
have,1;
a,1;
A,1;
a,1;
A,1;
a,1;
often,1;
not,1;
discov-
ered,1;
a,1;
user,1;
before,1;
it’s,1;
include
some,1;
Listing,1;
a
test,1;
look,1;
Sized,1;
+,1;
+,1;
+,1;
normal_types(),1;
a,1;
a,1;
does,1;
not,1;
any,1;
code,,1;
made,1;
broke,1;
ITEMS,1;
FROM,1;
a,1;
making,1;
often,1;
user,1;
debate.,1;
if
user,1;
containing,1;
a,1;
not,1;
not.,1;
not,1;
though,1;
yes,,1;
still,1;
documented!
Designing,1;
chapter,1;
a,1;
it’s,1;
abstraction,1;
crate.,1;
a,1;
lot,1;
interfaces,1;
obvious,,1;
constrained.,1;
we,1;
how,1;
programs,,1;
we’ll,1;
look,1;
at,1;
by
exploring,1;
a,1;
representa-
tion,1;
we’ll,1;
look,1;
at,1;
various,1;
best,1;
handling,1;
at,1;
writing,,1;
not,1;
a,1;
approach.,1;
chapter,1;
specific,1;
how,1;
any,1;
returned.,1;
Will,1;
happened,1;
minutiae,1;
went
wrong,,1;
log,1;
we,1;
have,1;
look,1;
at,1;
likely,1;
does,1;
how,1;
we,1;
have,1;
enumeration,1;
either,1;
have,1;
error
conditions,1;
a,1;
Let’s,1;
we’ll,1;
a,1;
some
input,1;
std::io::copy.,1;
user
provides,1;
copy,1;
it’s,1;
either,1;
at,1;
point,1;
copy,1;
user,1;
likely,1;
whether
it,1;
For,1;
server,,1;
if,1;
a,1;
a,1;
disk,1;
ejected,,1;
if,1;
maybe,1;
the
server,1;
still,1;
a,1;
we,1;
user,1;
appropriately,,1;
we,1;
variant
representing,1;
a,1;
error,,1;
Listing,1;
4-1.
pub,1;
variant,1;
making,1;
take,1;
a,1;
steps,1;
rest,1;
ecosystem.,1;
First,,1;
trait,,1;
provides,1;
common,1;
Error::source,,1;
provides,1;
a,1;
commonly,1;
a,1;
a,1;
For,1;
type,
58
Chapter,1;
4the,1;
we,1;
match,1;
if,1;
give,1;
a,1;
folded,1;
mes-
sages.,1;
display,1;
lowercase,1;
other,,1;
reports.,1;
descriptive,1;
including,1;
error,,1;
port,1;
like,,1;
#[derive(Debug)],1;
usually,1;
code,,1;
references,1;
favor,1;
if,1;
not,1;
it’s,1;
almost,1;
a,1;
common,1;
course,,1;
not,1;
if,1;
particu-
lar,1;
not,1;
it’s,1;
aware
of,1;
before,1;
RefCell<bool>,1;
call,1;
we’ll,1;
shortly.
Opaque,1;
a,1;
image,1;
a,1;
vari-
ous,1;
image,1;
user,1;
figure,1;
out,1;
how,1;
must,1;
the
cause.,1;
But,1;
not—the,1;
if,1;
a,1;
makes,1;
a,1;
little,1;
Doing,1;
would,1;
increase,1;
you.,1;
a,1;
private,1;
error,,1;
could,1;
a,1;
+,1;
+,1;
+,1;
does,1;
not,1;
introspect,1;
at,1;
Deciding,1;
how,1;
a,1;
interesting
about,1;
little,1;
option,1;
if
it,1;
user—for,1;
a,1;
a,1;
program.,1;
But,1;
if,1;
a,1;
a,1;
status,1;
code,,1;
to
expose,1;
through,1;
a,1;
concrete,1;
For,1;
often,1;
a,1;
Arc.,1;
unlikely,1;
within.
One,1;
using,1;
addi-
tional,1;
often,1;
compose,1;
nicely,,1;
a,1;
+,1;
?,1;
error
types,1;
common,1;
bound,1;
+,1;
+,1;
+,1;
a,1;
section,1;
it’s,1;
worrying,1;
serves,1;
purpose:,1;
taking,1;
a,1;
specific,1;
it’s,1;
a,1;
dynamic
languages,1;
often,1;
a,1;
user,1;
a,1;
a,1;
concrete,1;
For,1;
user,1;
take,1;
a,1;
if,1;
a,1;
would,1;
not,1;
take,1;
same,1;
any,1;
a,1;
Error::downcast_ref,1;
a,1;
which
tells,1;
user,1;
not,1;
if,1;
we,1;
not,1;
we,1;
take,1;
away,1;
do,1;
introspection,1;
a,1;
generally,,1;
types),1;
4its,1;
if,1;
foo,1;
returns
lib::MyError,1;
a,1;
would,1;
foo,1;
a,1;
a,1;
have,1;
written,1;
assumes,1;
My,1;
(and,1;
not,1;
a,1;
does,1;
not,1;
particu-
lar,1;
+,1;
...>,1;
attractive,1;
does,1;
not,1;
Error.,1;
own
BoxError,1;
does,1;
wonder,1;
how,1;
Error::downcast_ref,1;
safe.,1;
how,1;
a,1;
given,1;
a,1;
compiler-supported,1;
a,1;
any,1;
a,1;
implementation,,1;
blocks,,1;
concrete,1;
provides,1;
infor-
mation,1;
vtable,1;
imple-
mentation,1;
a,1;
cannot,1;
any,1;
if,1;
they
fail.,1;
have,1;
a,1;
a,1;
usually,1;
a,1;
handled,1;
exceptionally.,1;
usually,1;
not,1;
a,1;
Result,,1;
cases,,1;
handled.
Error,1;
mind,1;
does,1;
not,1;
means
that,1;
cannot,1;
a,1;
a,1;
For,1;
often,1;
define,1;
imple-
ment,1;
cases.
Some,1;
functions,,1;
a,1;
continuously,1;
a,1;
match,1;
a,1;
signature.,1;
For,1;
provides,1;
written,1;
syntax.,1;
a,1;
cannot,1;
entering,1;
infinite,1;
a,1;
Result,,1;
have,1;
never
be,1;
a,1;
returns
Result<T,,1;
Because,1;
variant,1;
a,1;
optimize,1;
code
with,1;
not,1;
any,1;
a,1;
does,1;
not,1;
listed.,1;
curious,1;
+,1;
+,1;
it’s,1;
not,1;
a,1;
a,1;
Any,,1;
not,1;
a,1;
response,1;
a,1;
panic;,1;
if,1;
a,1;
panicked.,1;
it’s,1;
not,1;
do,1;
either,1;
using,1;
be
any,1;
though,1;
it’s,1;
usually,1;
a,1;
?,1;
a,1;
early,,1;
working
easily,1;
But,1;
a,1;
sleeve,1;
First,,1;
?,1;
through,1;
?,1;
any,1;
makes,1;
through,1;
?,1;
not,1;
particu-
lar,1;
usually,1;
have,1;
if,1;
we,1;
have,1;
we,1;
vice,1;
a,1;
have,1;
have,1;
two-way,1;
have,1;
defined,1;
standard
library.,1;
From<Vec<T>>,1;
if,1;
Into,
you,1;
would,1;
have,1;
Only,1;
change,,1;
was
necessary,1;
have,1;
written,1;
have,1;
if,1;
we,1;
could,1;
scratch,1;
today.,1;
situations.,1;
For,1;
if,1;
you’re,1;
a,1;
a,1;
a,1;
Into<Foo>),1;
conversely,,1;
a,1;
a,1;
identifier,,1;
would,1;
write
Ident::from("foo"),1;
Into<Ident>>::into("foo")?,1;
we,1;
do,1;
have,1;
wonder,1;
today.,1;
bounds.,1;
a,1;
a,1;
course,,1;
things,1;
go,,1;
often,1;
“go,1;
a,1;
reasoning,1;
a,1;
complicated,1;
From.,1;
cases,,1;
not,1;
figure,1;
For,1;
?,1;
at,1;
uses,1;
not,1;
that
doesn’t,1;
a,1;
?,1;
likely,1;
at,1;
point,1;
problem,1;
we,1;
have,1;
?,1;
aware,1;
a,1;
writing,,1;
not,1;
stabilized,,1;
it’s,1;
likely,1;
similar,,1;
have,1;
on.,1;
out,1;
give,1;
how,1;
full,1;
a
wrapper,1;
either,1;
not.,1;
Some,1;
though,1;
we,1;
won’t,1;
For,1;
in
the,1;
if,1;
have,1;
happy
path,1;
have,1;
Err(e),,1;
you
want,1;
not,1;
have,1;
just
Result.,1;
Option<T>,,1;
same,1;
pattern—if,1;
have,1;
path,,1;
if,1;
have,1;
a,1;
you
want,1;
extends,1;
?,1;
?,1;
?,1;
functions,,1;
main.,1;
full,1;
though,,1;
we,1;
a,1;
For,1;
Listing,1;
->,1;
..,1;
uses,1;
?,1;
..
thing.cleanup();
Ok(())
}
Listing,1;
A,1;
using,1;
?,1;
won’t,1;
?,1;
would,1;
problem,1;
solve.,1;
A,1;
a,1;
?,1;
uses,1;
break,1;
final,1;
break.,1;
Listing,1;
always,1;
do,1;
Listing,1;
->,1;
..,1;
uses,1;
?,1;
A,1;
always,1;
not,1;
at,1;
writing,,1;
a,1;
likely,1;
a,1;
chapter,1;
at,1;
a,1;
look,1;
at,1;
of
the,1;
behind-the-scenes,1;
?,1;
how,1;
?,1;
may
become,1;
going,1;
we’ll,1;
take,1;
look,1;
at,1;
how,1;
a,1;
at,1;
flags,,1;
dependency,1;
using,1;
See
you,1;
Handling
655
PROJECT,1;
chapter,1;
provides,1;
ideas,1;
For,1;
little,1;
code,,1;
additional,1;
you’ll,1;
out,1;
a,1;
we,1;
look,1;
at,1;
tools,1;
a,1;
a,1;
optional,1;
meaning,1;
of
themselves—instead,,1;
a,1;
we,1;
optional,1;
additional,1;
a,1;
Note,1;
uses,1;
add
to,1;
do,1;
things,1;
if,1;
a,1;
makes,1;
a,1;
Cargo.toml,,1;
a,1;
dependency,1;
a,1;
a,1;
falls,1;
A,1;
depends,1;
a,1;
dependency
on,1;
would,1;
break,1;
For,1;
we,1;
if,1;
A,1;
C,1;
if,1;
C.
Cargo,1;
hard.,1;
For,1;
if,1;
B),1;
depend,1;
C,1;
either
A,1;
take,1;
A,1;
B.,1;
Because,1;
it’s,1;
if,1;
build.
NOTE
I,1;
to
check,1;
any,1;
combination,1;
features.,1;
One,1;
cargo-hack,,1;
at,1;
https://github.com/taiki-e/cargo-hack/.
Defining,1;
defined,1;
Cargo.toml.,1;
Listing,1;
a,1;
foo,1;
a,1;
optional,1;
dependency,1;
["syn"]
[dependencies]
syn,1;
"1",,1;
optional,1;
A,1;
optional,1;
not,1;
if,1;
a,1;
opts,1;
Listing,1;
how,1;
a,1;
bar,1;
would,1;
dependency.
[package]
name,1;
"1",,1;
["derive"],1;
a,1;
a,1;
makes,1;
sense,1;
have,1;
opt,1;
out,1;
define,1;
a,1;
a,1;
crate.,1;
you
to,1;
opt,1;
out,1;
a,1;
Listing,1;
out,1;
["syn"]
default,1;
"parsing",,1;
out,1;
optional,1;
if,1;
a,1;
depends,1;
foo,1;
does,1;
not,1;
opt,1;
out,1;
built,1;
listed,1;
Opting,1;
out,1;
a,1;
way
to,1;
A,1;
define,1;
a,1;
list,1;
a,1;
list,1;
might,,1;
at,1;
a,1;
little,1;
odd—in,1;
Listing,1;
a,1;
not,1;
a,1;
feature.,1;
out,1;
makes,1;
optional,1;
dependency
a,1;
same,1;
if,1;
a,1;
same,1;
optional,1;
dependency;,1;
a,1;
is
in,1;
not,1;
stabilized,1;
at,1;
if,1;
have,1;
a,1;
a,1;
dependency,,1;
dependency,1;
using,1;
a,1;
have,1;
Crate
When,1;
using,1;
uses,1;
a,1;
if,1;
if,1;
a,1;
component,
you,1;
if,1;
using,1;
give,1;
a,1;
not,1;
primarily,1;
closely,1;
related,1;
macro,,1;
conditions.,1;
things,1;
we’ll,1;
this
chapter,,1;
if,1;
enabled.,1;
if,1;
"some-feature")
is,1;
equivalent,1;
if,1;
if,1;
(and,1;
if,1;
often,1;
macro,,1;
ensure,1;
#[cfg]
in,1;
constructs
like,1;
though;,1;
team,1;
situa-
tions,1;
a,1;
nonadditive,,1;
impos-
sible,1;
crate.,1;
often,1;
compatible,1;
a,1;
if,1;
variant,1;
a,1;
a,1;
must,1;
dependent,1;
does,1;
not,1;
have,1;
longer
compile,1;
if,1;
you’re,1;
a,1;
a,1;
making,1;
guarded,1;
features.,1;
opt,1;
of,,1;
need.
Workspaces
Crates,1;
Because,1;
a,1;
5unit;,1;
a,1;
big,1;
a,1;
a,1;
a,1;
simplifies,1;
a,1;
a,1;
a,1;
must,1;
re-­evaluate,1;
if,1;
changed.,1;
a,1;
a,1;
big,1;
how,1;
project,1;
project,1;
internally,1;
depend,1;
the
feature,1;
A,1;
a,1;
together,1;
a,1;
Listing,1;
5-4.
[workspace]
members,1;
5-4:,1;
A,1;
Cargo.toml
The,1;
a,1;
list,1;
a,1;
in
the,1;
have,1;
a,1;
a,1;
output
directory.,1;
match,1;
not,1;
a,1;
a,1;
crate.,1;
For,1;
tokio-test,,1;
inter-
act,1;
them
all.,1;
tests?,1;
not,1;
it’s,1;
a,1;
commands,1;
do,1;
“right,1;
a,1;
if,1;
have,1;
a,1;
a,1;
instead.
Once,1;
have,1;
a,1;
workspace-level,1;
depend,1;
using,1;
Listing,1;
5-5.
Project,1;
Structure
71#,1;
"../one",1;
if,1;
a,1;
foo,1;
not,1;
project,1;
does,1;
not,1;
to
evaluate,1;
project,1;
A-WORKSPACE,1;
a,1;
depends,1;
on
another,1;
Listing,1;
5-5.,1;
if,1;
consumption,,1;
have,1;
a,1;
depends,1;
a,1;
bar,1;
Listing,1;
a,1;
foo,1;
foo,1;
"1.0.0".,1;
bar,1;
depends,1;
at,1;
../../foo,1;
But,1;
released,1;
foo,1;
foo,1;
same,1;
considers,1;
have,1;
same,1;
any,1;
from
foo,1;
a,1;
though,1;
have,1;
same,1;
same,1;
user,1;
best,1;
problem,1;
if,1;
depend,1;
works
with,1;
foo,1;
1.0.0,,1;
list,1;
foo,1;
dependencies.,1;
Only,1;
if,1;
a,1;
foo,1;
a,1;
release,1;
a,1;
foo,1;
remove,1;
dependency,1;
if,1;
foo,1;
then
run,1;
you’ll,1;
using,1;
which
may,1;
not,1;
5Project,1;
a,1;
crate’s
name,,1;
information,,1;
list,1;
take,1;
far,,1;
project,1;
matures,,1;
a,1;
things,1;
a,1;
additional,1;
keywords,1;
categories,1;
a,1;
project,1;
it’s,1;
set
the,1;
exclude,1;
metadata,1;
a,1;
crate’s,1;
any,1;
listed,1;
if,1;
have,1;
or
other,1;
same,1;
do,1;
exclude,1;
a,1;
specific,1;
exclude,1;
a,1;
given,1;
have,1;
a,1;
alternative,1;
registries,1;
not,1;
a,1;
list,1;
list,1;
metadata,1;
grow,,1;
make
sure,1;
periodically,1;
Manifest,1;
give,1;
how,1;
a,1;
completely,1;
(we’ll,1;
provides,1;
we’ll,1;
profiles.
[patch]
The,1;
section,1;
a,1;
dependency,1;
dependency,1;
a,1;
modified,1;
transitive,1;
a,1;
a,1;
a,1;
minor,1;
Listing,1;
how,1;
a,1;
variant,1;
a,1;
a,1;
a,1;
a,1;
branch
serde,1;
a,1;
dependency,1;
using,1;
[patch]
Even,1;
if,1;
a,1;
dependency,,1;
ver-
sion,1;
a,1;
crate.,1;
depend,1;
multiple,1;
same,1;
distinct
identifiers,,1;
Listing,1;
multiple,1;
same,1;
using,1;
look,1;
at,1;
path,,1;
/nom4
contains,1;
/nom5,1;
look,1;
using,1;
dependency,1;
does,1;
regular,1;
a,1;
mind,1;
not,1;
a,1;
crate.,1;
A,1;
depends,1;
section,1;
empty),,1;
not,1;
of
your,1;
wonder,1;
a,1;
a,1;
often,1;
interchangeably,1;
they
also,1;
have,1;
specific,1;
depending,1;
you’re,1;
a,1;
a,1;
hierarchy,1;
at,1;
a,1;
.rs,1;
attributes,1;
#![feature])—usually,1;
lib.rs,1;
or
main.rs.,1;
a,1;
a,1;
collection,1;
a,1;
a,1;
crate,
multiple,1;
maybe,1;
multiple
workspace,1;
themselves,1;
have,1;
5[profile]
The,1;
section,1;
additional,1;
crate.,1;
ways.,1;
have,1;
defaults,1;
depending,1;
debug,1;
mode,1;
release,1;
mode,1;
modes,1;
exist).
The,1;
option,1;
how,1;
optimize,1;
at,1;
3,1;
can”).,1;
higher,1;
be,,1;
at,1;
higher,1;
though,,1;
generally
enabled,1;
release,1;
optimize,1;
platforms.
The,1;
option,1;
how,1;
it
is,1;
a,1;
crate’s,1;
parallel.,1;
this
speedup,,1;
means
code,1;
a,1;
could,1;
a,1;
a,1;
uses,1;
codegen,1;
debug,1;
mode,1;
(basically,,1;
a,1;
at,1;
release,1;
linker,,1;
if,1;
bits,1;
known,1;
origi-
nally,1;
separately.,1;
LTO,1;
unit.,1;
have,1;
compiled,,1;
makes,1;
the
units,1;
uses,1;
additional,1;
optimize,1;
of
the,1;
have,1;
lost,1;
LTO,1;
perfor-
mance,1;
though,,1;
cross-crate,1;
LTO,1;
LTO,1;
codegen,1;
attempt,1;
lost,1;
codegen,1;
units.,1;
LTO,1;
using,1;
a,1;
lot
of,1;
codegen,1;
units.,1;
a,1;
known,1;
thin,1;
LTO,,1;
LTO,1;
parallelized,,1;
at,1;
a,1;
LTO,1;
would,1;
have,1;
optimize,1;
linker-plugin-lto,1;
section,1;
flags,1;
debug,1;
debug,1;
binary
size,,1;
backtraces,1;
related,1;
debug,1;
isn’t
compiled,1;
cfg(debug_assertions)).,1;
make
your,1;
makes,1;
at,1;
over-
flow,1;
a,1;
on.,1;
debug,1;
mode,1;
release,1;
section,1;
option,1;
panic!,
either,1;
through,1;
9,,1;
give,1;
a,1;
Rust,,1;
panics,,1;
recursively,1;
that
thread’s,1;
if,1;
foo,1;
bar,1;
would,1;
finally
from,1;
exiting.,1;
A,1;
a,1;
on.,1;
a,1;
a,1;
panics,1;
Only,1;
(and,1;
exits,1;
does,1;
a,1;
along,1;
For,1;
imagine,1;
a,1;
panics,1;
halfway,1;
through,1;
a,1;
acquires,1;
Mutex
must,1;
a,1;
For,1;
if,1;
a,1;
5and,1;
communicate,1;
any,1;
a,1;
a,1;
which
leads,1;
a,1;
program.,1;
But,1;
is
arguably,1;
continuing,1;
not,1;
target,1;
cannot,1;
efficiently,1;
a,1;
exits,1;
immediately,1;
a,1;
occurs.,1;
no
threads,1;
do,1;
any,1;
cleanup.,1;
severe,,1;
a,1;
are
made,1;
visible,1;
global—if,1;
have,1;
a,1;
panics,,1;
tends,1;
a,1;
a,1;
unwinding,,1;
though,1;
have,1;
backtraces,1;
by
passing,1;
makes,1;
infor-
mation,1;
still,1;
a,1;
panic.
PROFILE,1;
OV,1;
ERRIDES
You,1;
a,1;
dependency,,1;
a,1;
overrides.,1;
For,1;
Listing,1;
how,1;
serde,1;
using,1;
syntax.
[profile.dev.package.serde]
opt-level,1;
a,1;
specific,1;
dependency,1;
a
specific,1;
override,1;
if,1;
dependency,1;
debug,1;
mode,1;
won’t,1;
take,1;
defaults,1;
using,1;
a,1;
section,1;
~/.cargo/config.
When,1;
a,1;
specific,1;
dependency,,1;
serde,1;
a,1;
generic,1;
crate’s,1;
not,1;
universal—it’ll,1;
same,1;
of
what,1;
CPU,1;
on.,1;
But,1;
sometimes,1;
you’ll,1;
have,1;
chips,,1;
a,1;
maybe,1;
a,1;
particular
function,1;
a,1;
given,1;
CPU,1;
a,1;
provides,1;
a,1;
chapter,1;
Crate.”,1;
usually,1;
appears,1;
in
the,1;
says,1;
if,1;
if,1;
a,1;
a,1;
a,1;
Boolean,1;
using,1;
a,1;
made,1;
any,,1;
not,,1;
would,1;
Options,1;
either,1;
conditions.
There,1;
a,1;
on.,1;
Let’s,1;
through,1;
common,1;
common:
Feature,1;
options
You’ve,1;
Feature,1;
take,1;
if,1;
enabled.,1;
multiple,1;
a,1;
using,1;
For,1;
if,1;
either,1;
a,1;
family,1;
have,1;
forms,
so,1;
directly.,1;
For,1;
if,1;
you
wanted,1;
a,1;
would,1;
a,1;
mind,1;
not,1;
any,1;
dependencies.
This,1;
not,1;
it’s,1;
set).,1;
same,1;
debug,1;
mode,1;
clippy,1;
question.,1;
For,1;
if,1;
a,1;
not,1;
give,1;
CPU,1;
a,1;
aarch64,,1;
a,1;
For,1;
code,,1;
useful.
Compiler,1;
ABI,1;
against
and,1;
through,1;
gnu,,1;
often,1;
option,1;
if,1;
interface
directly,1;
using,1;
usually,1;
code,,1;
dependencies.,1;
For,1;
dependency,1;
makes,1;
sense,1;
Listing,1;
how,1;
"0.7"
[target.'cfg(unix)'.dependencies]
nix,1;
we,1;
winrt,1;
0.7,1;
a,1;
mind,1;
[dependencies],1;
section,1;
not,1;
at,1;
cannot,1;
any,1;
depends,1;
any,1;
call,1;
dependency,1;
specifications,,1;
using,1;
cargo-deny,1;
cargo-audit.,1;
tools,1;
multiple,1;
a,1;
given,1;
dependency,,1;
depend,1;
have,1;
known,1;
vulnerabilities,,1;
you
use,1;
a,1;
a,1;
codebase,1;
automated,1;
have,1;
crate.,1;
do,1;
your
--cfg,1;
variable.,1;
depending,1;
a,1;
dev,1;
Options,1;
ver-
sions,1;
ways.,1;
not,1;
horribly,1;
which
require,1;
a,1;
change;,1;
a,1;
minor,1;
a,1;
a,1;
outlining,1;
a,1;
book.
I,1;
won’t,1;
straightforward,1;
deciding,1;
how,1;
5Minimum,1;
Supported,1;
supported,1;
projects,1;
problem,1;
Rust,,1;
often,1;
we,1;
take,1;
stabilized,1;
not,1;
a,1;
little,1;
a,1;
always,1;
any,1;
release,1;
varies,,1;
release,1;
four,1;
eight
stable,1;
introduced,1;
project,1;
held,1;
the
MSRV,1;
sometimes,1;
a,1;
cannot,1;
take,1;
users.
The,1;
increase,1;
minor,1;
version
number,1;
any,1;
if,1;
a,1;
project,1;
depends,1;
dependency,1;
project,1;
minor,1;
not,1;
release,1;
doing,1;
release,1;
if,1;
projects,1;
take,1;
a,1;
projects,1;
have,1;
opt,1;
change,,1;
who,1;
have,1;
not,1;
a,1;
any,1;
if,1;
increase,1;
you’ll,1;
do,1;
a,1;
force,1;
to
forego,1;
updates,1;
made,1;
have,1;
using,1;
nothing
workable,1;
stabilized,1;
Versions
When,1;
a,1;
dependency,,1;
it’s,1;
not,1;
always,1;
give,1;
commonly,1;
won’t,1;
making,1;
line.,1;
Let’s,1;
look,1;
at,1;
a,1;
dependency,1;
hugs,1;
imagine,1;
a,1;
depend,1;
depends,1;
imagine,1;
foo,1;
depend,1;
hugs,1;
<1.6".,1;
you’ll,1;
trouble.,1;
hugs,1;
considers,1;
dependency,1;
hugs,1;
hugs,1;
compatible,1;
requirements.
NOTE
In,1;
a,1;
a,1;
not,1;
a
newer,1;
a,1;
common,1;
enforce,1;
ensure,1;
listed,1;
unfortunate,,1;
could,1;
hugs,1;
any,1;
using,1;
only
versions,1;
at,1;
minor,1;
hugs,1;
not,1;
could,1;
does,1;
depend,1;
hugs,1;
would,1;
would,1;
not,1;
notice,1;
if,1;
a,1;
if,1;
dependency,1;
hugs,1;
would,1;
not,1;
list,1;
earliest,1;
depends,1;
crate.,1;
But,1;
how,1;
do,1;
beyond
trawling,1;
through,1;
best,1;
unstable,1;
makes,1;
the
minimum,1;
a,1;
minor,1;
any,1;
have,1;
problem.,1;
While,1;
have,1;
correctly,,1;
projects,1;
depend,1;
not,1;
have.,1;
(and,1;
it’s,1;
depend,1;
foo,1;
depends,1;
bar,1;
a,1;
specifier
of,1;
bar,1;
"1",1;
bar,1;
foo,1;
how,1;
list,1;
foo,1;
-Z,1;
always,1;
prefer,1;
a,1;
pulled,1;
transitive,1;
you’ll,1;
have,1;
list,1;
to
date,1;
proposal,1;
a,1;
current
crate,1;
maximal,1;
a,1;
little,1;
a,1;
dependency,1;
through,1;
how,1;
a,1;
likely,1;
changelogs,1;
a,1;
for-
mat,1;
at,1;
considers,1;
a,1;
dependency,1;
a,1;
have,1;
not,1;
a,1;
release,1;
listed,1;
ver-
sioning,1;
does,1;
not,1;
how,1;
a,1;
immediately,1;
a,1;
released,1;
alpha,,1;
out,1;
ver-
sion,1;
not,1;
For,1;
if,1;
released,1;
change,,1;
made,1;
a,1;
change,,1;
If
the,1;
increase,1;
a,1;
remove,1;
do,1;
effective,1;
makes,1;
common,1;
workflows,1;
work
much,1;
First,,1;
imagine,1;
a,1;
depends,1;
a,1;
Git.
Then,1;
a,1;
increase,1;
ver-
sion,1;
at,1;
same,1;
suddenly,1;
ways,
Project,1;
a,1;
weird,1;
out,1;
have,1;
either,1;
specific,1;
imagine,1;
a,1;
a,1;
any,1;
released,1;
a,1;
dependency,1;
a,1;
other
developers,1;
project,1;
have,1;
crate’s
repository.,1;
do,1;
not,1;
this
developer,1;
communicate,1;
project,1;
the
feature,1;
change,,1;
project,1;
the
old,1;
minor
version,1;
dependency,,1;
old
checkout,1;
workflow,1;
a,1;
to
communicate,1;
multiple,1;
minor,1;
do,1;
a,1;
common,1;
if,1;
multiple,1;
workflow,1;
still,1;
you’re,1;
not,1;
workflow,1;
always,1;
though,,1;
how,1;
at,1;
a,1;
of
others.,1;
common,1;
won’t,1;
chapter,1;
we’ll,1;
testing,1;
how,1;
we,1;
we’ll,1;
look,1;
at,1;
various
ways,1;
testing
you,1;
testing,1;
Rust
comes,1;
a,1;
testing,1;
primarily,1;
a,1;
often,1;
are
getting,1;
a,1;
codebase,1;
tag-
ging,1;
chapter,1;
testing,1;
mechanisms,,1;
testing,1;
at,1;
of
your,1;
code,,1;
various,1;
testing,1;
must,1;
how,1;
does,1;
a,1;
tests,,1;
crate’s,1;
First,,1;
cfg(test),1;
testing,1;
a,1;
makes,1;
compiler
generate,1;
a,1;
a,1;
it’s,1;
Harness
The,1;
through,1;
a,1;
of
procedural,1;
we’ll,1;
light,1;
a,1;
macro
part.,1;
any,1;
additional,1;
on.,1;
captures,1;
results.,1;
parse,1;
arguments,1;
things,1;
listed,1;
parallel,,1;
writing,,1;
making,1;
a,1;
publicly,1;
harnesses.,1;
still,1;
at,1;
proposal,1;
closely,1;
exists,1;
out,1;
how,1;
ensure,1;
if,1;
same,1;
meaning,1;
crate’s,1;
not,1;
have,1;
shared
­submodules,1;
a,1;
a,1;
a,1;
opt,1;
that
by,1;
does,1;
not,1;
harness.,1;
opt,1;
out,1;
a,1;
given,1;
in
Cargo.toml,,1;
Listing,1;
define,1;
"tests/custom.rs"
harness,1;
Opting,1;
out,1;
harness
Without,1;
happens.
Instead,,1;
you’re,1;
you’re,1;
a,1;
responsible,1;
things,1;
does,1;
have,1;
uses
the,1;
does,1;
a,1;
arguments,1;
how,1;
flags,,1;
arguments,1;
For,1;
text,1;
through,1;
com-
mand,1;
if,1;
at,1;
option,1;
how,1;
helpful,1;
if,1;
have,1;
a,1;
a,1;
option
for,1;
match,1;
a,1;
pattern,,1;
list,1;
tests.
Keep,1;
mind,1;
arguments,1;
if,1;
you’ll,1;
have,1;
yourself,1;
a,1;
primarily,1;
we’ll,1;
test”,1;
For,1;
you’ll,1;
check-
ers,,1;
a,1;
testing,,1;
have,1;
code
that,1;
out,1;
specifically,1;
tested.,1;
same,1;
going
into,1;
production?,1;
tests,,1;
a,1;
tests,,1;
often,1;
you’re,1;
testing,1;
any,1;
For,1;
if,1;
you
are,1;
testing,1;
a,1;
do,1;
not,1;
a,1;
“network”,1;
if,1;
you’re,1;
testing,1;
a,1;
metrics,1;
how,1;
often,1;
a,1;
a,1;
given,1;
“fake”,1;
implementations,1;
known,1;
a,1;
any,1;
While,1;
often,1;
do,1;
manually,,1;
it’s,1;
have,1;
a,1;
take
care,1;
nitty-gritty,1;
you.,1;
automated,1;
play.,1;
A,1;
mocking,1;
have,1;
properties,1;
introspect,1;
a,1;
through,1;
generics—as,1;
framework,,1;
generic,1;
might
want,1;
a,1;
a,1;
mocking,1;
generic,1;
instantiating,1;
generic,1;
you’re,1;
making,1;
a,1;
generic,1;
would,1;
a,1;
either,1;
depending,1;
cfg(test),1;
a,1;
cfg(feature
=,1;
moment,,1;
a,1;
mocking,1;
a,1;
One,1;
Answer,1;
mocking,1;
still,1;
APIs
First,,1;
additional,1;
methods,,1;
(unit),1;
not,1;
For,1;
a,1;
RawTable,1;
logic.
Suppose,1;
doing,1;
a,1;
to
check,1;
a,1;
bucket,1;
nonempty,,1;
Listing,1;
full,1;
A,1;
does,1;
not,1;
not,1;
private,1;
HashMap,,1;
cannot,1;
private
buckets,1;
RawTable,1;
lives,1;
a,1;
could,1;
making,1;
we,1;
could,1;
making,1;
read-only
could,1;
depending,1;
making,1;
a,1;
testing,,1;
Listing,1;
rest,1;
from
Listing,1;
call,1;
buckets(),1;
the
private,1;
RawTable,1;
buckets(&self),1;
->,1;
testing,1;
Assertions
The,1;
exists,1;
testing,1;
additional,1;
For,1;
imagine,1;
you’re,1;
BufWriter,1;
BufWriter,1;
does,1;
not,1;
calls
Testing
89unnecessarily.,1;
do,1;
have,1;
BufWriter,1;
how,1;
keeping
track,1;
introduces,1;
(marginal),1;
have,1;
testing,,1;
as
shown,1;
Listing,1;
BufWriter<T>,1;
BufWriter<T>,1;
->,1;
1;
let,1;
n,1;
testing,1;
mind,1;
as
a,1;
For,1;
tests,,1;
would,1;
tests,,1;
as
a,1;
testing,1;
a,1;
set.
Doctests
Rust,1;
snippets,1;
comments,1;
commonly,1;
Because,1;
doctests
appear,1;
likely,1;
that
the,1;
have,1;
private,1;
methods,,1;
not
set,1;
crate’s,1;
if,1;
user,1;
importantly,,1;
focus,1;
bits,1;
user,1;
likely,1;
including,1;
opt,1;
out,1;
auto-wrapping,1;
defining,1;
in
the,1;
doctest.,1;
do,1;
if,1;
using,1;
async,1;
if,1;
additional,1;
?,1;
have,1;
a
custom,1;
if,1;
makes,1;
?,1;
if,1;
a,1;
Ok::<(),,1;
have,1;
a,1;
additional,1;
interfaces.,1;
a,1;
a,1;
a,1;
#,,1;
not,1;
in
the,1;
not,1;
values.,1;
if,1;
a,1;
same,1;
Listing,1;
a,1;
look,1;
a,1;
through,1;
we,1;
generation.
///,1;
#,1;
#,1;
uses,1;
?,1;
multiple,1;
concrete,1;
we,1;
user,1;
#,1;
#,1;
Ok::<(),,1;
could,1;
though,1;
#,1;
/*
///,1;
#,1;
#,1;
->,1;
a,1;
if,1;
steps,1;
functions,,1;
attributes,1;
how,1;
attributes,1;
immediately,1;
a,1;
multiple,1;
attributes,1;
commas.
Like,1;
functions,,1;
should_panic,1;
a,1;
or
ignore,1;
if,1;
a,1;
given,1;
not,1;
not,1;
user,1;
a,1;
particu-
lar,1;
not,1;
serves,1;
a,1;
remind,1;
properties,1;
for
your,1;
Listing,1;
6-6,1;
how,1;
to
check,1;
a,1;
given,1;
does,1;
not,1;
compile_fail
compile_fail,1;
a,1;
does,1;
not,1;
For,1;
if,1;
a,1;
have,1;
you’ll,1;
usually,1;
take,1;
a,1;
look,1;
at,1;
a,1;
lot,1;
testing,1;
A,1;
testing,1;
tools,1;
Rust-specific,1;
testing,1;
not,1;
a,1;
tests,,1;
often
can,1;
clippy,1;
a,1;
almost,1;
bugs.,1;
Some,1;
a,1;
b,1;
a,1;
t,1;
a,1;
reference;,1;
will
iterate,1;
not,1;
clippy,1;
part
of,1;
a,1;
usually,1;
For,1;
a,1;
if,1;
a,1;
While,1;
broadly,1;
a,1;
specific,1;
opt
out,1;
#[allow(clippy::name_of_lint)].
The,1;
though,1;
usually,1;
treated,1;
a,1;
look,1;
at,1;
a,1;
list).
NOTE
Not,1;
warnings,1;
still,1;
style,1;
A,1;
edition”,1;
#![warn(rust_2018
_idioms)].,1;
if,1;
you’re,1;
take
advantage,1;
Some,1;
a,1;
project,1;
missing_docs
and,1;
missing_debug_implementations,,1;
if,1;
implementations,1;
any,1;
a,1;
a,1;
lot,1;
do,1;
at,1;
Luckily,,1;
take,1;
Many,1;
tools,1;
exist,,1;
have,1;
written,1;
at,1;
a,1;
high,1;
random,1;
if,1;
crashes,,1;
a,1;
For,1;
if,1;
you’re,1;
a,1;
URL,1;
systematically,1;
at,1;
would,1;
take,1;
a,1;
if,1;
a,
then,1;
b,,1;
take,1;
a,1;
a,1;
fuzzers,1;
metrics,1;
paths,1;
code,,1;
higher,1;
if,1;
at,1;
at,1;
finding,1;
little,1;
point,1;
the
fuzzer,1;
at,1;
a,1;
a,1;
input,,1;
For,1;
Listing,1;
6-7,1;
how,1;
a,1;
URL,1;
std::str::from_utf8(data),1;
_,1;
url::Url::parse(s);
}
});
Listing,1;
Fuzzing,1;
a,1;
URL,1;
parser.,1;
panics,1;
a,1;
a,1;
a,1;
a,1;
usually,1;
a,1;
a,1;
feels,1;
it’s,1;
a,1;
a,1;
a,1;
random
bytes.,1;
bytes
from,1;
a,1;
call,1;
not,1;
does,1;
it’s,1;
function
didn’t,1;
if,1;
it’s,1;
testing,1;
properties,1;
common,1;
testing,1;
a,1;
a,1;
given,1;
input,,1;
give,1;
simplified,1;
implementations,1;
you’re,1;
for—but,1;
if,1;
it’s,1;
not,,1;
likely,1;
found,1;
a,1;
bug.
You,1;
testing,1;
properties,1;
not,1;
take,1;
common,1;
improvements.
The,1;
a,1;
you’re,1;
optimize,1;
(like
naive,1;
a,1;
lot,1;
have
argued,1;
testing,1;
testing,1;
testing,1;
heavily,1;
inputs,,1;
testing,1;
tends,1;
testing,1;
take,1;
a,1;
does,1;
niche,1;
fuzzers,1;
fuzzers,1;
gain,1;
capability,1;
you’re,1;
curious,1;
crate.
TES,1;
fuzzers,1;
testing,1;
a,1;
call,1;
crate.,1;
For,1;
if,1;
a,1;
particu-
lar,1;
could,1;
define,1;
Operation,1;
lists
operations,,1;
take,1;
a,1;
a,1;
have,1;
inputs,,1;
still,1;
a,1;
if,1;
a,1;
have,1;
a,1;
But,1;
a,1;
two
common,1;
failures:,1;
if,1;
occur,1;
a,1;
code,,1;
if,1;
reads,1;
a,1;
out,1;
difficult—often
you,1;
have,1;
a,1;
could,1;
a,1;
if,1;
Luckily,,1;
tools,1;
interpreter,1;
properties,1;
through,1;
miri
test.,1;
makes,1;
a,1;
But,1;
if,1;
ever
exhibits,1;
uses,1;
sometimes,1;
detects,1;
Listing,1;
references,1;
a,1;
(&mut,1;
{}",,1;
detects,1;
writing,,1;
if,1;
through,1;
an
error,1;
out,1;
Behavior:,1;
at,1;
alloc1383,,1;
<2772>,1;
does,1;
not,1;
have,1;
stack
-->,1;
(&mut,1;
at,1;
alloc1383,,1;
not,1;
have,1;
still,1;
messages,1;
always,1;
a,1;
problem,1;
worked,1;
have,1;
at,1;
a,1;
a,1;
high,1;
synchro-
nization,1;
A,1;
take,1;
same,1;
ensure,1;
A,1;
taking,1;
taking,1;
Loom
also,1;
atomic,1;
we’ll,1;
9),1;
do,1;
a,1;
give,1;
executed,1;
Testing
Writing,1;
often,1;
a,1;
crate.,1;
But,1;
if,1;
suddenly,1;
a,1;
a,1;
have,1;
drasti-
cally,1;
either,1;
it.
Unlike,1;
testing,,1;
do,1;
not,1;
have,1;
a,1;
com-
mon,,1;
output.,1;
A,1;
either,1;
a,1;
give,1;
a,1;
a,1;
a,1;
samples,,1;
any,1;
might
be,1;
question.,1;
a,1;
a,1;
a,1;
a,1;
hundred,1;
take,1;
a,1;
speak,1;
how,1;
tests
in,1;
a,1;
we’ll,1;
look,1;
at,1;
how,1;
Three,1;
common,1;
often,1;
a,1;
a,1;
instructions,1;
Some,1;
CPU,1;
how,1;
For,1;
kernel,1;
may
change,1;
paging,1;
CPU,1;
unlikely,1;
if,1;
a,1;
same,1;
observe,1;
using,1;
same,1;
have,1;
environment.
There,1;
perfect,1;
perfor-
mance,1;
a,1;
it’s,1;
best,1;
we,1;
a,1;
signal,1;
noisy,1;
measurements,1;
give,1;
best,1;
friend,1;
distribution,1;
measurements,1;
a,1;
one.,1;
this.,1;
For,1;
take,1;
average?”,1;
to
look,1;
at,1;
“What,1;
covers,1;
we,1;
testing,1;
a,1;
measured
difference,1;
a,1;
not,1;
testing,1;
done,1;
instance,,1;
does,1;
you.,1;
All,1;
do,1;
give,1;
a,1;
call,1;
produces,1;
a,1;
report,,1;
a,1;
course,,1;
effects
of,1;
testing,1;
a,1;
at,1;
cat-
egorizes,1;
measurable,1;
Optimizations
Compilers,1;
code,,1;
at,1;
dark
magic,1;
out,1;
how,1;
a,1;
smartness,1;
give,1;
results.,1;
For,1;
Listing,1;
std::time::Instant::now();
for,1;
{
vs.push(i);
}
println!("took,1;
{:?}",,1;
start.elapsed());
Listing,1;
A,1;
6If,1;
look,1;
at,1;
mode,1;
using,1;
immediately,1;
notice,1;
have,1;
out,1;
per-
formed,1;
course,,1;
do,1;
provides,1;
confusion,1;
still,1;
at,1;
it’s,1;
x),1;
ways.,1;
does,1;
not,1;
optimizations
to,1;
does,1;
optimizing
how,1;
assumption,1;
CPU,1;
could,1;
value.,1;
free,1;
at,1;
still,1;
we,1;
though,1;
not,1;
For,1;
we,1;
Listing,1;
the
vector,1;
Listing,1;
6-10.
let,1;
std::time::Instant::now();
for,1;
{:?}",,1;
start.elapsed());
Listing,1;
A,1;
Listing,1;
before,1;
cannot,1;
out”,1;
part),1;
we,1;
vs.as_ptr(),1;
not,,1;
any,1;
opera-
tion,1;
not,1;
through,1;
a,1;
shared,1;
if,1;
we,1;
notice,1;
it’s,1;
For,1;
we,1;
often,1;
along,1;
do,1;
we,1;
how,1;
std::time::Instant::now();
for,1;
{
println!("iteration,1;
{}",,1;
i);
my_function();
}
println!("took,1;
{:?}",,1;
start.elapsed());
Listing,1;
What,1;
we,1;
look,1;
reality,,1;
does,1;
not,1;
how,1;
likely,1;
tell
us,1;
how,1;
a,1;
numbers.,1;
body,1;
of
the,1;
does,1;
a,1;
lot,1;
a,1;
into
decimal,1;
locks,1;
out,1;
a,1;
using,1;
at,1;
call,1;
if,1;
out,1;
a,1;
lot,1;
call,1;
uses,1;
random,1;
my_function(rand::random()),1;
a,1;
mea-
suring,1;
a,1;
random,1;
numbers.,1;
same,1;
a,1;
a,1;
thread—these,1;
things,1;
take,1;
a,1;
overshadowing,1;
often,1;
body,1;
All,1;
code
should,1;
either,1;
before,1;
measured
part,1;
you’re,1;
using,1;
take,1;
a,1;
look,1;
at,1;
provides—they’re,1;
we,1;
testing,1;
at,1;
a,1;
testing,1;
testing,1;
higher-level,1;
chapter,1;
focusing,1;
a,1;
you.,1;
give
the,1;
a,1;
through,1;
get
to,1;
define,1;
we,1;
look,1;
at,1;
C,1;
remove,1;
you’ll,1;
a,1;
doing,1;
C,1;
defined,1;
using,1;
define,1;
function-like,1;
a,1;
do,1;
defined,1;
a,1;
macro,,1;
invoke,1;
using,1;
kind
of,1;
a,1;
sort,1;
replace:,1;
does,1;
job
for,1;
boilerplate.,1;
most
of,1;
have,1;
likely,1;
have,1;
not,1;
function-like,1;
declarative
macros;,1;
replaced,1;
at,1;
specifically,1;
recognizes,1;
invocations,1;
in
most,1;
not,1;
For,1;
cannot,1;
invoke,1;
a,1;
function-like,1;
match,1;
not,1;
immediately,1;
how,1;
to
look,1;
A,1;
B.,1;
shall,1;
out,1;
your
declaration,1;
makes,1;
a,1;
cryptic,1;
have,1;
primarily,1;
yourself,1;
not,1;
do,1;
They’re,1;
best
suited,1;
replacements—if,1;
you’re,1;
do,1;
a,1;
myself
writing,1;
repetitive,1;
code,,1;
7implementations.,1;
For,1;
tests,,1;
often,1;
same,1;
multiple,1;
have,1;
Listing,1;
test_1i128_not_frobnified(),1;
7-1:,1;
testing,1;
it’s,1;
verbose,,1;
prone,1;
we,1;
do,1;
Listing,1;
7-2.
macro_rules!,1;
test_battery,1;
false),1;
a,1;
tests,,1;
one
with,1;
While,1;
makes,1;
invocation,,1;
take,1;
could,1;
have,1;
init.
We’ve,1;
we’ll,1;
implementations,1;
similar.,1;
define,1;
own
trait,,1;
you’ll,1;
often,1;
a,1;
if,1;
implementations,1;
Let’s,1;
Clone,1;
Copy,1;
types
Macros
103in,1;
manually,1;
a,1;
Listing,1;
{
($($t:ty),*),1;
{
$(impl,1;
Clone,1;
$t,1;
->,1;
u8,,1;
/*,1;
a,1;
a,1;
we,1;
Clone,1;
body,1;
uses,1;
copy,1;
out,1;
wonder,1;
we,1;
a,1;
Clone,1;
could,1;
a,1;
big,1;
not,1;
would,1;
force,1;
same,1;
Clone,1;
could,1;
at,1;
still,1;
extends,1;
forwarding
implementations:,1;
could,1;
alter,1;
Listing,1;
yourself,1;
if,1;
a,1;
macro,
you,1;
Generics,1;
if,1;
macros.
How,1;
Work
Every,1;
a,1;
how,1;
a,1;
distinction,1;
keywords,1;
For,1;
text,1;
+,1;
would,1;
five-
token,1;
(,,1;
+,,1;
4,,1;
Rust-like,1;
provides,1;
a,1;
abstraction,1;
rest,1;
For,1;
in
the,1;
have,1;
distinct,1;
representations,1;
token,,1;
a,1;
literal,1;
content,1;
a,1;
tokens,,1;
meaning,1;
a,1;
on.,1;
produces
an,1;
the
104
Chapter,1;
4,,1;
(punctuation),
two,1;
a,1;
tree,,1;
a,1;
a,1;
closure,1;
list,1;
literal,1;
how,1;
a,1;
given,1;
a,1;
replacement,1;
still,1;
not,1;
a,1;
a,1;
done,1;
parse,1;
a,1;
macro,,1;
does,1;
do,1;
a,1;
little,1;
a,1;
macro.,1;
out,1;
things,1;
literals,1;
produces,1;
a,1;
For,1;
+,1;
a,1;
a,1;
a,1;
a,1;
group,1;
(using,1;
delimiter),,1;
consists,1;
a,1;
b,1;
+,1;
token),,1;
literal).,1;
means
that,1;
a,1;
does,1;
not,1;
have,1;
Rust,,1;
it
must,1;
consist,1;
For,1;
<-,1;
a,1;
invocation,,1;
produces,1;
cannot,1;
a,1;
a,1;
closing,1;
always,1;
output.,1;
a,1;
generate,,1;
a,1;
if
without,1;
A,1;
must,1;
(basically,1;
assign,1;
a,1;
a,1;
1;,,1;
a,1;
a,1;
pattern.,1;
makes,1;
a,1;
code,,1;
the
macro,1;
would,1;
not,1;
at,1;
a,1;
high,1;
a,1;
invocation,,1;
macro,,1;
Macros
An,1;
we’ll,1;
oddities,1;
pointing,1;
consist,1;
transcribers.
A,1;
given,1;
have,1;
a,1;
invocation,,1;
­macro’s,1;
a,1;
invocation,,1;
Listing,1;
how,1;
a,1;
/*,1;
/*,1;
/*,1;
a,1;
a,1;
to
twist,1;
bend,1;
match,1;
given
at,1;
site.,1;
a,1;
+,1;
match,1;
any,1;
a,1;
any,1;
+,1;
3,1;
matches,1;
if,1;
$b,1;
3,1;
5.,1;
though,1;
appears,1;
3,1;
a,1;
matched
with,1;
have,1;
regular,1;
For,1;
a,1;
a,1;
(+),1;
given,1;
a,1;
give,1;
match-
ers,1;
a,1;
seen
:ident,1;
any,1;
a,1;
full,1;
list,1;
3,1;
a,1;
match,1;
pattern
you,1;
a,1;
a,1;
look,1;
at,1;
a,1;
generates
code,1;
using,1;
defined,1;
metavariables,,1;
any
occurrence,1;
matches,1;
have,1;
same,1;
example),,1;
same,1;
match,1;
input,,1;
iteration.,1;
For,1;
$value,1;
we,1;
could,1;
call,1;
we,1;
a,1;
not,1;
we,1;
must,1;
a,1;
have,1;
makes,1;
we,1;
we,1;
a,1;
cannot,1;
A,1;
if,1;
a,1;
call,1;
a,1;
a,1;
foo,1;
not,1;
visible,1;
at,1;
call,1;
site,1;
the
macro,1;
cannot,1;
defined,1;
call,1;
site,1;
self),1;
in.
You,1;
their
own,1;
take,1;
a,1;
look,1;
at,1;
Listing,1;
7-5,,1;
a,1;
(and,1;
a,1;
at,1;
call,1;
foo,1;
foo,1;
foo,1;
7-5:,1;
little,1;
foo,1;
the
macro,1;
have,1;
a,1;
foo,1;
hygiene,1;
helpful,1;
making,1;
have,1;
happened,1;
same,1;
separation,1;
does,1;
not,1;
do,1;
a,1;
and
functions,1;
call,1;
site.,1;
define,1;
implementations,1;
defined,1;
(and,1;
not,1;
a,1;
on.,1;
by
design—if,1;
could,1;
not,1;
would,1;
functions,,1;
hygiene,1;
a,1;
crate.,1;
For,1;
cannot,1;
a,1;
{},1;
defined
or,1;
you
use,1;
fully,1;
::core::option::Option,1;
specifically,1;
using,1;
paths,1;
if,1;
a,1;
if,1;
you
want,1;
a,1;
specific,1;
put,1;
foo,1;
a,1;
macro,,1;
foo,1;
at,1;
1;,,1;
the
macro,1;
have,1;
will
therefore,1;
foo,1;
scope.
The,1;
does,1;
not,1;
have,1;
appears,1;
Listing,1;
appears,1;
+,1;
at,1;
call,1;
could,1;
have,1;
+,1;
we,1;
could,1;
+,1;
not,1;
Rust,,1;
a,1;
define,1;
in
the,1;
not,1;
if,1;
must,1;
not,1;
foo,1;
bar,1;
at,1;
a,1;
foo,1;
a,1;
bar,1;
wants,1;
foo,1;
must,1;
before,1;
bar,1;
if,1;
effec-
tively,1;
marks,1;
pub,1;
crate’s,1;
dependents.
Procedural,1;
a,1;
a,1;
combination,1;
a,1;
a,1;
high,1;
to
the,1;
figure,1;
out,1;
define,1;
how,1;
given,1;
a,1;
requirement,1;
a,1;
still,1;
Macros
Procedural,1;
common,1;
same,1;
a,1;
tokens,,1;
(probably),1;
related,1;
how,1;
how,1;
briefly.
Function-Like,1;
function-like,1;
macro.,1;
a
declarative,1;
macro,,1;
at,1;
call,1;
site,1;
not,1;
not,1;
protect,1;
at,1;
call,1;
site.,1;
call,1;
out,1;
(using,1;
private,1;
(using,1;
we’ll,1;
appears,1;
attribute’s,1;
name),1;
including,1;
any,1;
attributes,1;
have.,1;
a,1;
an
item,,1;
a,1;
a,1;
does),1;
a,1;
target,1;
macro.,1;
though,1;
severe,,1;
motivating
factors,1;
Deserialize)],1;
have,1;
a,1;
cannot,1;
take,1;
do,1;
define,1;
mostly
like,1;
not,1;
Cost,1;
we,1;
is
appropriate,,1;
it’s,1;
a,1;
macro—namely,,1;
increase,1;
two
main,1;
bring,1;
pretty
110
Chapter,1;
dependencies.,1;
For,1;
provides,1;
a,1;
makes,1;
easier,,1;
take,1;
(and,1;
debug,1;
mode,1;
rather
than,1;
release,1;
mode.,1;
often,1;
won’t,1;
notice,1;
increase,1;
a,1;
lot,1;
it.
While,1;
does,1;
not,1;
boilerplate,1;
While,1;
do,1;
before,1;
do,1;
any,1;
if,1;
a,1;
out,1;
a,1;
look,1;
at,1;
uses,1;
macro.,1;
only:,1;
a,1;
automation,1;
possible.,1;
have
obvious,1;
automated,1;
a,1;
a,1;
if,1;
if,1;
any,1;
given,1;
common,1;
if,1;
going,1;
it’s,1;
not,1;
a,1;
does,1;
“obvious”?,1;
a,1;
does,1;
a,1;
would,1;
probably
expect,1;
debug,1;
value.,1;
What,1;
derive(serde::Serialize),,1;
serialize,1;
does,1;
a,1;
match,1;
a,1;
trait,,1;
if,1;
does,1;
not,1;
match,1;
implementation,,1;
not,1;
a,1;
Macros
Function-like,1;
give,1;
a,1;
function-like,1;
a,1;
a,1;
subjective
guideline.,1;
do,1;
a,1;
lot,1;
if,1;
put,1;
your
mind,1;
a,1;
have,1;
a,1;
macro,,1;
have,1;
a,1;
pure,1;
at,1;
cannot,1;
a,1;
using,1;
a,1;
perfect,1;
given,1;
a,1;
at,1;
a,1;
does,1;
not,1;
at,1;
likely,1;
a,1;
do,1;
not,1;
a,1;
function-like,1;
break,1;
hygiene,1;
macro.,1;
function-like,1;
headaches,,1;
before,1;
break,1;
have,1;
four,1;
common,1;
same,1;
multiple,1;
same,1;
a,1;
if,1;
have,1;
that
introduces,1;
a,1;
#[test_case(1)],1;
multiple,1;
additional,1;
uses,1;
user,1;
do,1;
a,1;
lot,1;
more
convenient,1;
have,1;
a,1;
attributes,1;
a,1;
domain-specific
language,1;
a,1;
lot,1;
boilerplate,1;
nec-
essary.,1;
use
#[tokio::main],1;
async,1;
main(),1;
a,1;
code,,1;
same,1;
themselves,1;
does,1;
not,1;
For,1;
collection,1;
transparently,1;
instru-
ment,1;
a,1;
call,1;
additional,1;
a,1;
fundamental,1;
go.,1;
pin_project,1;
a,1;
not,1;
a,1;
ensure,1;
a,1;
given,1;
according,1;
forth,1;
(we’ll,1;
does,1;
additional,1;
helper,1;
to
the,1;
ensure,1;
that
users,1;
themselves,1;
While,1;
pin_project
could,1;
have,1;
a,1;
macro,,1;
would,1;
likely,1;
not,1;
have,1;
obvious,,1;
macros.
How,1;
Do,1;
heart,1;
A,1;
either,1;
a,1;
identifier,,1;
a,1;
a,1;
a,1;
parse,1;
out,1;
whatever,1;
parse,1;
code,,1;
likely,1;
a,1;
a,1;
easy-
to-traverse,1;
not,1;
parse,1;
a,1;
TokenStream
but,1;
injected,1;
the
procedural,1;
macro.,1;
do,1;
so.,1;
a,1;
at,1;
a,1;
parse,1;
a,1;
a,1;
"".parse::<TokenStream>().,1;
match,1;
if,1;
a,1;
Display,,1;
token,,1;
a,1;
how,1;
ties,1;
marks,1;
For,1;
a,1;
Listing,1;
a
trivial,1;
name_as_debug,1;
$t,1;
->,1;
::core::fmt::Result
{,1;
A,1;
Debug
Now,1;
imagine,1;
someone,1;
macro,,1;
specifically
where,1;
we,1;
$t,1;
$t,1;
point,1;
user,1;
at,1;
do.
The,1;
$t,1;
$t,1;
in
the,1;
through,1;
the
macro,1;
saying,1;
does,1;
not,1;
invocation,,1;
messages,1;
if,1;
macro.,1;
the
message.,1;
not,1;
useful,,1;
a,1;
input,,1;
point,1;
user,1;
this
part,1;
a,1;
code,,1;
curious,1;
how,1;
handling,1;
a,1;
that
holds,1;
a,1;
type
is,1;
internally,1;
a,1;
collection,1;
produces,1;
a,1;
how,1;
Ident,1;
token,,1;
give
the,1;
identifier,,1;
not,1;
Span::mixed
_site(),1;
at,1;
completely,1;
similarly,1;
call,1;
site.,1;
matches,1;
rules
around,1;
hygiene,1;
we,1;
earlier,
“mixes”,1;
using,1;
site,1;
using,1;
call,1;
site,1;
chapter,1;
we,1;
at,1;
a,1;
aware,1;
we’ll,1;
promise—it’s,1;
PROGR,1;
a,1;
high,1;
won’t,1;
immediately.
If,1;
you’re,1;
not,1;
explain,1;
how,1;
Rust,,1;
we,1;
have,1;
alter-
native,1;
we,1;
before,1;
we,1;
one.,1;
clarifying,1;
using
asynchronous,1;
not,1;
always,1;
the
right,1;
one!,1;
chapter,1;
taking,1;
a,1;
through,1;
a,1;
concept,1;
how,1;
asynchrony,1;
Asynchrony?
Before,1;
we,1;
we,1;
take,1;
a,1;
look,1;
at,1;
doing,1;
So,1;
fast,,1;
waiting,1;
things,1;
you’re,1;
CPU,1;
mostly
sits,1;
waiting,1;
waiting,1;
a,1;
arrive,,1;
mouse,1;
disk,1;
finish,1;
a,1;
does,1;
a,1;
waiting,1;
at,1;
CPU,1;
likely,1;
majority,1;
time.
Synchronous,1;
interfaces,1;
a,1;
a,1;
at,1;
a,1;
finish,1;
before,1;
interfaces,1;
call,1;
do,1;
we’ll,1;
making,1;
a,1;
benefits,1;
interfaces,1;
says,1;
scenes,
what,1;
queues,1;
a,1;
opera-
tion,1;
disk,1;
disk,1;
write.,1;
taking,1;
a,1;
reality,1;
at
all,,1;
sequentially,1;
an
interface,1;
does,1;
not,1;
While,1;
interfaces,1;
usually,1;
at,1;
a,1;
do,1;
at,1;
a,1;
That
means,1;
if,1;
either,1;
user,1;
a,1;
you’re,1;
out,1;
luck,1;
provides,1;
opera-
tion,1;
specifically,1;
if,1;
could,1;
do,1;
disk,1;
a,1;
have,1;
common,1;
a,1;
responsible,1;
a,1;
operations,,1;
multiplexes,1;
if,1;
any,1;
progress,,1;
progress,1;
blocks,,1;
still,1;
do,1;
communicate,1;
using,1;
a,1;
a,1;
a,1;
still,1;
efforts.,1;
For,1;
have,1;
input,,1;
either,1;
a,1;
a,1;
have,1;
multiple,1;
inde-
pendent,1;
executed,1;
at,1;
any,1;
sys-
tem,1;
instead.
Multithreading,1;
interfaces,1;
swaths,1;
software,1;
built,1;
But,1;
not,1;
First,,1;
these
threads,1;
if,1;
have,1;
spin,1;
a,1;
every
concurrent,1;
including,1;
waiting,1;
input,,1;
fast,,1;
does,1;
additional,1;
how,1;
interact,,1;
coordinate.
Second,,1;
costly,1;
there
are.,1;
Every,1;
place,,1;
do,1;
a,1;
not,1;
a,1;
process.,1;
high,1;
often,1;
reusing,1;
using,1;
related,1;
operations,,1;
interfaces,1;
have,1;
parallelism,1;
program.,1;
parallelism,1;
subtle,,1;
multiple,1;
at,1;
same,1;
look,1;
(parallelism).,1;
does,1;
not,1;
parallelism—even,1;
though,1;
have,1;
a,1;
at,1;
a,1;
given,1;
usually,1;
hand,1;
hand.,1;
using,1;
a,1;
primitive,,1;
introduces,1;
additional,1;
parallel.
And,1;
parallelism,1;
often,1;
a,1;
shared,1;
Cell,,1;
powerful,1;
While,1;
interfaces,,1;
we,1;
look,1;
at,1;
interfaces.,1;
interface
is,1;
not,1;
a,1;
indicate
that,1;
at,1;
do,1;
meantime,1;
completes.,1;
a,1;
a,1;
defined,1;
Listing,1;
“here,1;
type
Poll,1;
usually,1;
signal,1;
attempt,1;
blocking.,1;
how,1;
do,1;
attempt,1;
before,1;
would,1;
resume,1;
additional,1;
progress,1;
multiple,1;
For,1;
if,1;
either,1;
or
the,1;
whichever,1;
have,1;
a,1;
additional,1;
word,1;
a,1;
little,1;
nervous.,1;
burn,1;
through,1;
a,1;
a,1;
occurs.,1;
interfaces,
this,1;
wasn’t,1;
a,1;
problem,1;
put,1;
waking,1;
a,1;
do,1;
we,1;
waiting,1;
chapter,1;
8Standardized,1;
a,1;
a,1;
could,1;
have,1;
cook,1;
methods,,1;
would,1;
quickly
get,1;
Rust,,1;
standardized,1;
through,1;
A,1;
simplified,1;
Listing,1;
(we’ll,1;
to
the,1;
poll(&mut,1;
self),1;
->,1;
A,1;
simplified,1;
known,1;
repre-
sent,1;
not,1;
yet.,1;
A,1;
could,1;
a,1;
packet,1;
in,,1;
mouse,1;
point,1;
at,1;
read
Future<Output,1;
a,1;
often,1;
a,1;
we,1;
a,1;
T.
With,1;
place,,1;
we,1;
poll
methods.,1;
we,1;
Output,1;
have,1;
does,1;
at,1;
we,1;
poll_,1;
not,1;
a,1;
If
you,1;
A,1;
Ready,1;
sometimes,1;
a,1;
future.
Ergonomic,1;
a,1;
is
quite,1;
a,1;
take,1;
a,1;
look,1;
at,1;
straightforward,1;
Listing,1;
Some(t),1;
Implementing,1;
a,1;
using,1;
async,1;
code,,1;
written,1;
using,1;
async,1;
await,1;
mes-
sage,1;
we,1;
a,1;
await
point,1;
a,1;
a,1;
variant,1;
if,1;
manually,1;
call,1;
at,1;
yielded.,1;
Listing,1;
Forward<T>,1;
Forward<T>,1;
Output,1;
poll(&mut,1;
self),1;
->,1;
v)),1;
5
//,1;
progress,1;
send.poll(),1;
rx.take().unwrap();
*self,1;
progress,1;
a,1;
have,1;
how,1;
things,1;
First,,1;
we,1;
define,1;
we’ll,1;
waiting,1;
on.,1;
a,1;
we,1;
call,1;
at,1;
the
function,1;
we,1;
we,1;
on.,1;
we,1;
depending,1;
if,1;
a,1;
we,1;
not,1;
we,1;
ourselves,,1;
same,1;
Options,1;
weird,1;
we’ll,1;
we,1;
we,1;
as
(),1;
result),1;
a,1;
Output,1;
a,1;
could,1;
But,1;
we’ll,1;
Forward,1;
resume,1;
we,1;
out,1;
variant,1;
held,1;
For,1;
whichever,1;
we,1;
step,1;
progress,1;
if,1;
if,1;
we,1;
call,1;
we,1;
progress,,1;
and
we,1;
Poll::Pending,1;
But,1;
if,1;
we,1;
the
current,1;
variant,1;
stored,1;
self.
In,1;
do,1;
we,1;
have,1;
out,1;
call,1;
we,1;
do,1;
we,1;
have,1;
we,1;
have,1;
we,1;
out,1;
Options,1;
always,1;
sometimes,1;
happy.
Finally,,1;
if,1;
we,1;
do,1;
progress,,1;
we,1;
immediately,1;
progress,1;
we,1;
real
Future,1;
trait,,1;
we’ll,1;
a,1;
a,1;
a,1;
possible
states,1;
moves,1;
response,1;
at,1;
Imagine,1;
complicated,1;
have,1;
additional,1;
we,1;
have,1;
we,1;
out,1;
have,1;
take,1;
sender,1;
if,1;
not,,1;
lifetimes,1;
would,1;
would,1;
we,1;
poll.,1;
But,1;
have,1;
a,1;
lot,1;
have,1;
same,1;
way
to,1;
a,1;
specifically,1;
first-class,1;
support,,1;
If
we,1;
significantly.,1;
Luckily,,1;
a,1;
way!
async/await
Rust,1;
async,1;
closely,1;
related,1;
await,1;
we,1;
Listing,1;
a,1;
machines,1;
Listing,1;
8-5.,1;
a,1;
look,1;
a,1;
Some(t),1;
8-5:,1;
Implementing,1;
a,1;
using,1;
async,1;
await,,1;
Listing,1;
have,1;
async,1;
await,,1;
Listing,1;
Listing,1;
8-5,1;
give,1;
But,1;
a,1;
little,1;
how,1;
implementation.,1;
do,1;
async,1;
and
await,1;
described,,1;
a,1;
a,1;
bits,1;
stop,,1;
through
and,1;
resume,1;
yielded,1;
on.,1;
Listing,1;
Imagine,1;
call,1;
full.,1;
any,1;
progress,
but,1;
cannot,1;
code,,1;
we,1;
we,1;
call,1;
top,,1;
call,1;
we,1;
a,1;
cannot,1;
progress,1;
resumes,,1;
through,1;
at,1;
a,1;
given,1;
point,1;
resume,1;
stored,1;
updates,1;
cannot,1;
“return,1;
me,1;
resume,1;
we,1;
resume,1;
a,1;
call,1;
forward,,1;
we,1;
invoke,1;
point,1;
resume,1;
stored,1;
do,1;
same,1;
we,1;
manually,1;
Listing,1;
8-5,1;
Listing,1;
{
loop,1;
f,1;
if,1;
f.poll(),1;
Some(t),1;
f,1;
tx.send(t);
let,1;
_,1;
if,1;
f.poll(),1;
break,1;
}
}
}
Listing,1;
Desugaring,1;
a,1;
writing,,1;
not,1;
internally,1;
a,1;
a,1;
to
implement,1;
out,1;
how,1;
at,1;
a,1;
look,1;
closely,1;
at,1;
8-5,1;
8-6,,1;
a,1;
little,1;
await,1;
a,1;
it’s,1;
not,1;
clear
how,1;
we,1;
resume,1;
on.,1;
play.,1;
transparently
injects,1;
at,1;
So,1;
if,1;
are
really,1;
imple-
mentation,1;
Sender::send
in,1;
Listing,1;
8-5,1;
take,1;
Listing,1;
we,1;
a,1;
state
Asynchronous,1;
Programming
125machine,1;
implementation,,1;
would,1;
have,1;
stored,1;
Forward,1;
cannot,1;
Only,1;
moving,1;
we,1;
not,1;
Meanwhile,,1;
with
async/await,,1;
before,1;
a,1;
not,1;
again
until,1;
await,1;
GENER,1;
ATORS
The,1;
a,1;
must,1;
at,1;
any,1;
async,1;
a,1;
[u8;,1;
8192],
those,1;
must,1;
stored,1;
if,1;
async,1;
variables,,1;
must,1;
any,1;
a,1;
blocks,,1;
any,1;
visible,1;
indicator,1;
impact,1;
program’s,1;
have,1;
copied,1;
out,1;
a,1;
copying.,1;
usually,1;
of
time,1;
profiles!
Finding,1;
always,1;
often,1;
requires
manually,1;
async,1;
at,1;
writing,,1;
you’re,1;
do,1;
a,1;
have,1;
reduce,1;
async,1;
moving,1;
moving,1;
go,,1;
introduces,1;
a,1;
best,1;
put,1;
performance,
and,1;
there.
Pin,1;
Unpin
We’re,1;
not,1;
While,1;
a,1;
arises,1;
it’s,1;
not,1;
if,1;
async,1;
takes
a,1;
a,1;
variable.,1;
Listing,1;
must,1;
a,1;
if,1;
a,1;
not,1;
immediately,1;
away,1;
generator.,1;
But,1;
if,1;
look,1;
at,1;
->,1;
f,1;
forward(rx,,1;
tx);
if,1;
Some(f),1;
a,1;
blocking.,1;
still,1;
if,1;
Poll::Pending,1;
messages,1;
at,1;
at,1;
a,1;
fit.
Let’s,1;
through,1;
we,1;
await,1;
we,1;
through,1;
if,1;
ended,,1;
Poll::Pending,1;
returns
Poll::Pending,,1;
a,1;
either,1;
a,1;
argu-
ments,1;
(rx,1;
must,1;
stored,1;
generator.,1;
But,1;
same,1;
references,1;
stored,1;
pointing,1;
data!
What,1;
a,1;
a,1;
references,1;
would,1;
a,1;
would,1;
references,1;
any,1;
a,1;
(safely),1;
a,1;
says,1;
a,1;
a,1;
lot,1;
a,1;
concrete,1;
of
the,1;
wrapper.,1;
Listing,1;
a,1;
simplified,1;
trait,
but,1;
Listing,1;
8-8
shows,1;
somewhat,1;
final,1;
form.
trait,1;
poll(self:,1;
->,1;
A,1;
simplified,1;
call,1;
have,1;
a,1;
a,1;
a,1;
generators.
NOTE
While,1;
makes,1;
not,1;
how,1;
do,1;
a,1;
call,1;
how,1;
ensure,1;
that
the,1;
won’t,1;
how,1;
std::pin::Pin,1;
methods,,1;
8-9.
struct,1;
}
impl<P>,1;
P:,1;
->,1;
->,1;
P:,1;
deref(&self),1;
->,1;
8-9:,1;
std::pin::Pin,1;
methods
There’s,1;
a,1;
lot,1;
going,1;
have,1;
Listing,1;
a,1;
before,1;
bits,1;
please
bear,1;
you’ll,1;
notice,1;
a,1;
a,1;
through,1;
T.,1;
have,1;
a,1;
you’ll,1;
have,1;
a,1;
MyType>.,1;
a,1;
a,1;
that
T,1;
won’t,1;
doing,1;
stored,1;
T.,1;
If
the,1;
held,1;
a,1;
moving,1;
would,1;
target,1;
notice,1;
new_unchecked,,1;
is
because,1;
pointed-to,1;
won’t,1;
a,1;
foo,1;
could,1;
do,1;
Pin::new(&mut,1;
call,1;
a,1;
assumes,1;
won’t,1;
we,1;
could,1;
foo,1;
we,1;
moving,1;
could,1;
call,1;
would,1;
any,1;
point-
ers,1;
have,1;
would,1;
TRUC,1;
SAFE,1;
depends,1;
themselves,1;
safe.,1;
For,1;
While,1;
call,1;
not.,1;
a,1;
T.,1;
same,1;
not,1;
type
will,1;
not,1;
target,1;
example),
but,1;
implementations,1;
do,1;
not,1;
a,1;
mutable
reference,1;
unsafe,
because,1;
we,1;
give,1;
out,1;
a,1;
won’t,1;
any,1;
a,1;
a,1;
call,1;
variant,1;
mem::swap,1;
we,1;
call,1;
a,1;
either,1;
assumption,1;
would,1;
any,1;
references,1;
stored,1;
would,1;
always,1;
T>,,1;
safe.,1;
a,1;
&T,1;
does,1;
not,1;
we’ll,1;
a,1;
part
of,1;
(unsafely),1;
replaced,1;
a,1;
using,1;
could,1;
&T,1;
a,1;
T>,,1;
though,1;
replaced,1;
&T,1;
not,1;
browsed,1;
through,1;
a,1;
a,1;
<P,1;
does,1;
not,1;
return
the,1;
pinned—it,1;
drops,1;
stores,1;
does,1;
not,1;
pinning,1;
a,1;
point,1;
given,1;
a,1;
not,1;
have,1;
a,1;
through,1;
a,1;
could,1;
call,1;
if,1;
a,1;
we,1;
is
so,1;
we,1;
have,1;
target,1;
references,1;
themselves,1;
generator),1;
give,1;
a,1;
target,1;
hasn’t
moved,1;
enforce,1;
But,1;
far,,1;
code,,1;
if,1;
a,1;
target,1;
that
doesn’t,1;
any,1;
self-references,,1;
it’s,1;
play.,1;
a,1;
out,1;
a,1;
Pin
when,1;
a,1;
target,1;
not,1;
moving,1;
broken.,1;
any,1;
Only,1;
opt,1;
out,1;
target,1;
we,1;
a,1;
Listing,1;
P:,1;
->,1;
P:,1;
self),1;
->,1;
target,1;
sense,1;
Listing,1;
Listing,1;
8-9:,1;
must,1;
cannot,1;
do,1;
not,1;
through,1;
receive.,1;
we,1;
give,1;
out,1;
a,1;
a,1;
we,1;
does,1;
not,1;
if,1;
if,1;
it’s,1;
if,1;
does,1;
not,1;
any,1;
must,1;
out,1;
it’s,1;
we,1;
we,1;
if,1;
target,1;
a,1;
understanding,1;
we,1;
progress
toward,1;
using,1;
Listing,1;
step,1;
future
type,1;
step,1;
Pin::new(&mut,1;
we,1;
pinning,1;
the
heap,1;
pinning,1;
stack.
Let’s,1;
pinning,1;
heap.,1;
that
once,1;
cannot,1;
pinning,1;
any,1;
a,1;
ensure,1;
if,1;
does,1;
not,1;
ensure,1;
a,1;
a,1;
a,1;
contracts.
UNPIN,1;
take,1;
a,1;
look,1;
at,1;
for
Box.,1;
any,1;
if,1;
given,1;
a,1;
if,1;
same,1;
a,1;
if,1;
a,1;
do,1;
not,1;
out,1;
a,1;
if,1;
cannot,1;
out,1;
a,1;
does,1;
not,1;
a,1;
!Unpin,1;
out,1;
a,1;
pinning,1;
a,1;
little,1;
a,1;
have,1;
ensure
that,1;
cannot,1;
a,1;
accomplish,1;
the
macro,1;
Listing,1;
using,1;
One,1;
library!
macro_rules!,1;
$var,1;
$var,1;
Macro,1;
pinning,1;
taking,1;
wants,1;
$var,1;
cannot,1;
would,1;
breach,1;
any,1;
target,1;
!Unpin).,1;
moving,1;
cannot,1;
$var,1;
could,1;
foo,1;
/*,1;
*/;,1;
foo.mut_self_method();
Here,,1;
we,1;
give,1;
a,1;
foo,1;
we,1;
foo,1;
a,1;
would,1;
foo,1;
new
scope,,1;
code,,1;
Box::pin,
but,1;
introduces,1;
have,1;
we,1;
But,1;
have,1;
pinning,1;
stuff,1;
in
most,1;
async,1;
we,1;
Listing,1;
like:
loop,1;
if,1;
break,1;
seen,,1;
if,1;
have,1;
a,1;
a,1;
sophisticated,,1;
Listing,1;
match,1;
{
2,1;
match,1;
{
Poll::Ready(r),1;
break,1;
A,1;
accurate,1;
<expr>.await
The,1;
match,1;
a,1;
not,1;
ensure,1;
a,1;
into
a,1;
we,1;
new
addition,1;
call,1;
call,1;
async,1;
must,1;
async,1;
call,1;
Pin::new_unchecked,,1;
pinned
is,1;
stored,1;
async,1;
must,1;
resume,1;
we,1;
not,1;
not,1;
through,1;
a,1;
out,1;
we,1;
Pin::new_unchecked,,1;
weeds,1;
out,1;
the
other,1;
have,1;
itch.,1;
a,1;
call,1;
need
something,1;
call,1;
at,1;
a,1;
yet.,1;
usually,1;
a,1;
waiting,1;
would,1;
burn,1;
a,1;
lot,1;
CPU,1;
have,1;
other,,1;
browser.,1;
we,1;
do,1;
whatever,1;
sleep.,1;
futures
can,1;
progress,,1;
do,1;
before,1;
going
to,1;
Up
The,1;
a,1;
given,1;
a,1;
packet,1;
“when
the,1;
mouse,1;
moves,”,1;
someone,1;
“when
the,1;
CPU,1;
a,1;
have,1;
cases,,1;
introduces,1;
a,1;
signal,1;
progress,1;
The
Waker,1;
makes,1;
machinery,1;
a,1;
uses,1;
any,1;
addi-
tional,1;
Listing,1;
8-13,1;
final,1;
poll(self:,1;
Self>,,1;
->,1;
Context
The,1;
a,1;
not,1;
we,1;
deemed,1;
(and,1;
by-reference,1;
variant,1;
effects,1;
whatever,1;
to
dictate,1;
called,,1;
a,1;
a,1;
through,1;
a,1;
manually,1;
similarly,1;
we,1;
a,1;
somewhat,1;
a,1;
using,1;
a,1;
Clone,1;
usually,1;
shared,1;
a,1;
specific,1;
to
each,1;
it’s,1;
a,1;
a,1;
Poll,1;
a,1;
does,1;
a,1;
if,1;
ensure,1;
progress.,1;
this
property,1;
Poll::Pending,1;
if,1;
must,1;
same,1;
But,1;
turtles,1;
a,1;
does,1;
not,1;
does,1;
a,1;
attempt
to,1;
a,1;
commonly,1;
have,1;
A,1;
directly
represents,1;
not,1;
a,1;
call,1;
Listing,1;
same,1;
a,1;
receiver),,1;
events,1;
a,1;
packet,1;
events,1;
same,1;
have,1;
call,1;
For,1;
a,1;
a,1;
stores,1;
shared,1;
between
the,1;
sender,1;
a,1;
along,1;
a,1;
waiting,1;
before,1;
events,1;
waiting,1;
futures
or,1;
often,1;
a,1;
disk,1;
a,1;
expires,,1;
could,1;
be
a,1;
C,1;
a,1;
A,1;
external
resource,1;
could,1;
spin,1;
a,1;
a,1;
C,1;
waking,1;
would,1;
would,1;
spin,1;
a,1;
waiting,1;
executors,1;
implementations,1;
communicate,1;
orchestrated,1;
depends,1;
speaking,1;
sleep.,1;
a,1;
must,1;
updates,1;
it’s,1;
exter-
nal,1;
various,1;
waiting,1;
does,1;
a,1;
big,1;
call,1;
any,1;
waiting,1;
usually,1;
call;
Windows,,1;
call,1;
events,1;
for,,1;
fulfilled.
NOTE
A,1;
reactor,1;
to
separate,1;
though,1;
together,1;
often,1;
readily.
A,1;
often,1;
cannot,1;
a,1;
at,1;
cannot,1;
running.,1;
it’s,1;
waiting,1;
for,,1;
have,1;
monitored,1;
not,1;
not,1;
always,1;
means
that,1;
transparently,1;
multiple,1;
executors,1;
run-
ning,1;
at,1;
same,1;
reduce,1;
multiple,1;
executors,1;
multiple,1;
executors,1;
have,1;
resources.,1;
For,1;
using,1;
a,1;
executor’s
Asynchronous,1;
Programming
135TcpStream,1;
a,1;
a,1;
generic,1;
traits
should,1;
look,1;
it’s,1;
generic,1;
For,1;
somewhat,1;
common,1;
if,1;
a,1;
we’ll,1;
a,1;
a,1;
have,1;
to
wake,1;
For,1;
events,1;
call,1;
a,1;
reality,1;
a,1;
a,1;
reality,,1;
a,1;
progress.,1;
if
it,1;
a,1;
side
effect,1;
First,,1;
a,1;
future
and,1;
it’s,1;
not,1;
returns
Poll::Pending,,1;
a,1;
progress
an,1;
forth,1;
vice,1;
always,1;
unnecessarily.,1;
manages,1;
pending
futures,,1;
made,1;
would,1;
a,1;
a,1;
contain
any,1;
give,1;
whatever,1;
point,1;
between
the,1;
point,1;
must,1;
figure,1;
out
which,1;
a,1;
called,,1;
made,1;
for—to,1;
various,1;
a,1;
must,1;
progress.,1;
each
future,1;
tree,,1;
through,1;
tree.
The,1;
often,1;
obvious,,1;
not,1;
async/await,,1;
But,1;
a,1;
prog-
ress,1;
a,1;
a,1;
a,1;
A,1;
a,1;
subexecutor.,1;
could,1;
doing,1;
could,1;
subexecutors,1;
often,1;
before,1;
invoke,1;
code,,1;
before,1;
call,1;
figure,1;
out,1;
call,1;
IN,1;
A,1;
CODE
You,1;
must,1;
any,1;
spends,1;
a,1;
period,1;
might
happen,1;
a,1;
call,1;
a,1;
responsible,1;
won’t,1;
get
to,1;
when
certain,1;
progress,1;
a,1;
execute.
Some,1;
executors,1;
a,1;
could,1;
a,1;
the
blocking,1;
compute-intensive
operations,1;
could,1;
context.
Such,1;
either,1;
converted,1;
executed,1;
communicate,1;
using,1;
does,1;
asynchrony,,1;
a,1;
Some,1;
executors,1;
indicating,1;
a,1;
not,1;
compose,1;
A,1;
Programming
137Tying,1;
All,1;
executors,,1;
a,1;
We’re,1;
a,1;
Let’s,1;
do,1;
First,,1;
Listing,1;
->,1;
Result<()>,1;
given,1;
->,1;
Result<()>,1;
big,1;
does,1;
a,1;
hand,1;
you’ll,1;
have,1;
exec-
utor,1;
call,1;
not,1;
could,1;
always,1;
later).
Now,,1;
a,1;
in,,1;
makes,1;
a,1;
handling,1;
a,1;
we,1;
await,1;
move
on,1;
we,1;
at,1;
a,1;
a,1;
connec-
tion,,1;
called,,1;
we,1;
await,1;
we,1;
could,1;
a,1;
if,1;
any,1;
progress.,1;
Listing,1;
look,1;
->,1;
Result<()>,1;
Vec::new();
loop,1;
clients)?;
if,1;
socket.try_accept()?,1;
a,1;
at,1;
concurrently,,1;
it’s,1;
not,1;
handling,1;
we,1;
have,1;
accept-
ing,1;
progress,1;
await,1;
at,1;
any,1;
would,1;
making,1;
progress.,1;
could
implement,1;
ensure,1;
progress,,1;
going,1;
devel-
oping,1;
the
server,1;
single-threaded.,1;
poll
it,1;
must,1;
at,1;
a,1;
to
the,1;
the
server,1;
if,1;
cannot,1;
progress,1;
machinery,1;
progress,1;
best,1;
if,1;
Listing,1;
8-16,1;
of
what,1;
look,1;
->,1;
Result<()>,1;
Spawn,1;
a,1;
(and,1;
8-16:,1;
Spawning,1;
create,1;
concurrently
When,1;
a,1;
a,1;
it’s,1;
sort,1;
spawn-
ing,1;
a,1;
thread.,1;
any,1;
given,1;
a,1;
still,1;
depend,1;
either,1;
code,,1;
making,1;
progress.,1;
imagine,1;
hap-
pen,1;
if,1;
code,,1;
cannot,1;
executors,1;
often,1;
if,1;
yields,1;
not,1;
executors,1;
do,1;
before,1;
rely
on,1;
a,1;
look,1;
how,1;
we,1;
how,1;
how,1;
executors,1;
progress,1;
at,1;
any,1;
given,1;
next
chapter,,1;
we’ll,1;
a,1;
those
watching,1;
While,1;
it’s,1;
big,1;
a,1;
chapter,
I,1;
a,1;
explain,1;
how,1;
using,1;
safely.,1;
writing,,1;
still,1;
determined,,1;
if,1;
nailed,1;
down,,1;
would,1;
best,1;
blocks,,1;
tooling,1;
through,1;
chapter,1;
taking,1;
that,
for,1;
whatever,1;
cannot,1;
look,1;
at,1;
does,1;
be,,1;
we,1;
a,1;
talking,1;
a,1;
lot,1;
Invariant,1;
saying,1;
must,1;
For,1;
Rust,,1;
using,1;
not,1;
always,1;
point,1;
values.,1;
have,1;
invariants,,1;
always,1;
always,1;
a,1;
two.”,1;
However,
you,1;
not,1;
always,1;
aware,1;
not,1;
a,1;
various,1;
Rust,,1;
a,1;
enforce,1;
using,1;
reasoning
that,1;
code,,1;
ensure,1;
safe.,1;
a,1;
a,1;
through,1;
{};
it’s,1;
not,1;
it’s,1;
rest,1;
chapter,1;
four,1;
a,1;
brief
examination,1;
how,1;
we’ll,1;
look,1;
at,1;
must,1;
give,1;
how,1;
we,1;
we,1;
serves,1;
a,1;
in
Rust:,1;
marks,1;
a,1;
call,1;
to
invoke,1;
a,1;
For,1;
Listing,1;
though,1;
serves,1;
a,1;
additional,1;
someone,1;
who,1;
invokes
decr,1;
must,1;
manually,1;
{
self.some_usize,1;
-=,1;
though,1;
->,1;
&T,1;
}
}
}
Listing,1;
A,1;
embody
different,1;
call,1;
the
method,,1;
assumes,1;
imagine,1;
though,1;
a,1;
through,1;
call,1;
drops,1;
still,1;
call,1;
a,1;
consequences,1;
a,1;
at,1;
if,1;
a,1;
code,,1;
always,1;
&self,1;
exists,1;
proof,1;
must,1;
still,1;
give,1;
a,1;
a,1;
how,1;
today.,1;
if,1;
always,1;
invoke,1;
a,1;
it’s,1;
about
having,1;
likely,1;
a,1;
future
editions,1;
reduce,1;
For,1;
Listing,1;
9-1,,1;
under
the,1;
could,1;
have,1;
distinction,1;
a,1;
a
mechanism,1;
have,1;
whoever,1;
care-
fully,1;
any,1;
performed
inside,1;
approximate,1;
Z.”,1;
Meanwhile,,1;
{},1;
signing,1;
contracts,1;
mind,1;
through,1;
rest,1;
Power
So,,1;
{},,1;
do?,1;
not,1;
much.,1;
point-
ers,1;
call,1;
a,1;
things,1;
of
unions,,1;
much.,1;
honestly,,1;
that’s
enough.,1;
dereferencing,1;
point-
ers,1;
point,1;
who,1;
making,1;
types
shareable,1;
though,1;
not,1;
thread-safe.
In,1;
we,1;
won’t,1;
we’ll,1;
look,1;
at,1;
toys,1;
do,1;
them.
Juggling,1;
Pointers
One,1;
fundamental,1;
T.,1;
&T,1;
have,1;
lifetimes,1;
same,1;
validity,1;
we’ll,1;
discuss
later,1;
interchangeably,1;
point-
ers,1;
makes,1;
a,1;
a,1;
Only,1;
if,1;
*
to,1;
do,1;
a,1;
a,1;
do,1;
things,1;
pointed-to,1;
modi-
fying,1;
value.,1;
For,1;
a,1;
common,1;
look,1;
a,1;
not,1;
dereferencing,1;
makes,1;
sense
if,1;
look,1;
at,1;
if,1;
have,1;
a,1;
a,1;
give,1;
a,1;
T.,1;
a,1;
T
and,1;
still,1;
Variance”,1;
primarily,1;
NonNull<T>,1;
not,1;
a,1;
pointer,
whereas,1;
best,1;
would,1;
have,1;
written,1;
if,1;
the
relevant,1;
would,1;
have,1;
written,1;
benefits,1;
a,1;
be
null,,1;
any,1;
a,1;
a,1;
niche,1;
T.,1;
if,1;
would,1;
have,1;
do,1;
not,1;
have,1;
circumstances
where,1;
cannot,1;
stati-
cally,1;
a,1;
a,1;
we,1;
A,1;
points
into,1;
(and,1;
a,1;
if,1;
away,1;
someone,1;
they
could,1;
9-3,1;
we,1;
attempt,1;
a,1;
stored,1;
representation.
struct,1;
[u8;,1;
1024],
parsed:,1;
9-3:,1;
a,1;
wants,1;
stored,1;
we,1;
assign,1;
not,1;
do,1;
not,1;
have,1;
have,1;
do,1;
it’s,1;
still,1;
valid,,1;
Listing,1;
9-3,
Person,1;
would,1;
a,1;
a,1;
still,1;
arises,1;
a,1;
a,1;
a,1;
shared,1;
duration,,1;
known,1;
at,1;
Arc,1;
kind-of,,1;
Arc,1;
Arc’s
cousin,,1;
Arc,1;
away,”,1;
Arc,1;
Weak,1;
Arithmetic
With,1;
do,1;
using,1;
lives,1;
same,1;
often,1;
storing,1;
extra
pointer,1;
would,1;
using,1;
slices
isn’t,1;
possible.,1;
niche,1;
cases,,1;
we,1;
won’t,1;
encourage,1;
if,1;
call,1;
if,1;
a,1;
a,1;
couple
of,1;
a,1;
to
eat,1;
a,1;
do,1;
methods,,1;
Pointer,1;
it’s,1;
have,1;
a,1;
a,1;
slice,,1;
a,1;
string,,1;
have,1;
a,1;
a,1;
constituent,1;
a,1;
a,1;
a,1;
slice,,1;
a,1;
using,1;
same
parts.,1;
For,1;
a,1;
slice’s,1;
String,1;
have,1;
a,1;
has
Box::into_raw,1;
do,1;
same,1;
Types
Sometimes,,1;
have,1;
a,1;
do,1;
provides,1;
tools,1;
do,1;
casting:,1;
a,1;
any,1;
(and,1;
same,1;
do,1;
a,1;
have,1;
a,1;
it’s,1;
pointing,1;
interfaces,1;
any,1;
std::ffi::c_void,1;
a,1;
C,1;
a,1;
if,1;
a,1;
C,1;
in,,1;
interpret,1;
a,1;
Booleans,,1;
out,1;
a,1;
lot,1;
mind,1;
if,1;
do,1;
we’ll,1;
later.
Calling,1;
unsafe’s,1;
commonly,1;
are
unsafe,1;
at,1;
fundamental,1;
primarily,1;
But,1;
interfaces,,1;
have,1;
custom
invariants.
Foreign,1;
Interfaces
Rust,1;
defined,1;
a
language,1;
using,1;
we’ll,1;
at,1;
a,1;
you’re,1;
final,1;
a,1;
C,1;
call,1;
a,1;
C,1;
Rust,,1;
over-
write,1;
random,1;
kernel,1;
somewhere.,1;
could,1;
modified,1;
at,1;
any,1;
reflect,1;
though,,1;
you’re,1;
willing,1;
vouch,1;
according,1;
Safety,1;
made,1;
addi-
tional,1;
checks.,1;
For,1;
a,1;
how,1;
common,1;
if,1;
either,1;
out,1;
bounds.,1;
if,1;
slice’s,1;
rather
than,1;
you’ll,1;
a,1;
using,1;
ultimate,1;
a,1;
little,1;
usually,1;
word,1;
blindly,1;
arguments,1;
do,1;
not,1;
do,1;
any,1;
checks.,1;
Some,1;
are
NonNull::new_unchecked,,1;
Arc::get
_mut_unchecked,,1;
always,1;
optimization,,1;
Invariants
Most,1;
uses,1;
they
rely,1;
specific,1;
to
the,1;
this
category,,1;
it’s,1;
give,1;
a,1;
give,1;
use:
MaybeUninit::assume_init
The,1;
not,1;
a
MaybeUninit<T>,1;
a,1;
not,1;
a,1;
at,1;
moment.
For,1;
a,1;
a,1;
a,1;
a
148
Chapter,1;
must,1;
1).,1;
if,1;
a,1;
made,1;
through
a,1;
call,1;
a,1;
a,1;
a,1;
a,1;
does,1;
(ManuallyDrop),1;
drop-
ping,1;
provides,1;
a,1;
drop-
ping,1;
if,1;
have,1;
a,1;
cannot,1;
implementations,1;
it
is,1;
call,1;
call,1;
a,1;
value’s,1;
through,1;
a,1;
pointer
to,1;
value.,1;
behind
after,1;
if,1;
a,1;
8,1;
we,1;
how,1;
made,1;
a,1;
a,1;
manually,1;
a,1;
drop(waker),,1;
vtable,1;
forth,1;
RawWakerVTable.
std::hint::unreachable_unchecked
The,1;
give,1;
do,1;
not,1;
any,1;
it
is,1;
a,1;
section,1;
at,1;
runtime.
This,1;
eliminating,1;
location.
Unlike,1;
macro,,1;
panics,1;
if,1;
does,1;
question,,1;
effects,1;
erroneous,1;
are
hard,1;
and
hard-to-debug,1;
not,1;
a,1;
do,1;
not,1;
read_unaligned,1;
point,1;
a,1;
not,1;
stored,1;
according,1;
section,1;
if,1;
notable,1;
point,1;
to
normal,1;
always,1;
won’t,1;
a,1;
if,1;
same,1;
a,1;
won’t,1;
volatile,1;
volatile,1;
accesses.,1;
11.
Ultimately,,1;
the
given,1;
(and,1;
at,1;
contracts,1;
doing,1;
thread::spawn,1;
we,1;
closure,1;
bound,1;
a,1;
before,1;
exits,,1;
invalid.,1;
non-'static
value,1;
thread.,1;
before,1;
question,,1;
if,1;
will
no,1;
does,1;
bound,1;
you’re,1;
willing,1;
saying,1;
a,1;
panics,,1;
though;,1;
if,1;
pan-
ics,,1;
planned,1;
(and,1;
explicit,1;
any,1;
For,1;
imple-
ment,1;
functions,,1;
have,1;
it’s
difficult,1;
a,1;
give,1;
going,1;
over.
Send,1;
a,1;
across
thread,1;
auto-traits,
and,1;
usually,1;
But,,1;
tends,1;
not,1;
if,1;
any,1;
not,1;
themselves,1;
code,,1;
problem,1;
primarily,1;
might
seem,1;
who,1;
have,1;
a,1;
same,1;
how,1;
using,1;
at,1;
moment,,1;
though,,1;
a,1;
handling,1;
any,1;
could,1;
if,1;
would,1;
though,1;
would,1;
if,1;
shared,1;
implementations,1;
additional,1;
have,1;
invariants.
NOTE
A,1;
common,1;
implementations,1;
generic,1;
how,1;
a,1;
won’t,1;
Listing,1;
9-4,1;
trait.
Unsafe,1;
->,1;
ptr:,1;
u8,,1;
methods
At,1;
a,1;
a,1;
we,1;
a,1;
must,1;
restrictions,1;
trait,,1;
not,1;
Only,1;
assumes,1;
Box.,1;
not,1;
a,1;
allocations,,1;
would,1;
assumes,1;
would,1;
break,1;
that
safe,1;
not,1;
not,1;
a,1;
a,1;
ensure,1;
invali-
dated,1;
if,1;
have,1;
established,1;
a,1;
remove,1;
a,1;
a,1;
First,,1;
Implementing,1;
a,1;
does,1;
not,1;
a,1;
!Unpin,1;
still,1;
a,1;
call,1;
a,1;
any,1;
control:,1;
a,1;
you’re,1;
if,1;
stored,1;
a,1;
any,1;
Pin::new_unchecked,,1;
create,1;
a,1;
!Unpin,1;
a,1;
Unsafe
Few,1;
same,1;
A,1;
if,1;
assumes,1;
exhibit,1;
if,1;
not,1;
a,1;
mind,1;
can
easily,1;
a,1;
a,1;
if,1;
could,1;
would,1;
if,1;
cloned,1;
could,1;
not,1;
a,1;
While,1;
if,1;
imple-
mentation,1;
not,1;
always,1;
a,1;
safe
(indeed,,1;
always,1;
making,1;
then
make,1;
if,1;
Just,1;
mind,1;
a,1;
change.
Also,1;
mind,1;
feels,1;
a,1;
would,1;
a,1;
lot,1;
a,1;
unsafety,,1;
not,1;
business,1;
logic.,1;
For,1;
Hash,1;
though,1;
likely,1;
would,1;
haywire,1;
if,1;
a,1;
malicious,1;
of,,1;
Hash,1;
a,1;
random,1;
extends,1;
almost,1;
out,1;
would,1;
does,1;
not,1;
Hash,1;
same,1;
a,1;
target,1;
would,1;
Hash,1;
does,1;
not,1;
Hash,1;
deterministic,,1;
code,,1;
not,1;
not,1;
interactions.
Great,1;
far,,1;
at,1;
various,1;
things,1;
But,1;
do,1;
things,1;
if,1;
it
does,1;
safely.,1;
though,1;
a,1;
must,1;
do,1;
if,1;
a,1;
poin-
tee,1;
at,1;
given,1;
tools,1;
could,1;
do,1;
must,1;
do,1;
things,1;
using,1;
a,1;
types?,1;
we’ll,1;
Code
153invariants,1;
mind,1;
look,1;
at,1;
tools,1;
worked,1;
writing,,1;
Group,1;
at,1;
section,1;
call,1;
out,1;
any,1;
isn’t.,1;
section,1;
teach,1;
making
assumptions,1;
code,,1;
before,1;
Go,1;
Wrong?
We,1;
must,1;
if,1;
Let’s,1;
do,1;
mutably
access,1;
a,1;
multiple,1;
concurrently,,1;
a,1;
not,1;
through,1;
visible,1;
through,1;
corruption.,1;
case—you,1;
not,1;
you’re,1;
a,1;
happiness,1;
Should
a,1;
optimization,,1;
do,1;
if,1;
same,1;
same,1;
if,1;
a,1;
act,1;
is
important,1;
if,1;
seems
to,1;
do,1;
a,1;
round,1;
survived,1;
catch.,1;
a,1;
error,,1;
debug,1;
difficult,,1;
at,1;
have,1;
a,1;
that
something,1;
panics,1;
printed,1;
trig-
ger,1;
a,1;
a,1;
have,1;
manifestation,1;
visible,1;
effect,,1;
be,,1;
corrupted,,1;
random,1;
bits,1;
clients.,1;
could,1;
non-
safe,1;
not,1;
entirely,
154
Chapter,1;
9dramatically,1;
code,,1;
What,1;
does,1;
dependent,1;
impact,1;
how,1;
often,1;
if,1;
doing,1;
weird,1;
would,1;
would,1;
is
rarely,1;
explicit,1;
usually,1;
assumption,1;
out,1;
not,1;
still,1;
valid,,1;
maybe,1;
it’s,1;
not,,1;
seman-
tics,1;
we,1;
assume
anything,1;
code,,1;
cannot,1;
a,1;
success,1;
today.,1;
assumptions
about,1;
cannot,1;
do,1;
according,1;
language
specification.
If,1;
a,1;
how,1;
it’s,1;
assign,1;
through,1;
blog,1;
Better,1;
concept,1;
before,1;
a,1;
a,1;
values.,1;
concept,1;
concrete,1;
must,1;
dangle,,1;
must,1;
always,1;
must,1;
always
point,1;
a,1;
target,1;
a,1;
shared,1;
a,1;
given,1;
location,1;
at,1;
multiple,1;
references,1;
a,1;
uses,1;
references,1;
not,1;
create,1;
a,1;
if,1;
immediately,1;
references,1;
have,1;
additional,1;
any,1;
must,1;
same,1;
if,1;
have,1;
a,1;
a,1;
you
are,1;
not,1;
through,1;
though,1;
do,1;
using,1;
All,1;
Cell,,1;
internally,1;
references,1;
take,1;
a,1;
a,1;
a,1;
layout,1;
a,1;
if,1;
packed,
then,1;
some_struct.field,1;
not,1;
Further,,1;
if,1;
fully,1;
cannot,1;
a,1;
a,1;
a,1;
a,1;
problem.,1;
using,1;
references,1;
pointers),,1;
create,1;
rather
than,1;
going,1;
a,1;
reference.,1;
references,1;
introduced,1;
stabilized,1;
themselves,1;
at,1;
have,1;
restrictions,1;
For,1;
a,1;
defined,1;
a,1;
char,1;
not,1;
a,1;
overall,,1;
cannot,1;
restrictions,1;
arbitrary,,1;
often,1;
niche,1;
optimization,,1;
we,1;
talking,1;
niche,1;
tucks,1;
away,1;
For,1;
a,1;
cannot,1;
Option<&T>,1;
zeros,1;
optimize,1;
same,1;
take,1;
either,1;
it’s,1;
free,1;
None.,1;
But,1;
if,1;
along,1;
a,1;
things,1;
9It,1;
it’s,1;
not,1;
cur-
rently,1;
not.,1;
point,1;
to,
and,1;
any,1;
must,1;
or
risk,1;
a,1;
change.
Owned,1;
Pointer,1;
point,1;
same,1;
if,1;
held,1;
through,1;
a,1;
assumes,1;
pointed-to,1;
not,1;
shared,1;
makes,1;
assumption.,1;
For,1;
if,1;
a,1;
same,1;
in
ManuallyDrop,1;
a,1;
likely,1;
entering,1;
if,1;
through,1;
shared,1;
(I,1;
fully,1;
a,1;
Invalid,1;
Values
Sometimes,1;
a,1;
common,1;
if,1;
a,1;
from,,1;
have,1;
in,,1;
going,1;
a,1;
if,1;
a,1;
u8,,1;
would,1;
have,1;
u8s,1;
a,1;
behavior.
The,1;
MaybeUninit<T>,1;
A,1;
MaybeUninit<T>,1;
stores,1;
a,1;
validity,1;
T.
It,1;
won’t,1;
references,1;
a,1;
a,1;
either,1;
it’s,1;
a,1;
a,1;
implies).,1;
a,1;
have,1;
a,1;
invalid.,1;
have,1;
stash,1;
a,1;
char,1;
a,1;
do,1;
things,1;
a,1;
create,1;
MaybeUninit::uninit,1;
using,1;
take,1;
a,1;
MaybeUninit<T>,1;
same,1;
as
a,1;
a,1;
any,1;
bits,1;
is
undefined,1;
MaybeUninit<T>,1;
a,1;
that
the,1;
makes,1;
a,1;
T.
Listing,1;
how,1;
we,1;
a,1;
->,1;
4096];
let,1;
(i,,1;
+,1;
u8s,1;
do,1;
we,1;
could,1;
have,1;
out,1;
zeros,1;
if,1;
it’s,1;
going,1;
shortly,1;
have,1;
a,1;
impact,1;
if
this,1;
a,1;
hot,1;
might!,1;
we,1;
whatever,1;
happened,1;
we,1;
a,1;
unex-
pected,1;
before,1;
MaybeUninit<T>,1;
fully,1;
you’ll,1;
have,1;
valid,,1;
if,1;
have,1;
forgotten,,1;
if,1;
a,1;
a,1;
often,1;
must,1;
we,1;
not,1;
a,1;
thread.,1;
effec-
tively,1;
drops,1;
drops,1;
on,
all,1;
frame,1;
current
thread.,1;
take,1;
code,,1;
trouble.,1;
For,1;
Listing,1;
9-6,,1;
which
tries,1;
efficiently,1;
a,1;
at,1;
once.
impl<T:,1;
self),1;
self.len();
if,1;
{
self.set_len(start,1;
+,1;
+,1;
A,1;
a,1;
if,1;
a,1;
call,1;
do,1;
point,1;
drops,1;
we,1;
have,1;
we,1;
call,1;
For,1;
if,1;
call,1;
we,1;
aimed,1;
Vec::drop,1;
call,1;
must,1;
have,1;
a,1;
problem,1;
if,1;
we
didn’t,1;
panics,1;
you’re,1;
through,1;
look,1;
out,1;
any,1;
if,1;
can
convince,1;
yourself,1;
particular
attention,1;
cases,,1;
panics,1;
user,1;
panic.
A,1;
arises,1;
?,1;
a,1;
do,1;
still,1;
if,1;
it
does,1;
not,1;
it’s,1;
out,1;
for.
Casting
As,1;
we,1;
if,1;
have,1;
same,1;
it’s,1;
not,1;
a,1;
themselves,1;
out,1;
same,1;
For,1;
Listing,1;
9-7,,1;
A,1;
not,1;
same,1;
representation.
struct,1;
bool,
two:,1;
PhantomData<T>,
}
struct,1;
A,1;
layout,1;
not,1;
mind
when,1;
do,1;
not,1;
have,1;
representations,1;
a,1;
to
undefined,1;
writing,,1;
out,1;
how,1;
we,1;
have,1;
if,1;
identical,1;
have,1;
same,1;
still,1;
same,1;
problem,1;
For,1;
really
just,1;
a,1;
that
goes,1;
out,1;
have,,1;
take,1;
niche,1;
optimization
(using,1;
any,1;
pattern,,1;
does,1;
not,1;
extra
byte,1;
must,1;
not,1;
play.,1;
take,1;
Listing,1;
9-8;,1;
here,
the,1;
layout,1;
though,1;
SneakyTrait>,1;
SneakyTrait,1;
SneakyTrait,1;
SneakyTrait,1;
[u8;,1;
easier,,1;
if,1;
representations,,1;
a,1;
at,1;
does,1;
its
job,1;
worth
going,1;
through,1;
direct,1;
put,1;
a,1;
look,1;
at,1;
First,,1;
take,1;
at,1;
little,1;
Listing,1;
a,1;
same,1;
foo,1;
compile
Without,1;
code
should,1;
we,1;
still,1;
a,1;
foo,1;
at,1;
foo,1;
a,1;
would,1;
But,1;
harm,1;
It
turns,1;
out,1;
if,1;
we,1;
before,1;
assignment,,1;
we,1;
On
the,1;
if,1;
does,1;
we,1;
code,,1;
you’re,1;
take,1;
a,1;
look,1;
at,1;
Listing,1;
deeper.
fn,1;
barify<’a>(_:,1;
->,1;
..,1;
foo,1;
9-10:,1;
implementations,1;
should
compile
Again,,1;
Let’s,1;
does,1;
not,,1;
case.
Usually,,1;
a,1;
out,1;
still
have,1;
same,1;
before:,1;
not,1;
a,1;
at,1;
a,1;
a,1;
&'static,1;
never
accessed.,1;
we,1;
accept,1;
it’s,1;
if,1;
through,1;
matches,1;
user
expectations,,1;
generic,1;
you’re,1;
someone
places,1;
a,1;
we,1;
Listing,1;
imple-
ment,1;
free,1;
a,1;
does,1;
access
&mut,1;
before,1;
it’s,1;
unstable,1;
(because,1;
makes,1;
unstable,1;
a,1;
a,1;
a,1;
a,1;
a,1;
check
machinery,1;
won’t,1;
drop-
ping,1;
writing:
unsafe,1;
impl<#[may_dangle],1;
a,1;
a,1;
given,1;
generic,1;
Box<&mut,1;
introduces,1;
a,1;
problem,1;
if,1;
a,1;
using,1;
a,1;
call,1;
we,1;
it’s,1;
have,1;
a,1;
Listing,1;
But,1;
not,1;
we,1;
do,1;
call,1;
a,1;
we,1;
a,1;
PhantomData<T>,1;
though,1;
any,1;
won’t,1;
does,1;
still,1;
a,1;
Listing,1;
would,1;
look,1;
not,1;
covariance,1;
1)
_owned:,1;
PhantomData<T>,,1;
For,1;
we,1;
a,1;
impl<#[may_dangle],1;
/*,1;
9-11:,1;
A,1;
flexible,1;
arises,1;
you
use,1;
unstable,1;
a,1;
look,1;
a,1;
PhantomData<T>,1;
9
Another,1;
concerning,1;
Type<T>,1;
For,1;
if,1;
U>,,1;
could,1;
undefined
behavior!Coping,1;
chapter,1;
before,1;
While,1;
stress,1;
it’s,1;
not,1;
code,,1;
but
most,1;
it’s,1;
not,1;
difficult.,1;
struggle.,1;
sure
that,1;
a,1;
before,1;
we’ll,1;
look,1;
at,1;
tempting,1;
rest,1;
reasoning,1;
often,1;
you.,1;
A,1;
uses
Pin::new_unchecked,1;
a,1;
a,1;
But,1;
at,1;
someone,1;
a,1;
suddenly,1;
it’s,1;
a,1;
at,1;
much
a,1;
attempt,1;
at,1;
“any,1;
For,1;
if,1;
a,1;
bar,1;
pub,1;
any,1;
if,1;
depends,1;
not,1;
any,1;
not,1;
visible,1;
a,1;
breaks,1;
down
accordingly.,1;
private,,1;
any,1;
same,1;
if,1;
a,1;
any,1;
falls,1;
approach—code,1;
cannot,1;
cannot,1;
your
invariants!
Because,1;
often,1;
best,1;
best,1;
a,1;
give,1;
safe.,1;
any,1;
not,1;
always,1;
fully,1;
a,1;
have,1;
a,1;
give,1;
document,1;
rigorously.
It,1;
sometimes,1;
tempting,1;
remove,1;
have,1;
{},1;
invoke,1;
if,1;
usually,1;
a,1;
A,1;
codebase,1;
grown,,1;
out,1;
hack,1;
together,1;
quick,”,1;
you’ll,1;
have,1;
won’t,1;
even
if,1;
not,1;
a,1;
remove,1;
noisy,1;
saying,1;
if,1;
must,1;
both
clarity,1;
Don’t,1;
any,1;
even
if,1;
written,1;
have,1;
a,1;
invariants—invariants,1;
must,1;
always,1;
for
all,1;
uses,1;
remind,1;
reader,1;
must,1;
the
global,1;
hoc,,1;
have,1;
not,1;
written,1;
given,1;
a,1;
do,1;
so.
What,1;
document,1;
proof,1;
the
bounds,1;
call,1;
put,1;
a,1;
how,1;
cases,,1;
are
extensive,,1;
comments,1;
a,1;
an
unsafe,1;
halfway,1;
through,1;
invariant.,1;
thank,1;
yourself,1;
a,1;
ensure,1;
it’s,1;
still,1;
safe.,1;
project,1;
who,1;
stumbled,1;
call,1;
wants,1;
going,1;
code,,1;
Rustonomicon,1;
will
come,1;
if,1;
you’re,1;
not,1;
aware,1;
aware.,1;
you’re,1;
It’s
added,1;
if,1;
you’re,1;
assumption,1;
have,1;
right,,1;
call,1;
If
it,1;
opening,1;
written,1;
code,,1;
invariants,,1;
it’s,1;
go.,1;
put,1;
automated,1;
tools,1;
(you,1;
have,1;
a,1;
suite,,1;
right?).
The,1;
directly.,1;
provides,1;
do,1;
a,1;
lot,1;
Rust-specific,1;
a
lifesaver,1;
interpret,1;
often,1;
orders,1;
magnitude,1;
For,1;
paths,1;
reach.,1;
suite,,1;
not,1;
a,1;
replacement,1;
tools,1;
known,1;
instrument,1;
code
to,1;
erroneous,1;
at,1;
detects,1;
a,1;
use-after-free,,1;
buffer
overflows,,1;
common,1;
symptoms,1;
tools,1;
thus
tend,1;
same,1;
But,1;
constrained,1;
a,1;
using,1;
tools,1;
change,,1;
ensure,1;
tools,1;
at,1;
problems,1;
incorporating,1;
known,1;
bugs,,1;
you’re,1;
through,1;
A,1;
always,1;
behavior!,1;
Check
all,1;
if,1;
things,1;
a,1;
if,1;
you’re,1;
if,1;
cfg!(test),1;
debug,1;
often,1;
a,1;
a,1;
at,1;
code,,1;
visible,1;
transitive,1;
And
indeed,,1;
if,1;
incorrect,,1;
have,1;
overall.,1;
that
all,1;
a,1;
surface,1;
usually,1;
C,1;
Just,1;
extensions.
Rust,1;
have,1;
a,1;
written,1;
a,1;
at,1;
familiar
with,1;
not,1;
makes,1;
tools,1;
Miri.,1;
any,1;
there
remain,1;
a,1;
C.
Summary
In,1;
through,1;
unsafe
keyword,1;
responsibilities,1;
we,1;
accept,1;
consequences,1;
code,,1;
a,1;
manually,1;
still,1;
safe.,1;
we’ll,1;
how,1;
get
all,1;
same,1;
(AND
PA,1;
A,1;
chapter,1;
tools,1;
take,1;
effective,1;
concur-
rency,1;
programs,,1;
teach,1;
how,1;
a,1;
concurrent
data,1;
a,1;
give,1;
understanding,1;
you’re,1;
yourself,1;
async/await,,1;
we,1;
yields,1;
parallelism.Each,1;
ways.,1;
subflavors,1;
if,1;
take,1;
a,1;
not.
Even,1;
if,1;
multiple,1;
(and,1;
concurrent),1;
(and,1;
not,1;
must,1;
if,1;
we’ll,1;
not,,1;
using,1;
word,1;
sense,1;
“things,1;
at,1;
same,1;
distinction,1;
call,1;
out.
What’s,1;
not,1;
a,1;
a,1;
through,1;
implementations,1;
code,,1;
covers,1;
including,1;
Arc,1;
won’t,1;
specifically,1;
topic.
Instead,,1;
we’ll,1;
look,1;
at,1;
makes,1;
common
concurrency,1;
difficulties.,1;
how,1;
asynchrony,1;
(and,1;
how,1;
how,1;
atomic,1;
lower-level
concurrent,1;
out,1;
chapter,1;
advice
for,1;
how,1;
we,1;
mechanisms,,1;
it’s,1;
taking,1;
we,1;
difficulty,1;
a,1;
shared,1;
multiple,1;
a,1;
then
that’s,1;
usually,1;
Arc,1;
a,1;
&'static,1;
you’re,1;
But,1;
any,1;
wants,1;
problems,1;
usually,1;
races.,1;
a,1;
updates,1;
shared,1;
a,1;
either,1;
place,,1;
thread’s
write,1;
at,1;
races,1;
races,1;
a,1;
a,1;
problems,1;
not,1;
exclusively,,1;
occur,1;
a,1;
conditions.,1;
A,1;
multiple,1;
a,1;
depending,1;
timing,1;
events,1;
events,1;
a,1;
going,1;
a,1;
packet,1;
in,,1;
any,1;
time-variable
occurrence.,1;
not,1;
not,1;
a,1;
ground,1;
races,1;
you’ll,1;
increasing,1;
taking,1;
resources.,1;
be
done,1;
a,1;
multiple,1;
do,1;
would,1;
gain,1;
often,1;
Scalability
in,1;
the
number,1;
if,1;
give,1;
improves.
While,1;
a,1;
it’s,1;
ultimate,1;
scalability,1;
doubling,1;
doubles,1;
scalability,1;
often,1;
perfect,1;
in
reality,,1;
speedups.,1;
nearly,1;
yields,1;
diminishing,1;
negative,1;
scaling,,1;
program
access,1;
usually,1;
contending,1;
shared,1;
a,1;
group,1;
a,1;
initially,,1;
at,1;
diminishing,1;
makes,1;
any,1;
humans,1;
ineffective,,1;
who,1;
no
bubbles,1;
at,1;
archnemesis,1;
a,1;
shared,1;
sharing.
Concurrency,1;
(and,1;
a,1;
a,1;
piece
of,1;
at,1;
any,1;
we,1;
is
mutually,1;
do,1;
same,1;
archetypal,1;
a,1;
section,1;
at,1;
any,1;
Mutual
exclusion,1;
For,1;
if,1;
spin,1;
a,1;
shared,1;
at,1;
a,1;
time.
Mutual,1;
occur,1;
internally,1;
enforce,1;
a,1;
For,1;
required
mutual,1;
allocations,,1;
made,1;
same,1;
sequentially,1;
the
kernel.
NOTE
Scalable,1;
raison,1;
d’être,1;
jemalloc,1;
program.
Even,1;
if,1;
of
the,1;
limits,1;
a,1;
using,1;
if,1;
perfect,1;
not,1;
kernel,1;
a,1;
given,1;
second,,1;
do,1;
reads,1;
at,1;
a,1;
this.,1;
usually,1;
perfect,1;
scalability,1;
falls,1;
substantial,1;
re-engineering,1;
new
hardware!),,1;
we,1;
won’t,1;
scalability,1;
anyway,,1;
some
shared,1;
though,1;
a,1;
take,1;
state.
This,1;
must,1;
it’s,1;
it’s,1;
not,1;
always,1;
straightforward,1;
a,1;
this—the,1;
state
may,1;
a,1;
still,1;
have,1;
take,1;
locks,1;
deadlocks,1;
occur,1;
attempt,1;
take,1;
orders,1;
if,1;
you’re
curious).,1;
section,1;
using,1;
a,1;
though,1;
problem,1;
a,1;
problem,1;
a,1;
CPU,1;
CPU,1;
internally,1;
operates,1;
lines—longer,1;
sequences,1;
accesses.,1;
line;,1;
updates,1;
must,1;
sequentially,1;
though,1;
how,1;
same,1;
cache
line—now,,1;
one
cache,1;
contending,1;
a,1;
line.,1;
But,1;
course,,1;
(and,1;
somewhat,1;
doing,1;
a,1;
tends,1;
away,1;
atomic,1;
instructions),1;
can.
In,1;
aggregate,,1;
various,1;
a,1;
given,1;
any,1;
it’s,1;
before,1;
optimize,1;
you’re,1;
curious,1;
“Scalability!,1;
But,1;
at,1;
uncovers,1;
scaling.”
Concurrency,1;
shared,1;
worker,1;
pools,
and,1;
through,1;
could,1;
take,1;
a,1;
book,1;
focus,1;
patterns.
Shared,1;
shared,1;
take,1;
guarded,1;
a,1;
mutex,1;
stored,1;
doing,1;
same,1;
if,1;
a,1;
shared,1;
a,1;
user,1;
a,1;
table
while,1;
the
background.
When,1;
shared,1;
if,1;
A,1;
regular,1;
mutex,1;
a,1;
a,1;
at,1;
a,1;
scalable,1;
reads,1;
at,1;
making,1;
maps,1;
specifically,1;
reads,1;
shared,1;
structures
172
Chapter,1;
specifically,1;
target,1;
case
as,1;
take,1;
off
performance,1;
does,1;
not,1;
a,1;
jointly,1;
shared,1;
a,1;
does,1;
not,1;
if,1;
s,1;
f(g(s)),1;
g(f(s)),
then,1;
shared,1;
likely,1;
not,1;
likely,1;
fits,,1;
problems,1;
have,1;
known,1;
shared,1;
lock-free
algorithms,1;
though,1;
often,1;
per-core,1;
complexity.,1;
always,1;
look,1;
alternative,1;
Pools
In,1;
worker,1;
identical,1;
often,1;
have,1;
a,1;
worker,1;
handling,1;
runtimes,1;
shared,1;
worker,1;
blurry,,1;
worker,1;
shared,1;
to
coordinate,1;
how,1;
take,1;
how,1;
For,1;
you’re,1;
using,1;
a,1;
parallel.,1;
a,1;
worker,1;
out,1;
a,1;
a,1;
unprocessed,1;
subrange.,1;
shared,1;
worker,1;
through,1;
a,1;
shared,1;
a,1;
worker,1;
if,1;
early,,1;
have,1;
worker,1;
yet.,1;
take,1;
if,1;
worker,1;
given,1;
finish,1;
completed,1;
a,1;
a,1;
kind
of,1;
incurring,1;
(and,1;
worker,1;
yourself,1;
a,1;
best,1;
usually,1;
a,1;
lot,1;
at,1;
than
to,1;
yourself,1;
a,1;
a,1;
same,1;
a,1;
call,1;
a,1;
appropriate.
CONNEC,1;
a,1;
shared,1;
a,1;
out,1;
a,1;
a,1;
a,1;
a,1;
either,1;
a,1;
established,1;
a,1;
done,1;
makes,1;
a,1;
A,1;
whatever,1;
was
put,1;
make
sure,1;
any,1;
act,1;
though,1;
given,1;
a,1;
worker,1;
identical,1;
a,1;
“topic.”,1;
a,1;
actor,,1;
pertain,1;
a,1;
a,1;
a,1;
a,1;
metrics,1;
collection,1;
any,1;
imagine,1;
a,1;
if,1;
wants,1;
a,1;
if,1;
10Since,1;
resource,,1;
locks,1;
other
synchronization,1;
point,1;
responsible,1;
a,1;
messages,1;
responsible,1;
respective,1;
log,1;
closely,1;
a,1;
wheel—a,1;
user,1;
a,1;
responsible,1;
tens,,1;
messages,1;
deeper
in,1;
before,1;
thread.,1;
systems,1;
a,1;
number
of,1;
a,1;
a,1;
thread.,1;
do,1;
not,1;
a,1;
not.,1;
worker,1;
model—for,1;
uses,1;
actor,,1;
a,1;
a,1;
given,1;
worker,1;
yields,1;
resumes,,1;
the
actor,1;
have,1;
opportunity,1;
For,1;
have,1;
responsible,1;
a,1;
have,1;
does,1;
not,1;
if,1;
a,1;
if,1;
if,1;
actors
grow,1;
cases,,1;
a,1;
since
actors,1;
have,1;
little,1;
Parallelism
As,1;
we,1;
asynchrony,1;
multiple,1;
Because,1;
parallelism,1;
does,1;
not,1;
Send.,1;
a,1;
additional,1;
does,1;
not,1;
a,1;
of
many,1;
at,1;
(and,1;
cases,,1;
For,1;
if,1;
a,1;
a,1;
at,1;
wants,1;
take,1;
won’t,1;
must,1;
given,1;
a,1;
worker,1;
not,1;
parallelism,1;
how,1;
tasks
that,1;
ties,1;
if,1;
a,1;
themselves,1;
parallel,,1;
must,1;
still,1;
call,1;
must,1;
do,1;
have,1;
parallel.,1;
do,1;
NCHRONOUS,1;
have,1;
mutexes,,1;
a,1;
often,1;
additional,1;
wake-ups.,1;
For,1;
contexts,1;
does,1;
not,1;
For,1;
it’s,1;
a,1;
a,1;
not,1;
not,1;
any,1;
make
sure,1;
always,1;
though,,1;
first,
and,1;
if,1;
nets,1;
does,1;
not,,1;
additional,1;
introduced,1;
using,1;
a,1;
not,1;
it.
176
Chapter,1;
Concurrency
The,1;
provides,1;
CPU,1;
primitives,,1;
higher-level,1;
built,1;
form
of,1;
atomic,1;
Atomic—,1;
AtomicUsize,,1;
AtomicPtr,,1;
functions
called,1;
look,1;
at,1;
few
sections.
These,1;
any,1;
stacks,,1;
do,1;
lightweight,1;
a,1;
mutex,1;
a,1;
shared,1;
a,1;
shared,1;
Boolean,1;
atomic,1;
have,1;
defined,1;
multiple,1;
(mostly),1;
same,1;
API:,1;
fetch_*,,1;
rest,1;
we’ll,1;
look,1;
at,1;
how,1;
use
them,1;
correctly,,1;
But,1;
we,1;
have,1;
Operations
Informally,,1;
we,1;
often,1;
“reading,1;
reality,,1;
a,1;
lot,1;
machinery,1;
uses,1;
a,1;
CPU,1;
instructions,1;
at,1;
at,1;
a,1;
high,1;
how,1;
instructions,1;
a,1;
a,1;
eliminating,1;
deems,1;
using,1;
CPU,1;
a,1;
a,1;
CPU,1;
instructions,1;
stores.,1;
A,1;
a,1;
location,1;
a,1;
CPU,1;
a,1;
stores,1;
a,1;
CPU,1;
a,1;
location,1;
stores,1;
at,1;
a,1;
time:,1;
a,1;
a,1;
turns
it,1;
multiple,1;
CPU,1;
how,1;
a,1;
program’s,1;
instructions,1;
For,1;
often,1;
instructions,1;
parallel,,1;
out,1;
have,1;
(and,1;
CPU,1;
computer’s,1;
a,1;
a,1;
given,1;
location,1;
not,1;
location,,1;
going,1;
code,,1;
CPU,1;
programmer.,1;
have,1;
a,1;
variations,1;
how,1;
CPU,1;
how,1;
force,1;
accesses.,1;
Rust,,1;
methods,,1;
we’ll,1;
rest,1;
Types
Rust’s,1;
atomic,1;
written,1;
at,1;
will
never,1;
written,1;
using,1;
multiple,1;
a,1;
cannot,1;
observe,1;
composing,1;
have,1;
not,1;
For,1;
a,1;
i64),1;
CPU,1;
value.,1;
could,1;
we,1;
a,1;
before,1;
second,,1;
value.,1;
would,1;
stored,1;
any,1;
CPU,1;
a,1;
atomic,1;
atomic,1;
CPU,1;
atomic,1;
things,1;
atomic,1;
a,1;
same,1;
atomic,1;
have,1;
explicit,1;
stor-
ing,1;
a,1;
we’ll,1;
writes
and,1;
CPU,1;
instructions,1;
clearer.,1;
For,1;
a,1;
a,1;
a,1;
a,1;
bits,1;
a,1;
atomic,1;
take,1;
restrictions,1;
atomic,1;
stores,1;
atomic,1;
sequenced,1;
CPU,1;
interleavings,1;
atomic,1;
value.,1;
we’ll,1;
out,1;
often,1;
we
humans,1;
imagine,1;
line—but,1;
not,1;
how,1;
Memory,1;
not,1;
immediately,1;
visible,1;
if,1;
have,1;
location,1;
a,1;
sequences,1;
for
different,1;
location,1;
if,1;
executed,1;
user,1;
a,1;
still,1;
have,1;
any,1;
does,1;
not,1;
take,1;
a,1;
given,1;
a,1;
if,1;
must,1;
existence,1;
depends,1;
follow,,1;
not,1;
a,1;
if,1;
a,1;
little,1;
focusing,1;
structured
as,1;
a,1;
hierarchy,1;
CPU,1;
chips,,1;
often,1;
hierarchy,1;
a,1;
a,1;
location,,1;
that
the,1;
CPU,1;
a,1;
a,1;
given,1;
CPU,1;
hierarchy,1;
a,1;
a,1;
hierarchy,1;
a,1;
visible,1;
location,1;
have,1;
same,1;
location,1;
at,1;
same,1;
weirdness
ensues.,1;
Memory,1;
a,1;
multiple,1;
a,1;
location,1;
take,1;
a,1;
look,1;
at,1;
programmers,,1;
additional
constraints,1;
defined,1;
Listing,1;
(and,1;
{
Relaxed,
Release,
Acquire,
AcqRel,
SeqCst
}
Listing,1;
restrictions,1;
we’ll,1;
concurrent
access,1;
Listing,1;
a,1;
atomic,1;
using,1;
spawn(||,1;
Y.load(Ordering::Relaxed);
2,1;
X.store(r1,,1;
spawn(||,1;
{
3,1;
at,1;
same,1;
a,1;
completely,1;
possible.,1;
CPU,1;
stores,1;
Let’s,1;
through,1;
CPU,1;
have,1;
any,1;
CPU,1;
hands*,1;
reasons
that’ll,1;
CPU,1;
though,1;
3,1;
yet.,1;
put,1;
a,1;
t1,,1;
must,1;
depends,1;
reads,1;
reads,1;
written,1;
additional,1;
must,1;
ensure,1;
any,1;
given,1;
(just,1;
if,1;
not,1;
any,1;
opera-
tions.,1;
3,1;
a,1;
cases,,1;
For,1;
if,1;
have,1;
a
counter,1;
metrics,,1;
In
other,1;
cases,,1;
could,1;
disastrous:,1;
if,1;
uses,1;
if,1;
protections,1;
have,1;
have,1;
notice,1;
that
doesn’t,1;
CPU,1;
written,1;
executes,,1;
wrote
it.,1;
order;,1;
Ordering
At,1;
step,1;
we,1;
a,1;
high,1;
dependency,1;
a,1;
how,1;
store.,1;
Crucially,,1;
not,1;
a,1;
a,1;
a,1;
put,1;
stores,1;
in
the,1;
must,1;
order;,1;
if,1;
a,1;
a,1;
dependency,1;
A,1;
must,1;
before,1;
any,1;
must,1;
fetch_add).
Concretely,,1;
orderings,1;
restrictions,1;
Loads,1;
stores,1;
cannot,1;
a,1;
with
Ordering::Release.
2.,1;
Loads,1;
stores,1;
cannot,1;
before,1;
a,1;
a,1;
must,1;
stores,1;
Ordering::Release,1;
stored,1;
(and,1;
how,1;
orderings,1;
Listing,1;
out,1;
spawn(||,1;
Y.load(Ordering::Acquire);
X.store(r1,,1;
Ordering::Release);
});
let,1;
spawn(||,1;
X.load(Ordering::Acquire);
2,1;
Ordering::Release)
});
Listing,1;
Listing,1;
Acquire/Release,1;
additional,1;
restrictions,1;
weird,1;
outcome
in,1;
Listing,1;
we,1;
cannot,1;
good!
But,1;
For,1;
example,
imagine,1;
a,1;
make
sure,1;
any,1;
stores,1;
a,1;
it’s,1;
visible,1;
any,1;
to
do.,1;
a,1;
release,1;
stores,1;
before,1;
CPU,1;
Acquire/Release,1;
additional,1;
using,1;
Ordering::Release,1;
not,1;
if,1;
atomic,1;
consistent,1;
we,1;
have,1;
somewhat,1;
not,1;
Acquire/Release,,1;
same,1;
best,1;
Acquire/Release,1;
does,1;
not,1;
if,1;
A,1;
written,1;
A,1;
a,1;
consistent,1;
wrote
relative,1;
Listing,1;
a,1;
Acquire/Release,1;
Afterwards,,1;
we’ll,1;
how,1;
sequentially,1;
consistent,1;
avoids
that,1;
AtomicI32::new(0);
let,1;
spawn(||,1;
Ordering::Release);
});
let,1;
spawn(||,1;
Ordering::Release);
});
let,1;
spawn(||,1;
if,1;
(Y.load(Ordering::Acquire)),1;
spawn(||,1;
if,1;
Acquire/Release,1;
true;,1;
if,1;
and,,1;
if,1;
if,1;
true
and,,1;
if,1;
Z.,1;
point,1;
show,1;
through,1;
given,1;
section.
First,,1;
recap,1;
if,1;
if,1;
before,1;
at,1;
Conversely,,1;
increments,1;
if,1;
before,1;
at,1;
let’s
assume,1;
if,1;
if,1;
not,1;
Getting,1;
if,1;
we,1;
t3.,1;
t1,,1;
won’t,1;
must,1;
have,1;
Z.
Our,1;
explanations;,1;
happened,,1;
happened,,1;
(and,1;
same,1;
have,1;
events,1;
a,1;
says,1;
must,1;
observe,1;
same,1;
it’s,1;
observe,1;
executed,1;
observe,1;
executed,1;
(implying,1;
t1),
while,1;
same,1;
(implying,1;
before,1;
completely,1;
we,1;
earlier,,1;
Acquire/Release,1;
a,1;
must,1;
stores,1;
happened,1;
Ordering::Release,1;
stored,1;
discussed,,1;
stores,1;
prior,1;
stored,1;
at,1;
any,1;
stores,1;
stores,1;
prior,1;
true—again,
there,1;
stored,1;
store.,1;
wrong
somehow.
Our,1;
intuitive,1;
we,1;
could,1;
put,1;
sense,1;
saw,1;
was
not,1;
Acquire/Release,1;
intuitive,1;
we,1;
sequential,1;
taking,1;
ensure,1;
at,1;
appears,1;
common,1;
makes,1;
makes,1;
costly.
Atomic,1;
stores,1;
take,1;
any,1;
precautions,1;
using,1;
CPU,1;
instructions)
needed,1;
sequential,1;
stores.,1;
convoluted,,1;
sequential,1;
if,1;
at,1;
related,1;
could,1;
put,1;
stored,1;
would,1;
match,1;
we,1;
replaced,1;
arguments,1;
Listing,1;
could,1;
not,1;
have,1;
sequential,1;
must,1;
before,1;
before,1;
t1,,1;
orders,1;
not,1;
atomic,1;
a,1;
a,1;
value.,1;
you
184
Chapter,1;
atomic,1;
if,1;
still,1;
same,1;
take,1;
a,1;
a,1;
Listing,1;
held,1;
Boolean,1;
a,1;
section,1;
false
to,1;
release,1;
(f),1;
free,1;
/*,1;
..,1;
TODO:,1;
..,1;
we,1;
f,1;
a,1;
lock
This,1;
a,1;
at,1;
same,1;
mutex,1;
Listing,1;
10-5,1;
a,1;
we,1;
atomic,1;
we,1;
problem,1;
out,1;
atomic,1;
if,1;
still,1;
matches,1;
changed.,1;
Listing,1;
10-6
shows,1;
using,1;
free,1;
take,1;
take,1;
(and,1;
Parallelism)
185Err(true),1;
/*,1;
..,1;
TODO:,1;
..,1;
f,1;
A,1;
a,1;
lock
This,1;
we,1;
not,1;
held,1;
storing,1;
take
the,1;
through,1;
argu-
ments,1;
if,1;
false.”
The,1;
a,1;
either,1;
could,1;
not,1;
either,1;
value.,1;
we,1;
must,1;
if,1;
AtomicI32,,1;
recompute,1;
same,1;
value.,1;
atomic,1;
a,1;
still,1;
often,1;
A-B-A,1;
“failure,1;
does,1;
not,1;
match,1;
value.,1;
give,1;
CPU,1;
stores,1;
still,1;
success.,1;
it’s,1;
okay,1;
stores,1;
it’s,1;
not,1;
okay,1;
stores,1;
section,1;
a,1;
though,1;
a,1;
it’s,1;
using,1;
For,1;
if,1;
not,1;
though,,1;
a,1;
a,1;
CPU,1;
a,1;
at,1;
level.,1;
a,1;
scalability,1;
CPU,1;
prog-
ress,1;
at,1;
a,1;
a,1;
not,1;
the
number,1;
it’s,1;
have,1;
to
coordinate,1;
ensure,1;
CPU,1;
at,1;
a,1;
at,1;
a,1;
a,1;
look,1;
at,1;
if,1;
you’re,1;
curious,1;
costly,1;
_,1;
XCHANGE,1;
reader,1;
notice,1;
a,1;
suspi-
ciously,1;
wonder,1;
variant,1;
if,1;
does,1;
still,1;
match,1;
user,1;
variant,1;
must,1;
odd—how,1;
could,1;
atomic,1;
if,1;
changed?,1;
do,1;
not,1;
have,1;
For,1;
processors,1;
operations,,1;
a,1;
fail
if,1;
not,1;
written,1;
by
calling,1;
instructions,1;
a,1;
makes,1;
Listing,1;
needlessly,1;
a,1;
instructions,1;
we,1;
have,1;
a,1;
we,1;
could,1;
com-
pare_exchange_weak,,1;
remove,1;
unreachable!(),1;
same,1;
Fetch,1;
Methods
Fetch,1;
atomic,1;
commute—that
is,,1;
have,1;
costly—if,1;
a,1;
have,1;
retry.
If,1;
have,1;
sequential,1;
to
the,1;
failure.
For,1;
modified,1;
we,1;
CPU,1;
atomic,1;
variable.,1;
opera-
tion,1;
whatever,1;
CPU,1;
counts,1;
(and,1;
a,1;
at,1;
same,1;
updates,1;
first
as,1;
increments,1;
opera-
tions.,1;
a,1;
a,1;
a,1;
step,1;
atomic,1;
held,1;
example,
AtomicUsize::fetch_add(1,,1;
always,1;
to
the,1;
AtomicUsize,,1;
multiple,1;
a,1;
variable.,1;
Some,1;
implementations,1;
the
number,1;
if,1;
same,1;
atomic,1;
begin,1;
slow
down,1;
exhibit,1;
sublinear,1;
In
general,,1;
best,1;
a,1;
atomic,1;
somewhat,1;
a,1;
Concurrency
Writing,1;
have,1;
not,1;
how,1;
interacts,1;
CPU,,1;
a,1;
at,1;
throw,1;
give,1;
section,1;
we’ll,1;
tools,1;
ensure,1;
fear.
Start,1;
a,1;
of,,1;
if,1;
a,1;
problem,1;
out,1;
not,1;
multiple,1;
sequential,1;
communicate,1;
through,1;
locks,1;
a,1;
cases,,1;
designs,1;
enough;,1;
out,1;
a,1;
lot,1;
of
time,1;
making,1;
locks,1;
if,1;
introduce
more,1;
code?
If,1;
a,1;
problem,,1;
figure,1;
do,1;
possible.,1;
it’s,1;
a,1;
a,1;
a,1;
a,1;
do,1;
that.
Even,1;
do,1;
have,1;
like,,1;
a,1;
at,1;
if,1;
concrete,1;
bottlenecks,1;
must,1;
Stress,1;
have,1;
a,1;
lot,1;
stress,1;
a,1;
out,1;
a,1;
steps,1;
have,1;
doing,1;
if,1;
a,1;
stress,1;
have,1;
a,1;
M+N,1;
likely,1;
often,1;
a,1;
a,1;
interleavings,1;
interleavings,1;
random,1;
a,1;
given,1;
stress,1;
random,1;
Just,1;
a,1;
For,1;
it’s,1;
litter,1;
if,1;
you’re,1;
hot,1;
loops.
Use,1;
pos-
sible,1;
we,1;
saw,1;
Listing,1;
10-4,,1;
it’s,1;
not,1;
scheduling
that,1;
a,1;
given,1;
observe,1;
at,1;
any,1;
given,1;
point,1;
Writing,1;
pos-
sible,1;
not,1;
likely,1;
(and,1;
a,1;
exists,1;
exploration
for,1;
loom,1;
crate.,1;
release,1;
a,1;
won’t,1;
give,1;
any,1;
how,1;
likely,1;
out,1;
a,1;
closure,1;
multiple,1;
provides,1;
replacement,1;
a,1;
those
replacement,1;
a,1;
act,1;
next
after,1;
interleavings,1;
a,1;
point,1;
at,1;
multiple,1;
fully,1;
occur,1;
stress,1;
testing,1;
would,1;
not,1;
a,1;
While,1;
cases,,1;
it’s,1;
not,1;
testing,1;
sequences,1;
at,1;
would,1;
take,1;
a,1;
of
the,1;
stress,1;
tests,,1;
cases,,1;
add
additional,1;
instructions,1;
give,1;
cases,,1;
best,1;
through,1;
a,1;
known,1;
augments,1;
a,1;
flags,1;
any,1;
a,1;
if,1;
atomic,1;
not,1;
hand,1;
a,1;
nearly,1;
always,1;
a,1;
10Since,1;
does,1;
not,1;
a,1;
program.,1;
While,1;
at,1;
it’s,1;
still,1;
a,1;
time.
At,1;
writing,,1;
a,1;
of
the,1;
though,1;
a,1;
things,1;
use-after-free,,1;
reads,1;
debug,1;
debug,1;
problem,1;
timing,1;
events,1;
the
bug,1;
common,1;
common,1;
have,1;
bugs.,1;
obvious,,1;
a,1;
if,1;
a,1;
lot
of,1;
output.,1;
Writing,1;
at,1;
a,1;
kernel,1;
have,1;
to
wait,1;
disturb,1;
guarded,1;
a,1;
Stdout,1;
you’ll,1;
a,1;
does,1;
if,1;
multiple,1;
at,1;
same,1;
time—without,1;
a,1;
a,1;
have,1;
multiple,1;
take,1;
if,1;
a,1;
a,1;
effect!
In,1;
a,1;
problem.,1;
using,1;
TSan,
(continued)
Concurrency,1;
(and,1;
using,1;
a,1;
log,1;
at,1;
Many,1;
issuing,1;
log,1;
bonus,,1;
behind
after,1;
a,1;
a,1;
big,1;
fan
of,1;
out,1;
we,1;
common,1;
Rust,,1;
how,1;
par-
allelism,,1;
how,1;
parallelism,1;
concur-
rency,1;
primitives,,1;
including,1;
how,1;
how,1;
they’re
all,1;
we,1;
at,1;
tools,1;
In
the,1;
chapter,1;
we’ll,1;
through,1;
interfaces,,1;
written,1;
languages.
192
Chapter,1;
1011
F,1;
F,1;
C,1;
S
Not,1;
written,1;
Every,1;
you’ll,1;
inter-
act,1;
written,1;
call,1;
through,1;
interfaces,1;
chapter,1;
we’ll,1;
look,1;
at,1;
provides
for,1;
how,1;
give,1;
through,1;
how,1;
defined,1;
we’ll,1;
tools,1;
you’ll,1;
likely,1;
you’re,1;
doing,1;
any,1;
often,1;
occur,1;
Rust-land.,1;
if,1;
a,1;
written,1;
have,1;
C-compatible,1;
.so,1;
same,1;
complications,1;
For,1;
provides,1;
(be,1;
code,,1;
a,1;
common,1;
understanding,1;
how,1;
call,1;
shared,1;
look,1;
at,1;
artifact,1;
produces,1;
define,1;
a,1;
location,1;
Generic,1;
multiple,1;
have,1;
symbols—they’re,1;
final,1;
a,1;
how,1;
call,1;
target,1;
code,,1;
if,1;
a,1;
usually,1;
code,,1;
have,1;
foo,1;
code,,1;
distinct,1;
confusion.
However,,1;
using,1;
random,1;
won’t,1;
call,1;
a,1;
a,1;
at,1;
written,1;
a,1;
a,1;
a,1;
defined,1;
if,1;
a,1;
Conversely,,1;
a,1;
a,1;
it.
To,1;
a,1;
we,1;
a,1;
a,1;
same,1;
defined,1;
defining,1;
how,1;
we,1;
would,1;
identical,1;
would,1;
take,1;
any,1;
a,1;
multiple,1;
but
defined,1;
Every,1;
a,1;
same,1;
at,1;
a,1;
multiple,1;
complain.
An,1;
a,1;
complicated,1;
pro-
cess,1;
a,1;
a,1;
a,1;
high,1;
phase,1;
compiler”;,1;
we,1;
a,1;
given,1;
phase,1;
a,1;
uses,1;
heavily,1;
produces,1;
operations,,1;
do,1;
not,1;
have,1;
a,1;
codebase,1;
at,1;
codebase,1;
through,1;
concur-
rently.,1;
For,1;
independently
and,1;
a,1;
dependency,1;
pro-
cess,1;
parallel.,1;
often,1;
multiple,1;
slices,1;
done,1;
phase,1;
object,1;
generation,
stitch,1;
together,1;
a,1;
final,1;
how,1;
a,1;
call,1;
still,1;
how,1;
object,1;
constructed;,1;
together,1;
any,1;
shared,1;
One,1;
object,1;
origi-
nally,1;
have,1;
code,,1;
C,1;
code,,1;
a,1;
same,1;
symbol
names,,1;
uses,1;
cross-referenced,1;
any,1;
shared,1;
either,1;
dynamically.,1;
Static,1;
a,1;
replaced,1;
the
address,1;
Dynamic,1;
linking,,1;
Interfaces
195ties,1;
a,1;
a,1;
modes,1;
a,1;
little,1;
defaults,1;
Rust
code,,1;
a,1;
a,1;
existence,1;
defined,1;
elsewhere.,1;
Listing,1;
we,1;
define,1;
a,1;
we,1;
a,1;
FOREIGN_DEBUG,1;
at,1;
{
static,1;
FOREIGN_DEBUG:,1;
a,1;
assign,1;
symbol
name,1;
program.,1;
pub,1;
since
it’s,1;
a,1;
crate’s,1;
API,,1;
though,1;
Note,1;
we,1;
it’s,1;
defined,1;
still,1;
FOREIGN_DEBUG,1;
a,1;
location,1;
at,1;
same,1;
located.,1;
defined,1;
we,1;
give,1;
a,1;
match,1;
at,1;
site.,1;
Because,1;
symbol,
FOREIGN_DEBUG,1;
always,1;
any,1;
a,1;
risk.,1;
a,1;
if,1;
similar.,1;
Listing,1;
hello_rust,1;
11#[no_mangle]
pub,1;
a,1;
defined,1;
through,1;
same,1;
Listing,1;
using,1;
we’ll,1;
multiple,1;
a,1;
given,1;
symbol
should,1;
using,1;
#[link],1;
saying,1;
it’s,1;
found,1;
multiple,1;
question.,1;
For,1;
if,1;
you’re,1;
any,1;
statics
or,1;
a,1;
a,1;
#[export_name,1;
how,1;
defaults,1;
signifies
C-compatible,1;
alternative,1;
fully,1;
at,1;
at,1;
a,1;
book.
There,1;
linking,,1;
First,,1;
dynamic
linking,1;
tends,1;
makes,1;
Dynamic,1;
whoever,1;
a,1;
libcrypto,1;
a,1;
user,1;
automatically.,1;
user,1;
would,1;
have,1;
tends,1;
any,1;
final,1;
in,,1;
produces,1;
dynamic
linking,,1;
a,1;
at,1;
far,,1;
not,1;
big,1;
linking,,1;
wants,1;
a,1;
must,1;
have,1;
any,1;
against.,1;
must,1;
have,1;
compatible,1;
a,1;
problem,1;
user,1;
aware,1;
must,1;
hunt,1;
linking,,1;
user,1;
themselves.
Ultimately,,1;
a,1;
usually,1;
a,1;
a
better,1;
option,1;
constrained,1;
niche,1;
dependencies.,1;
best,1;
a,1;
given,1;
defined,,1;
not
enough,1;
call,1;
a,1;
any,1;
invoke,1;
We
won’t,1;
a,1;
frame,1;
call,1;
arguments,1;
various,1;
CPU,1;
completes
Rust,1;
standardized,1;
same,1;
if,1;
if,1;
Listing,1;
11-2,,1;
“use,1;
C,1;
C,1;
nearly,1;
11
Unwinding,1;
regular,1;
a,1;
With
RFC,1;
a,1;
if,1;
a,1;
supply
as,1;
a,1;
says,1;
at,1;
same
as,1;
uses,1;
you’ll,1;
a,1;
you’re,1;
platform-specific,1;
interfaces,,1;
not,1;
same,1;
a,1;
going,1;
distribute,1;
you
don’t,1;
a,1;
distribute,1;
a,1;
com-
mand,1;
crate’s,1;
uploads
it,1;
crates.io.,1;
distribute,1;
generic,1;
defined,1;
in
the,1;
must,1;
have,1;
generic,1;
form,
which,1;
code!
Technically,1;
does,1;
dependency,1;
combines,1;
end.,1;
generic,1;
specific,1;
any,1;
do,1;
do,1;
if,1;
a,1;
C-compatible,1;
stati-
cally,1;
Unix/macOS,1;
look,1;
C,1;
code,,1;
how,1;
C-compatible,1;
section,1;
would,1;
"lib",1;
a,1;
if,1;
not,1;
a,1;
if,1;
a,1;
macro),,1;
if,1;
you’re,1;
a,1;
a,1;
"staticlib",,1;
C-compatible,1;
mind,1;
Interfaces
199produce,1;
artifact,1;
publicly,1;
won’t,1;
if,1;
pub,,1;
they
have,1;
a,1;
FFI,,1;
layout,1;
if,1;
out,1;
shared,1;
FFI
boundary,1;
out,1;
sides,1;
inter-
pret,1;
we’ll,1;
look,1;
at,1;
how,1;
FFI,,1;
aware,1;
languages.
Type,1;
shared,1;
a,1;
lost,1;
compilation.,1;
All,1;
bits,1;
type.
You,1;
bits,1;
sides,1;
must
make,1;
match,1;
For,1;
C,1;
C,1;
uses,1;
out,1;
interfaces,1;
provides,1;
C,1;
in
the,1;
std::os::raw,1;
c_int,1;
c_char,1;
depending,1;
char,1;
i32/i64,1;
depending,1;
target,1;
C,1;
often,1;
do,1;
not,1;
trans-
late,1;
best,1;
[u8;,1;
For,1;
always,1;
big-endian,,1;
uses,1;
the
current,1;
platform.
With,1;
strings,,1;
usually,1;
do,1;
For,1;
C,1;
tends,1;
a,1;
a,1;
stored,1;
cannot,1;
a,1;
std::ffi::CStr,1;
strings,,1;
you’ll,1;
likely,1;
a,1;
separately—the,1;
that.
200
Chapter,1;
unions,,1;
also
need,1;
layout,1;
we,1;
out,1;
at,1;
ensure,1;
a,1;
layout,1;
configurations,1;
type,
such,1;
manually,1;
padding,,1;
you’ll,1;
accordingly.
A,1;
multiple,1;
representations,1;
not.,1;
data,
like,1;
}
With,1;
using,1;
a,1;
of
the,1;
same,1;
a,1;
C,1;
would,1;
variant,1;
on.,1;
manually,1;
assign,1;
Defining,1;
explicit,1;
variant,1;
a,1;
says,1;
one.,1;
makes,1;
a,1;
if,1;
manually,1;
not,1;
C,1;
defined,1;
an
instance,1;
tends,1;
often,1;
bitsets,,1;
be
bitwise,1;
ORed,1;
together,1;
a,1;
multiple,1;
at,1;
Listing,1;
instance,,1;
a,1;
3,1;
taking,1;
would,1;
not,1;
a,1;
C,1;
uses,1;
enumeration,1;
a,1;
using,1;
a,1;
variant,1;
implementations,1;
of
the,1;
various,1;
a,1;
a,1;
discriminator.,1;
For,1;
using,1;
a,1;
unsigned,1;
For,1;
a,1;
pass
#[repr(C,,1;
same,1;
effect.
Foreign,1;
using,1;
a,1;
union.,1;
a,1;
would,1;
if,1;
For,1;
a,1;
concrete,1;
Listing,1;
}
}
//,1;
FooData,1;
{
bar:,1;
{
tag:,1;
unions.
THE,1;
IN,1;
9,1;
we,1;
niche,1;
optimization,,1;
FFI.
Specifically,,1;
nullable,1;
always,1;
For,1;
a,1;
nullable,1;
a,1;
nullable,1;
transparently,1;
do,1;
if,1;
same,1;
if,1;
if,1;
You’re
free,1;
your
heart’s,1;
releasing,1;
interfaces,1;
have,1;
configurations,1;
handling
allocation:,1;
either,1;
provides,1;
any,1;
allocated
resources,1;
Listing,1;
implementation-managed,1;
One,1;
allocates,1;
a,1;
ECDSA_SIG_new(),1;
->,1;
a,1;
created,1;
done,1;
ECDSA_SIG_free(sig:,1;
implementation-managed,1;
ECDSA_SIG_new,1;
a,1;
call,1;
free,1;
it’s,1;
done,1;
ref-
erenced,1;
allocates,1;
in
the,1;
free,1;
defined,1;
Rust,,1;
would,1;
likely,1;
would,1;
invoke,1;
provides,1;
a,1;
a,1;
uses,1;
free,1;
caller.
extern,1;
c_void,,1;
len:,1;
->,1;
A,1;
whatever,1;
deems,1;
required
memory,,1;
either,1;
match,1;
if,1;
a,1;
doing,1;
deems,1;
For,1;
using,1;
a,1;
not,1;
would,1;
if,1;
mind,1;
often,1;
convoluted,,1;
do,1;
figure,1;
out,1;
how,1;
then
set,1;
before,1;
call,1;
how,1;
if,1;
(and,1;
not,1;
known,1;
caller),1;
won’t,1;
a,1;
at,1;
cases,,1;
have,1;
you’re,1;
a,1;
caller-allocated,1;
either,1;
For,1;
it’s,1;
okay,1;
call,1;
ref-
erenced,1;
through,1;
matches,1;
define,1;
->,1;
c_int,1;
a,1;
C,1;
a,1;
do,1;
using,1;
callbacks,1;
panics,,1;
a,1;
abort
if,1;
detects,1;
a,1;
not,1;
always,1;
extern,,1;
FFI-compatible.
Safety
When,1;
a,1;
on
top,1;
Doing,1;
ensuring
you,1;
through,1;
The
three,1;
a,1;
cannot,1;
how,1;
enforce,1;
11References,1;
a,1;
a,1;
given,1;
the
relevant,1;
taking,1;
a,1;
user,1;
break,1;
loose!
You’ll,1;
lifetimes,1;
ensure,1;
For,1;
imagine,1;
create,1;
a,1;
create,1;
a,1;
requirement,1;
lives.,1;
any,1;
requirement,1;
a,1;
created,1;
not,1;
ensure,1;
cannot,1;
the
invariants,1;
For,1;
have,1;
given,1;
Listing,1;
start_main_loop();
extern,1;
->,1;
11-7:,1;
A,1;
that
next_event,1;
same,1;
we,1;
have,1;
we,1;
we,1;
take,1;
a,1;
out,1;
3,1;
enforce,1;
Listing,1;
11-8.
pub,1;
->,1;
->,1;
11-8:,1;
Enforcing,1;
types
The,1;
Interfaces
205next_event,1;
same,1;
thread.
You,1;
enforce,1;
making,1;
a,1;
Send
nor,1;
do,1;
a,1;
does,1;
have,1;
unstable,1;
negative,1;
implementations,1;
{},,1;
it’s,1;
right,
and,1;
likely,1;
won’t,1;
have,1;
invoking
start_main_loop,1;
multiple,1;
either,1;
same,1;
would,1;
depend,1;
question,,1;
give,1;
have,1;
or
the,1;
a,1;
way.
For,1;
usually,1;
out,1;
C,1;
equivalent,1;
std::ffi::c_void,1;
A,1;
a,1;
convey,1;
For,1;
often,1;
role,1;
for
types,1;
does,1;
not,1;
say
what’s,1;
option,1;
any,1;
indistinguish-
able,1;
stopping,1;
a,1;
user,1;
taking,1;
opaque
pointer,1;
a,1;
a,1;
a,1;
do,1;
we,1;
using,1;
point-
ers,1;
FFI,,1;
if,1;
a,1;
distinct,1;
For,1;
Listing,1;
distinct,1;
cannot,1;
be
confused.
#[non_exhaustive],1;
pub,1;
pub,1;
->,1;
Foo;
pub,1;
take_foo(arg:,1;
take_bar(arg:,1;
cannot,1;
confused
206
Chapter,1;
of
(),1;
won’t,1;
it’s,1;
call,1;
take_bar,1;
a,1;
foo.,1;
cannot,1;
out,1;
a,1;
a,1;
chore.,1;
Big,1;
have,1;
a,1;
match,1;
out,1;
equivalents,1;
have,1;
C,1;
oddities,1;
bound,1;
a,1;
simplifies,1;
have,1;
C,1;
best,1;
a,1;
number
of,1;
a,1;
out,1;
equivalents.
bindgen,1;
provides,1;
a,1;
C
headers,1;
bindings.
This,1;
hand-tune,1;
C,1;
a,1;
invoke,1;
a,1;
mind,1;
a,1;
specifically,1;
target,1;
platform,,1;
likely,1;
layout,1;
a,1;
section,1;
Cargo.toml.,1;
before,1;
a,1;
crate.,1;
section,1;
a,1;
additional,1;
additional,1;
Cargo
should,1;
and,,1;
additional,1;
making,1;
too
aware,1;
While,1;
a,1;
script
to,1;
if,1;
a,1;
if,1;
it’s,1;
going,1;
tomorrow,,1;
making,1;
dependent,1;
conditions
may,1;
development,1;
a,1;
variable.,1;
same,1;
environment
variable,1;
at,1;
a,1;
C,1;
have,1;
ver-
sion,1;
a,1;
a,1;
called,,1;
any,1;
crate
to,1;
at,1;
it’s,1;
best,1;
give,1;
for,,1;
releasing,1;
link
against,1;
same,1;
through,1;
a,1;
given,1;
would,1;
have,1;
at,1;
a,1;
release,1;
if,1;
themselves,1;
upgraded
or,1;
a,1;
a,1;
release,1;
if,1;
any,1;
dependency,1;
a,1;
new
major,1;
still,1;
a,1;
produces,1;
a,1;
through,1;
FFI,,1;
a,1;
C,1;
interface
to,1;
C,1;
a,1;
a,1;
a,1;
a,1;
taking
in,1;
a,1;
C,1;
Rust,,1;
produces,1;
a,1;
C,1;
crate’s,1;
FFI,,1;
manually,1;
autogenerated,1;
C,1;
though,1;
tends,1;
a,1;
focused,1;
C,1;
chapter,1;
it’s,1;
cross-language,1;
interfaces,1;
provides,1;
While,1;
feels,1;
closely,1;
related,1;
written,1;
it’s,1;
a,1;
match,1;
a,1;
C,1;
not,1;
at,1;
often,1;
For,1;
have,1;
overloaded,1;
Some,1;
supported,1;
at,1;
do,1;
give,1;
a,1;
how,1;
call,1;
out,1;
code,,1;
how,1;
how,1;
common,1;
written,1;
of
keeping,1;
look,1;
at,1;
how,1;
embed-
ded,1;
not,1;
a,1;
not,1;
possible.
Foreign,1;
Interfaces
20912
RUST,1;
THE
S,1;
A,1;
a,1;
always,1;
systems,1;
usually
expected,1;
do,1;
not,1;
a,1;
supercomputer,1;
a,1;
we’ll,1;
take,1;
a,1;
look,1;
at,1;
how,1;
have,1;
memory!,1;
focus,1;
we’ll,1;
(yes,,1;
does,1;
technically,1;
have,1;
have,1;
a,1;
Library
As,1;
a,1;
consists,1;
multiple,1;
final,1;
into
machine-runnable,1;
std,,1;
common,1;
a,1;
user,1;
input,,1;
on.,1;
But,1;
a,1;
other,,1;
fundamental,1;
at,1;
and
contains,1;
any,1;
depends,1;
on—things,1;
fundamental,1;
atomic,1;
methods,,1;
if,1;
exist,,1;
input,,1;
next
section.
Most,1;
do,1;
not,1;
though,1;
technically,1;
lives,1;
through,1;
distinction,1;
While
it’s,1;
sort,1;
a,1;
list,1;
have,1;
a,1;
a,1;
file-
system),1;
a,1;
terminal)—so,1;
have,1;
little,1;
a,1;
afford,,1;
allocates,1;
a,1;
Vec.
Rather,1;
force,1;
provides,1;
a,1;
opt,1;
out,1;
a,1;
213),1;
std::prelude,1;
accidentally
depend,1;
not,1;
does,1;
not,1;
bringing,1;
a,1;
not,1;
a,1;
target,1;
does,1;
not,1;
std,,1;
this
design,1;
still,1;
when
certain,1;
enabled.,1;
For,1;
have,1;
a,1;
integra-
tions,1;
constrained,1;
bells,1;
prefer,1;
if,1;
any,1;
a,1;
dependency,1;
given,1;
sup-
port,,1;
depend,1;
causing,1;
PRELUDE
Have,1;
wondered,1;
Clone—that,1;
any,1;
Rust
standard,1;
similar
for,1;
crate’s,1;
themselves,1;
pub,1;
commonly,1;
Memory,1;
we,1;
a,1;
serves,1;
a,1;
distinct,1;
for
your,1;
variables,,1;
function-local
variables,1;
for,,1;
makes,1;
a,1;
String,,1;
Arc,1;
collection,1;
shrink
over,1;
a,1;
provides,1;
distinct,1;
reused.
By,1;
uses,1;
C,1;
cases,,1;
if,1;
necessary,
you,1;
override,1;
through,1;
imple-
mentation,1;
a,1;
a,1;
C,1;
library
is,1;
not,1;
alloca-
tor.,1;
For,1;
dynamic
memory,1;
But,1;
it’s,1;
a,1;
a,1;
you
to,1;
opt,1;
through,1;
crate.,1;
alloc
crate,1;
toolchain,1;
(just,1;
and
contains,1;
not,1;
random,1;
a,1;
no_std,1;
have,1;
do,1;
though,,1;
depending,1;
any,1;
disallows,1;
either,1;
have,1;
little,1;
kernel,,1;
if,1;
handled,1;
For,1;
cases,,1;
you’ll,1;
any,1;
you
expose,1;
any,1;
unstable,1;
out,1;
the
caller,,1;
who,1;
appropriately.
It,1;
it’s,1;
String,1;
have,1;
a,1;
trick
to,1;
For,1;
a,1;
a,1;
a,1;
how,1;
holds.,1;
a,1;
vector’s,1;
Listing,1;
a
heapless,1;
using,1;
ArrayVec<T,,1;
ArrayVec<T,,1;
->,1;
{
return,1;
Err(t);
}
self.values[self.len],1;
A,1;
generic,1;
optional,1;
always,1;
stores,1;
Option<T>,,1;
a,1;
stored,1;
still,1;
act,1;
a,1;
vec-
tor,1;
using,1;
how,1;
we,1;
could,1;
have,1;
using,1;
would,1;
using,1;
code,,1;
have,1;
have,1;
a,1;
While
that’s,1;
at,1;
a,1;
high,1;
have,1;
a,1;
inter-
preter,,1;
a,1;
not,1;
does,1;
have,1;
before,1;
response,1;
a,1;
handler.,1;
panic_any,,1;
available—as,1;
a,1;
a,1;
either,1;
thread’s
stack,1;
depending,1;
through,1;
arguments,1;
not,1;
a,1;
handler.,1;
For,1;
do,1;
not,,1;
a,1;
implementation
that,1;
makes,1;
sense,1;
uses,1;
a,1;
For,1;
a,1;
still,1;
do,1;
a,1;
we,1;
fn(&PanicInfo),1;
->,1;
a,1;
a,1;
does,1;
unspecified,,1;
assumes,1;
a,1;
a,1;
a,1;
using,1;
{},,1;
do,1;
makes,1;
sense,1;
target,1;
platform,,1;
not,1;
a,1;
program.,1;
a,1;
a,1;
lang_start.,1;
(fairly,1;
including,1;
program’s,1;
arguments,1;
a,1;
handling,1;
panics,1;
sig-
nal,1;
how,,1;
example,
Windows,1;
how,1;
arguments,1;
a,1;
problem,1;
not,1;
you’ll,1;
opt,1;
out,1;
using,1;
meaning,1;
must,1;
figure,1;
out,1;
how,1;
a,1;
#[export_name,1;
matches,1;
target,1;
before,1;
defined,1;
not,1;
cases,,1;
will
need,1;
various,1;
a,1;
built,1;
a,1;
does,1;
not,1;
must,1;
have,1;
if,1;
12to,1;
define,1;
if,1;
cannot,1;
a,1;
have,1;
won’t,1;
writing,,1;
must,1;
define,1;
using,1;
mind,1;
not,1;
have,1;
a,1;
give,1;
same,1;
function-
ality,1;
through,1;
a,1;
set_alloc_error_hook.
Low-Level,1;
Memory,1;
we,1;
given,1;
a,1;
how,1;
instruc-
tions,,1;
CPU,1;
out,1;
CPU,1;
take,1;
of
the,1;
reads,1;
have,1;
reads,1;
same,1;
location,1;
CPU,1;
instructions.,1;
commonly,1;
does,1;
no_std,1;
sometimes,1;
you’ll,1;
often,1;
through,1;
made,1;
maps,1;
a,1;
blocks,,1;
depending,1;
you’re,1;
CPU,1;
stores,1;
For,1;
instance,,1;
common
for,1;
have,1;
meaning,1;
reads,1;
have,1;
cases,,1;
a,1;
if,1;
a,1;
arises,1;
suddenly,1;
if,1;
if,1;
a,1;
a,1;
signal,1;
cases,,1;
CPU,1;
executing
instructions,1;
whatever,1;
anticipate,1;
executions,
it,1;
cannot,1;
observe,1;
have,1;
out,1;
cannot,1;
oblivious,1;
observe,1;
instructions,1;
have,1;
a,1;
provides,1;
volatile,1;
cannot,1;
vola-
tile,1;
take,1;
fit
for,1;
volatile,1;
effects,1;
out,1;
would,1;
look,1;
a,1;
a,1;
a,1;
no-reordering,1;
any,1;
code
that,1;
uses,1;
operations.
NOTE
There,1;
a,1;
std::sync::atomic::compiler_fence,1;
accesses.,1;
a,1;
A,1;
SSEMBLY,1;
CODE
These,1;
any,1;
given,1;
task.,1;
But,1;
at,1;
instructions,1;
still,1;
sometimes,1;
a,1;
Rust,,1;
stabilized,1;
won’t,1;
syntax
in,1;
still,1;
Rust—you,1;
a,1;
Cargo
build,1;
including,1;
final,1;
we,1;
a,1;
project,1;
a,1;
standalone
assembly,1;
(.s),1;
object,1;
(.o),1;
using,1;
target,1;
platform’s,1;
repackages,1;
a,1;
using,1;
project,1;
emits,1;
pointing,1;
target,1;
change,,1;
it.
Misuse-Resistant,1;
at,1;
interfaces.,1;
littered,1;
hardware-defined,1;
manuals,1;
mysterious,1;
a,1;
a,1;
user,1;
no_std,1;
programs,,1;
immensely,1;
we,1;
If
certain,1;
cannot,1;
occur,1;
at,1;
same,1;
a,1;
the
relevant,1;
we,1;
Listing,1;
3,1;
no_std,1;
a,1;
at,1;
at,1;
any,1;
given,1;
point,1;
Listing,1;
how,1;
a,1;
a,1;
makes,1;
private,1;
Pair<R1,,1;
get(),1;
->,1;
{
Rust,1;
PAIR_TAKEN:,1;
Ensure,1;
->,1;
{
registers::set_on("r1");
Pair(PhantomData)
}
//,1;
..,1;
inverse,1;
->,1;
->,1;
..,1;
inverse,1;
12-2:,1;
a,1;
noteworthy,1;
a,1;
exists,1;
a,1;
private,1;
making,1;
consume,1;
ensure,1;
transitions
are,1;
must,1;
globally.
The,1;
noteworthy,1;
Listing,1;
we,1;
take,1;
at,1;
any,1;
given,1;
point,1;
must,1;
be,,1;
we,1;
related,1;
at,1;
a,1;
you’ll,1;
no_std,1;
a,1;
a,1;
a,1;
bits,1;
a,1;
a,1;
CPU.,1;
development,1;
not,1;
For,1;
it’s,1;
common,1;
have,1;
binary
220
Chapter,1;
have,1;
a,1;
pipe-
line,1;
you’re,1;
a,1;
potato,,1;
optimize,1;
doing,1;
compilation.
We,1;
target,1;
take,1;
on,
such,1;
x86_64,,1;
apple,1;
any,1;
it’s,1;
os,1;
final,1;
a,1;
.so,1;
on.
NOTE
By,1;
assumes,1;
target,1;
same,1;
have,1;
when
you’re,1;
if,1;
target,1;
though,,1;
target,1;
take,1;
given,1;
target,1;
take,1;
care
to,1;
a,1;
lot,1;
directives
(using,1;
implementations,1;
we,1;
target,1;
For,1;
full,1;
does,1;
define,1;
if,1;
defining,1;
a,1;
testing,1;
still,1;
no_std,1;
opts,1;
out,1;
have,1;
attempt,1;
a,1;
build
failure.,1;
Crucially,,1;
themselves,1;
SUPPORT
The,1;
installer,,1;
Rustup,,1;
triples,1;
would,1;
a,1;
space,1;
have,1;
target,1;
additional,1;
of
the,1;
exists,1;
target,1;
platform,,1;
you’ll,1;
have,1;
yourself,1;
using,1;
Cargo’s
(currently,1;
any,1;
target,1;
not,1;
supported,1;
if,1;
target,1;
triple—you’ll,1;
have,1;
step,1;
properties,1;
using,1;
a,1;
target,1;
do,1;
unstable,1;
a
search,1;
target,1;
a,1;
library—or,
more,1;
non-std,1;
a,1;
how,1;
at,1;
level
of,1;
how,1;
at,1;
of
the,1;
oddities,1;
we’ll,1;
how,1;
ECOSYSTEM
Programming,1;
a,1;
vacuum
these,1;
days—nearly,1;
likely,1;
take,1;
wasn’t,1;
written,1;
you.,1;
a,1;
little,1;
a,1;
either,1;
it’s,1;
a,1;
reality,1;
interdependent,1;
it’s,1;
have,1;
a,1;
tools,1;
offer.
This,1;
chapter,1;
how,1;
track,,1;
ecosystem.,1;
final,1;
section,1;
additional,1;
resources
you,1;
skills.What’s,1;
a,1;
a,1;
not,1;
look,1;
could,1;
potentially
save,1;
through,1;
have,1;
found,1;
helpful,1;
at,1;
point,1;
tools,1;
using,1;
a,1;
dependency,1;
cargo-deny,1;
known,1;
multiple,1;
times
with,1;
dependency,1;
a,1;
given,1;
you’re
writing,1;
any,1;
combination,1;
a,1;
representa-
tion,1;
(IR),1;
bits,1;
code
produce,1;
a,1;
longer
compile,1;
a,1;
for
reducing,1;
times.
cargo-outdated
Checks,1;
any,1;
either,1;
direct,1;
Crucially,,1;
it’s,1;
if,1;
you’re,1;
out,1;
outdated,1;
major
version,1;
Just,1;
mind,1;
dependency,1;
a,1;
if,1;
any,1;
listed,1;
maybe,1;
not,1;
specifically,1;
tools,1;
Rust,,1;
too—they’re,1;
grep,1;
written,1;
suspect,1;
depend,1;
a,1;
a,1;
copy,1;
a,1;
copying,1;
a,1;
no-no.
criterion
A,1;
uses,1;
measurements,1;
reliably,1;
almost,1;
using,1;
if,1;
a,1;
you’re,1;
willing,1;
interfaces,1;
exchange,1;
cross-language,1;
your
attention.
The,1;
a,1;
multi-producer,,1;
faster,
more,1;
a,1;
port,1;
Dynamic,1;
histogram,1;
provides,1;
a,1;
compact,1;
values.,1;
Anywhere,1;
likely,1;
using,1;
histogram,1;
instead;
it,1;
give,1;
distribution,1;
do,1;
not,1;
heap.,1;
makes,1;
contexts,1;
grouping,,1;
pow-
ersets.,1;
reduce,1;
boilerplate,1;
manually,1;
common,1;
algorithm
over,1;
a,1;
finding,1;
max,1;
at,1;
a,1;
common,1;
Unix-like,1;
a,1;
cobble
together,1;
C-compatible,1;
yourself,1;
libc,1;
enforce,1;
pinning,1;
a,1;
pinning,1;
those
types.,1;
which
avoids,1;
somewhat,1;
dependency,1;
machinery,1;
at,1;
cryptography,1;
through,1;
a,1;
fast,,1;
a,1;
point,1;
if,1;
crate.,1;
You’ve,1;
likely,1;
uses,1;
a,1;
T>,
where,1;
in
the,1;
a,1;
lot,1;
must,1;
must,1;
things,1;
a,1;
given,1;
a,1;
given,1;
likely,1;
provides,1;
a,1;
way
to,1;
using,1;
annotations).,1;
parse,1;
a,1;
defined,,1;
we,1;
4,,1;
a,1;
joy.,1;
traits
and,1;
established,1;
define,1;
bits,1;
async,1;
->,1;
Response,1;
and
implements,1;
a,1;
a,1;
a,1;
response
(something,1;
suspect,1;
a,1;
abstraction,1;
a,1;
efficiently,1;
of
your,1;
Crucially,,1;
events,1;
do,1;
Ecosystem
227used,1;
metrics,1;
obvi-
ously,1;
same,1;
machinery,1;
toolchain,1;
a,1;
sleeve,1;
not,1;
look,1;
usually,1;
specific,1;
cases,,1;
if,1;
match
yours,,1;
toolchain,1;
installer,,1;
does,1;
efficiently,1;
a,1;
a,1;
it’s,1;
toolchain,1;
override,1;
shorthand.,1;
any,1;
binary,
and,1;
if,1;
override,1;
given,1;
toolchain,
run,1;
override,1;
+nightly,1;
using,1;
if,1;
supported,1;
a,1;
doc,,1;
a,1;
copy,1;
browser.,1;
if,1;
you’re,1;
internet,1;
always,1;
tree,,1;
a,1;
subcommand,1;
built,1;
inspecting,1;
a,1;
crate’s,1;
dependency,1;
dependency,1;
a,1;
on
its,1;
through,1;
a,1;
produces,1;
paths,1;
bring,1;
the
current,1;
depends,1;
any,1;
including,1;
through,1;
if,1;
a,1;
dependency,,1;
a,1;
dependency,,1;
wonder,1;
still,1;
-e,1;
option,1;
subcommands,,1;
it’s,1;
a,1;
subcommand,1;
a,1;
any,1;
arguments,1;
line—so,,1;
foo,1;
bar,1;
invoke,1;
trans-
lating,1;
foo,1;
a,1;
call,1;
notice,1;
(and
Rust,1;
forgiving,1;
disk,1;
project,1;
target,1;
identical,1;
common,1;
dependencies.,1;
project,1;
sepa-
rate,1;
a,1;
compatible,1;
if,1;
project,1;
uses,1;
flags,1;
But,1;
most
developer,1;
a,1;
Luckily,,1;
configuring,1;
target,1;
in,,1;
take,1;
Just,1;
out,1;
aware,1;
a,1;
shared,1;
problems,1;
projects,1;
always,1;
out,1;
if,1;
a,1;
project,1;
does,1;
flags,,1;
you’ll,1;
out,1;
best,1;
overriding,1;
target,1;
project’s,1;
a
distinct,1;
location.
Finally,,1;
if,1;
taking,1;
a,1;
to
build,1;
unstable,1;
-Ztimings
flag.,1;
how,1;
how,1;
finish,1;
metrics.,1;
a,1;
dependency,1;
chain
that,1;
a,1;
compiles
a,1;
dependency,1;
scratch,1;
-Ztime-passes,
which,1;
emits,1;
crate—though,1;
likely,1;
if,1;
you’re,1;
unstable,1;
produces,1;
a,1;
lot,1;
immensely,1;
reduce,1;
allo-
cating,1;
a,1;
argument
The,1;
Ecosystem
229also,1;
displays,1;
layout,1;
a,1;
a,1;
could,1;
have,1;
a,1;
impact,1;
a,1;
debug,1;
regress,1;
a,1;
if,1;
call,1;
flags,,1;
have,1;
a,1;
either,1;
in
the,1;
[build],1;
rustflags,1;
have,1;
cargo
rustc,,1;
any,1;
arguments,1;
the
current,1;
look,1;
or
entirely,1;
missing,,1;
could,1;
point-
ers,1;
a,1;
reliable,1;
stack—which,1;
done,1;
a,1;
though,1;
regular,1;
debug,1;
using,1;
release,1;
not,1;
always,1;
frame,1;
take,1;
any
issues,1;
do,1;
Library
The,1;
lacks,1;
breadth,,1;
depth;,1;
won’t,1;
a,1;
imple-
mentations.,1;
For,1;
does,1;
does,1;
best,1;
any,1;
boilerplate,1;
functions,,1;
not,1;
have,1;
a,1;
a,1;
a,1;
any-
thing,1;
Write.,1;
little-known,1;
std::io::Write,1;
text,1;
into
a,1;
+,1;
text,1;
String,1;
s!
The,1;
any,1;
produces,1;
take
230
Chapter,1;
if,1;
a,1;
it’s,1;
a,1;
useful
when,1;
take,1;
a,1;
a,1;
implementations,1;
look,1;
at,1;
BufReader,1;
a,1;
must,1;
respec-
tive,1;
additionally,1;
reads,1;
do,1;
do,1;
large
write.,1;
have,1;
call,1;
Cow,1;
Cow,1;
a,1;
if,1;
it’s,1;
a,1;
you
to,1;
accurately,1;
a,1;
perfect,1;
RPC-like,1;
APIs.,1;
Say,1;
we,1;
have,1;
a,1;
Listing,1;
{
namespace:,1;
A,1;
a,1;
input/output,1;
allocation
Now,1;
imagine,1;
find_by,1;
a,1;
(presumably),1;
before,1;
response,1;
value.,1;
we,1;
must,1;
still,1;
call,1;
though,1;
not,1;
since
it’s,1;
a,1;
EntityIdenifierRef,,1;
that
holds,1;
have,1;
Listing,1;
{
namespace:,1;
Cow<'a,1;
A,1;
a,1;
input/output,1;
does,1;
not,1;
take,1;
any,1;
references,1;
call,1;
shared,1;
interfaces,,1;
a,1;
a,1;
have,1;
have,1;
a,1;
given,1;
at,1;
a,1;
a,1;
its
in-memory,1;
a,1;
either,1;
of
the,1;
VecDeque,,1;
meaning,1;
a,1;
a,1;
same,1;
have,1;
does,1;
not,1;
round,1;
a,1;
look,1;
at,1;
a,1;
a,1;
T.,1;
Arc,1;
existence,,1;
allocates,1;
a,1;
a,1;
Clone::clone_from,1;
alternative,1;
.clone(),1;
a,1;
if,1;
have,1;
do,1;
x.clone_from(y)
rather,1;
yourself,1;
allocations.
std::fmt::Formatter::debug_*,1;
if,1;
#[derive(Debug)],1;
won’t,1;
if,1;
13Debug,1;
implementations,1;
call,1;
debug_,1;
example),,1;
call,1;
a,1;
a,1;
call,1;
finish.
Instant::elapsed,1;
common,1;
a,1;
subtracting,1;
instance.
Option::as_deref,1;
P:,1;
opera-
tion,1;
.as_ref().map(|r|,1;
&**r).
Ord::clamp,1;
take,1;
any,1;
a,1;
given,1;
range.,1;
given,1;
a,1;
min
and,1;
if,1;
invert,1;
a,1;
E>,1;
vice,1;
remove,1;
must,1;
shift,1;
one.,1;
a,1;
though,,1;
exploring,1;
you’ll,1;
likely,1;
a,1;
common,1;
we,1;
do,1;
codebase,1;
multiple,1;
references,1;
a,1;
For,1;
if,1;
you
want,1;
a,1;
collection,1;
efficiently,1;
a,1;
data
multiple,1;
could,1;
Arc,1;
introduces,1;
additional,1;
could,1;
lifetimes,1;
if,1;
not,1;
the
The,1;
references,1;
same,1;
a,1;
we,1;
could,1;
ensure,1;
valid,,1;
lot,1;
consider.
Most,1;
pointers—or,,1;
call,1;
a,1;
a,1;
efficiently,1;
lifetimes,1;
needed—and,1;
have,1;
if,1;
provides,1;
a,1;
matches,1;
provides,1;
a,1;
pattern.,1;
list,1;
obvi-
ously,1;
large.,1;
uses,1;
a,1;
a,1;
hashes,1;
look,1;
a,1;
hashes,1;
yields,1;
uses,1;
uses,1;
pattern.,1;
stores,1;
uses,1;
a,1;
edge.,1;
stored,1;
how,1;
a,1;
remove,1;
store.,1;
a,1;
entry
will,1;
using,1;
swap_remove),
so,1;
reflect,1;
a,1;
reliable,1;
ensure,1;
a,1;
panics,,1;
often,1;
code.
An,1;
a,1;
a,1;
closure,1;
using,1;
atomics.,1;
Say,1;
uses,1;
10),1;
a,1;
Boolean,1;
Boolean,1;
exclusion.,1;
But,1;
if,1;
f,1;
call,1;
section,1;
using,1;
alternative,1;
often,1;
ergonomic.,1;
Listing,1;
we,1;
a,1;
ensure,1;
always,1;
..,1;
self),1;
a,1;
ensure,1;
state
can,1;
through,1;
we,1;
an
instance,1;
before,1;
we,1;
call,1;
f,1;
f,1;
a,1;
a,1;
though,1;
we,1;
given,1;
a,1;
_,1;
DropGuard(lock),1;
would,1;
panics,1;
it’s,1;
For,1;
at,1;
writing,,1;
uses,1;
TcpStream,1;
visible,1;
It’d,1;
if,1;
a,1;
a,1;
uses,1;
ensure,1;
often,1;
through,1;
shared,1;
a,1;
referencing,1;
higher,1;
call,1;
incurring,1;
additional,1;
types
that,1;
a,1;
a,1;
crate.,1;
For,1;
provides,1;
Iterator,,1;
a,1;
common,1;
(and,1;
not,1;
provides,1;
either,1;
do,1;
not,1;
trait,,1;
Iterator,,1;
lives,1;
a,1;
extends,1;
consists,1;
comes
with,1;
a,1;
any,1;
ServiceExt,1;
{}).,1;
we,1;
makes,1;
a
number,1;
any,1;
lines,,1;
you’ll,1;
often,1;
together,1;
sometimes,1;
a,1;
common,1;
serves,1;
a,1;
signal,1;
likely,1;
somecrate::prelude::*,1;
question.,1;
*
is,1;
a,1;
publicly,1;
a,1;
a,1;
lot,1;
of
items,1;
you’ll,1;
usually,1;
name.
NOTE
Items,1;
through,1;
have,1;
define,1;
a,1;
lot,1;
if,1;
For,1;
provides,1;
makes,1;
if,1;
prelude
takes,1;
your
code,,1;
into
backward-incompatible,1;
For,1;
if,1;
someone,1;
a,1;
trait
to,1;
a,1;
from,,1;
makes,1;
a,1;
a,1;
foo,1;
call,1;
foo,1;
existence,1;
makes,1;
any,1;
a,1;
technically,1;
change,,1;
1105;,1;
https://rust-lang.github.io/rfcs/1105-api-evolution.html),1;
does,1;
a,1;
a,1;
a,1;
minor,1;
cases,,1;
a,1;
would,1;
despite
being,1;
unlikely,1;
break,1;
any,1;
using,1;
usually,1;
deciding,1;
a,1;
a,1;
a,1;
young,1;
rapidly.,1;
still,1;
While,1;
on
top,1;
would,1;
it’s,1;
take,1;
including,1;
tooling,1;
upgrades,,1;
blog,1;
at,1;
a,1;
a,1;
tid-
bits,1;
surely,1;
deepen,1;
a,1;
little,1;
usually,1;
found,1;
release,1;
announcement).,1;
changelogs,1;
surface,1;
a,1;
release,1;
notes,1;
For,1;
a,1;
Edition,1;
at,1;
be
released,1;
years.
NOTE
Clippy,1;
often,1;
take,1;
a,1;
you’re,1;
curious,1;
how,1;
blog,1;
at,1;
https://blog.rust-lang.org/inside-rust/.,1;
updates,1;
various,1;
information,,1;
get
involved,1;
development,1;
lot,1;
a,1;
learning,1;
out,1;
vari-
ous,1;
at,1;
a,1;
specific,1;
you,
check,1;
group,1;
how,1;
community.,1;
do,1;
Rust-
specific,1;
patterns,,1;
explain,1;
how
to,1;
take,1;
best,1;
have,1;
community
in,1;
blog,1;
con-
versations.,1;
a,1;
show,1;
things,1;
a,1;
a,1;
a,1;
know.
The,1;
lives,1;
a,1;
lot,1;
places,,1;
to
start,1;
Users,1;
(https://discord
.gg/rust-lang-community),,1;
have,1;
of,,1;
location,1;
blog,1;
a,1;
progress,1;
contributions,,1;
upcoming,1;
site,1;
a,1;
little,1;
through
and,1;
occasional,1;
a,1;
look,1;
a,1;
book,1;
still,1;
more?,1;
Great!,1;
a,1;
other
238
Chapter,1;
out,1;
understanding,1;
Rust,,1;
final,1;
section,1;
give,1;
a,1;
how,1;
prefer,1;
that’ll,1;
you.
NOTE
A,1;
learning,1;
progress
is,1;
Implementing,1;
things,1;
take,1;
outsized
amount,1;
have,1;
debug,1;
how,1;
All,1;
that
non-coding,1;
you’re,1;
treading,1;
not,1;
But,1;
you’re,1;
progress,1;
a,1;
hack,1;
phase,1;
solo,1;
observe,1;
pro-
cess,1;
someone,1;
alter-
native,1;
through,1;
problems,1;
own.,1;
best,1;
have,1;
do,1;
things,1;
you’ve
observed—but,1;
piggybacking,1;
almost,1;
if,1;
have,1;
a,1;
videos,1;
occasional,1;
Awesome,1;
a,1;
mine,,1;
though,1;
a,1;
particular
knack,1;
makes,1;
Turner’s,1;
Systems,1;
https://www.youtube.com/c/
SystemswithJT/.,1;
videos,1;
document,1;
take,1;
a,1;
a,1;
sense,1;
a,1;
videos,1;
using,1;
concrete,1;
he,1;
videos,1;
how,1;
But,1;
have,1;
videos.,1;
learning,1;
programming.,1;
friend,1;
a,1;
if,1;
do,1;
a,1;
ultimate,1;
at,1;
Rust,,1;
experience.,1;
how,1;
from,,1;
put,1;
learning,1;
practice.,1;
finding,1;
give,1;
list,,1;
First,,1;
a,1;
project,1;
While,1;
established,1;
projects,1;
out,1;
would,1;
have
you,1;
a,1;
it’s,1;
“I,1;
must,1;
you’ll,1;
be
a,1;
chore.,1;
best,1;
projects,1;
yourself,1;
have
experienced,1;
problems,1;
a,1;
personal,1;
project,1;
foremost,,1;
con-
tributing,1;
a,1;
how,1;
look,1;
you’ll,1;
likely,1;
quickly.,1;
gain,1;
experience,,1;
parts.
If,1;
not,1;
finding,1;
written,1;
Rust—not
necessarily,1;
intention,1;
but
just,1;
focus,1;
out,1;
exists,1;
a,1;
wider,1;
port,1;
tools,1;
often,1;
a,1;
niche,1;
a,1;
“build,1;
at,1;
development,1;
multiple,1;
projects,1;
tends,1;
a,1;
signal
that,1;
could,1;
a,1;
nothing
comes,1;
a,1;
list,1;
have,1;
at,1;
a,1;
you’re,1;
substantial,1;
at,1;
(yet).
Learn,1;
finding,1;
still,1;
a,1;
things,1;
references,1;
have,1;
niche,1;
through,1;
Rustonomicon,1;
a,1;
lifesaver,1;
you’re,1;
out,1;
Library
Developers,1;
if,1;
you’re,1;
curious,1;
how,1;
does,1;
how,1;
designed,,1;
if,1;
hand,1;
at,1;
a,1;
Reference,1;
book,1;
listed,1;
at,1;
a,1;
full,1;
While,1;
representations,1;
fascinating,1;
section,1;
layout,1;
enumeration,1;
a,1;
knowledge.,1;
Little
Book,1;
if,1;
at,1;
level.,1;
testing,1;
common,1;
finding,1;
Little,1;
prefer,1;
project,1;
published
mini-redis,1;
idiomatic
implementation,1;
a,1;
specifically,1;
written,1;
a,1;
you’re,1;
a,1;
Too
Many,1;
you’re,1;
Writing,1;
(https://os.phil-opp.com/),1;
process.,1;
collection,1;
if,1;
a,1;
written,1;
a,1;
a,1;
found,1;
things,1;
quickly.,1;
provides
very,1;
if,1;
you’re,1;
you’re,1;
not,1;
if,1;
put,1;
understanding,1;
the
test,,1;
give,1;
Quiz,1;
a,1;
mind-benders,1;
going,1;
if,1;
have,1;
experience!
Learn,1;
best,1;
far,,1;
teach,1;
have,1;
things,1;
a,1;
wholeheartedly,1;
hand,1;
at,1;
book,1;
take,1;
whatever,1;
a,1;
blog,1;
making,1;
a,1;
podcast,,1;
a,1;
convey,1;
who,1;
topic—in,1;
doing,1;
also
give,1;
along,1;
a,1;
experience,,1;
cannot,1;
you’re,1;
teach,1;
visit,1;
Awesome,1;
exists,1;
features;,1;
at,1;
how
to,1;
dirty,1;
we,1;
book,1;
end.,1;
do,1;
declare:
}
The,1;
mark),,1;
(question,1;
operator),,1;
174–175
AddressSanitizer,,1;
213–215
API,1;
38
APIs,,1;
trait,,1;
code,,1;
218–219
assert_eq,,1;
(*),,1;
124–126
asynchronous,1;
interfaces,,1;
118
futures,,1;
interfaces,,1;
133–134
asynchrony,,1;
112
must_use,,1;
216
no_mangle,,1;
212–214
panic_handler,,1;
92
auditing,,1;
Streaming,,1;
201
black_box,1;
118,,1;
137
Booleans,,1;
trait,,1;
41
borrow,1;
13–14
bounds,1;
148
Box,1;
BufWriter,1;
224cargo-expand,,1;
tree,,1;
228–229
cargo-udeps,,1;
macro,,1;
92–93,,1;
trait,,1;
28–29
compare_exchange,1;
macro,,1;
and,,1;
119
conditional,1;
79–80
connection,1;
trait,,1;
7–8,,1;
40
core,1;
16
covered,1;
225
246
Index
D
data,1;
trait,,1;
specifications,,1;
79–80
Deref,1;
trait,,1;
32,,1;
trait,,1;
trait,,1;
trait,,1;
160–162
drop,1;
linking,,1;
195–198
dynamic,1;
(DSTs),,1;
Edition,1;
Guide,,1;
trait,,1;
39
erasure,,1;
trait,,1;
58
exclamation,1;
(!),,1;
10–11
executors,,1;
133,,1;
171
wide,1;
interfaces,1;
149
iter::once,,1;
149
write_unaligned,,1;
platform,,1;
107–109
G
generators,,1;
43–44
generic,1;
104
glob,1;
imports,,1;
attribute,
214,,1;
trait,,1;
Development,,1;
trait,,1;
39
HashMap,1;
203
indeferences,,1;
methods,,1;
238
Instant::elapsed,1;
233
interior,1;
trait,,1;
17
iterators,,1;
Astonishment,,1;
201
bytes,,1;
225
cbindgen,,1;
230–233
static_assertions,,1;
227–228
lifetimes,,1;
12–17
linear,1;
Little,1;
Books,,1;
242
The,1;
Little,1;
Macros,,1;
33
marker,1;
157–158
MaybeUninit::assume_init,1;
method,
148–149
248
Index
McNamara,,1;
6
implementation-managed
memory,,1;
in,,1;
181–182
relaxed,,1;
181–182
sequentially,1;
consistent,,1;
231
metadata,,1;
232–233
Arc::make_mut,,1;
233
Ord::clamp,,1;
representation
(MIR),,1;
supported,1;
version
(MSRV),,1;
81–83
Miri,,1;
20
mocks,,1;
optimization,,1;
156,,1;
202
nix,1;
226
#![no_main],1;
interfaces,,1;
120
Not,1;
Awesome,1;
list,,1;
Philipp,,1;
242
optional,1;
69
Option::as_deref,1;
233
Option::transpose,1;
233
opt-level,,1;
75
Ord,1;
trait,,1;
233
Ordering,1;
28–29
out-of-memory,1;
7–8,,1;
45–46
P
packages,1;
74
padding,,1;
macro,,1;
119–120,,1;
trait,,1;
trait,,1;
and,,1;
145
raw,1;
futures
overview,,1;
67–84
suggestions,1;
for,,1;
121
property-based,1;
testing,,1;
94–95
ptr,1;
62–65
R
race,1;
150
read_volatile,1;
53–54
references,,1;
9–12
reference,1;
21
Result,1;
61–62
Result::transpose,1;
233
ring,1;
242
The,1;
Performance,1;
Nichols),,1;
198
Rust,1;
165,,1;
204–207
sanitizers,,1;
165,,1;
But,1;
at,1;
COST?”,,1;
trait,,1;
consistent,1;
trait,,1;
trait,,1;
pinning,1;
131–132
standard,1;
Guide,,1;
linking,,1;
177
stress,1;
tests,,1;
227
subexecutors,,1;
194–198
Sync,1;
trait,,1;
interfaces,,1;
118–119
syntax,1;
239
T
tagged,1;
unions,,1;
platform,,1;
136–137
testing
concurrency,,1;
189–191
doctests,,1;
testing,,1;
tests,,1;
scoping,,1;
109This,1;
227
ThreadSanitizer,,1;
54,,1;
7–8,,1;
32,,1;
44–46
Eq,,1;
39
Error,,1;
58
From,,1;
151–152
Hash,,1;
39
higher-ranked,1;
27
Unpin,,1;
107
TSan,,1;
59–61
type,1;
34
type,1;
matching,,1;
146
atomic,,1;
BufWriter,,1;
for,,1;
39–40
complex,,1;
23
Cow,,1;
(DSTs),
23–24
existential,,1;
89
inference,,1;
47
marker,,1;
232
Ordering,,1;
145
primitive,,1;
157
VecDeque,,1;
154–155
union,,1;
trait,,1;
code,,1;
panics,,1;
of,,1;
2–3
variance,,1;
15–16
contravariance,,1;
26
void,1;
149
wakers,,1;
133–134
“We,1;
Better,1;
Specs”
(Jung),,1;
146
word,1;
macro,,1;
Rust,,1;
191
-Zprint-type-sizes,1;
229
-Ztime-passes,1;
229
-Ztimings,1;
Baskerville,,1;
Futura,,1;
and
TheSansMono,1;
Condensed.,1;
book,1;
printed,1;
bound,1;
before,1;
heavily,1;
makes,1;
mission—to,1;
ensure,1;
justice,,1;
30,1;
EFF,1;
tech,1;
courts,,1;
software,1;
free,1;
through,1;
we,1;
a,1;
MORE,1;
EFF,1;
no-nonsense,1;
SECURE,1;
MISSING,1;
README
A,1;
DevelopersA,1;
chris,1;
and
312,1;
steve,1;
and
carol,1;
$23.99
isbn,1;
978-1-7185-0183-6
THE,1;
ART,1;
battagline
304,1;
$44.99
isbn,1;
SECRET,1;
Better,1;
WORKS,
3RD,1;
EDITION
What,1;
Every,1;
ward
464,1;
978-1-7185-0040-2
email:
sales@nostarch.com
web:
www.nostarch.comForeword,1;
A,1;
DEEP,1;
basics,,1;
step,1;
covers,1;
flexible,1;
confidently
expand,1;
interfaces,1;
Rust,,1;
exploring
constructs,1;
in
manual,1;
implementations,1;
the
higher-level,1;
layout,1;
asynchrony,1;
tour,1;
no_std,1;
programming.,1;
provides,1;
your
understanding,1;
interfaces,,1;
more.•,1;
systems,1;
constrained,1;
how,1;
to:
•,1;
Rust
programs,1;
best,1;
macros
•,1;
traits
•,1;
projects,1;
rest,1;
pragmatic,1;
immediately,1;
do,1;
AUTHOR
Jon,1;
2018.,1;
covers,1;
async,1;
dispatch.,1;
A,1;
toolchain,1;
a,1;
his,1;
PhD,1;
at,1;
his,1;
AS,1;
F,1;
